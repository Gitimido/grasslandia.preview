import{C as b,Db as v,E as g,Eb as f,Lb as M,Ra as y,h as d,i as h,j as o,l,m as I,q as u,z as c}from"./chunk-UPP2GHVQ.js";var A=class{id;email;username;fullName;avatarUrl;bio;theme;privacySettings;createdAt;updatedAt;constructor(e){this.id=e.id,this.email=e.email,this.username=e.username,this.fullName=e.fullName,this.avatarUrl=e.avatarUrl,this.bio=e.bio,this.theme=e.theme,this.privacySettings=e.privacySettings,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt}get displayName(){return this.fullName||this.username}get initials(){return this.fullName.split(" ").map(e=>e.charAt(0)).join("").toUpperCase()}};var w=class s{id;userId;content;privacyLevel;groupId;createdAt;updatedAt;sharedPostId;sharedPost;sharesCount;user;media;comments;likes;liked;constructor(e){this.id=e.id,this.userId=e.userId,this.content=e.content,this.privacyLevel=e.privacyLevel,this.groupId=e.groupId,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.user=e.user,this.media=e.media||[],this.comments=e.comments||[],this.likes=e.likes||0,this.liked=e.liked||!1,this.sharedPostId=e.sharedPostId,this.sharesCount=e.sharesCount||0,e.sharedPost&&(this.sharedPost=e.sharedPost instanceof s?e.sharedPost:new s(e.sharedPost))}get hasMedia(){return Array.isArray(this.media)&&this.media.length>0}get isSharedPost(){return!!this.sharedPostId}get timeSince(){let t=Math.floor((new Date().getTime()-this.createdAt.getTime())/1e3),r=t/31536e3;return r>1?Math.floor(r)+"y":(r=t/2592e3,r>1?Math.floor(r)+"mo":(r=t/86400,r>1?Math.floor(r)+"d":(r=t/3600,r>1?Math.floor(r)+"h":(r=t/60,r>1?Math.floor(r)+"m":Math.floor(t)+"s"))))}};var p=class{id;postId;messageId;url;mediaType;orderIndex;createdAt;constructor(e){this.id=e.id,this.postId=e.postId,this.messageId=e.messageId,this.url=e.url,this.mediaType=e.mediaType,this.orderIndex=e.orderIndex,this.createdAt=e.createdAt}get isImage(){return this.mediaType==="image"}get isVideo(){return this.mediaType==="video"}};var x=class s{id;userId;postId;parentId;content;createdAt;updatedAt;user;likes;liked;replies;replyingToUsername;constructor(e){this.id=e.id,this.userId=e.userId,this.postId=e.postId,this.parentId=e.parentId,this.content=e.content,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.replyingToUsername=e.replyingToUsername,this.user=e.user,this.likes=e.likes||0,this.liked=e.liked||!1,this.replies=e.replies?e.replies.map(t=>t instanceof s?t:new s(t)):[]}get timeSince(){let t=Math.floor((new Date().getTime()-this.createdAt.getTime())/1e3),r=t/31536e3;return r>1?Math.floor(r)+"y":(r=t/2592e3,r>1?Math.floor(r)+"mo":(r=t/86400,r>1?Math.floor(r)+"d":(r=t/3600,r>1?Math.floor(r)+"h":(r=t/60,r>1?Math.floor(r)+"m":Math.floor(t)+"s"))))}get userDisplayName(){return this.user?this.user.username?this.user.username.split("@")[0].split(".")[0]:"User":"Anonymous"}};var P=class{id;userId;type;content;icon;actorId;resourceId;resourceType;read;createdAt;actor;constructor(e){this.id=e.id,this.userId=e.userId,this.type=e.type,this.content=e.content,this.icon=e.icon,this.actorId=e.actorId,this.resourceId=e.resourceId,this.resourceType=e.resourceType,this.read=e.read,this.createdAt=e.createdAt,this.actor=e.actor}get timeSince(){let t=Math.floor((new Date().getTime()-this.createdAt.getTime())/1e3),r=t/31536e3;return r>1?Math.floor(r)+"y":(r=t/2592e3,r>1?Math.floor(r)+"mo":(r=t/86400,r>1?Math.floor(r)+"d":(r=t/3600,r>1?Math.floor(r)+"h":(r=t/60,r>1?Math.floor(r)+"m":Math.floor(t)+"s"))))}};var T=class s{constructor(e,t){this.http=e;this.authService=t;this.supabase=v(f.supabaseUrl,f.supabaseKey)}supabase;apiUrl="https://grasslandia-mediahandling.mohamedhazem789.workers.dev/api/media/upload";uploadMedia(e,t,r){let i=this.authService.user?.id;if(!i)return o(()=>new Error("User not authenticated"));if(t==="post"&&!r)return o(()=>new Error("Post ID is required for post media"));let a=new FormData;a.append("file",e),a.append("userId",i),a.append("mediaCategory",t),r&&a.append("postId",r);let m=e.type.startsWith("image/")?"image":"video";return a.append("mediaType",m),this.http.post(this.apiUrl,a).pipe(l(n=>{if(!n.success)throw new Error(n.error||"Upload failed");return new p({id:n.fileId||"temp-"+Date.now(),url:n.url,mediaType:n.mediaType,postId:r,orderIndex:0,createdAt:new Date})}),u(n=>(console.error("Error uploading media:",n),o(()=>n))))}uploadProfilePicture(e){return this.uploadMedia(e,"profile")}uploadPostMedia(e,t){return this.uploadMedia(e,"post",t)}uploadMultiplePostMedia(e,t){if(!e||e.length===0)return h([]);let r=e.map((i,a)=>this.uploadPostMedia(i,t).pipe(c(m=>d(this.supabase.from("media").update({order_index:a}).eq("id",m.id)).pipe(l(()=>(m.orderIndex=a,m))))));return I(r)}getUserProfileMedia(e){return d(this.supabase.from("media").select("*").eq("user_id",e).is("post_id",null).order("created_at",{ascending:!1}).limit(1)).pipe(l(({data:t,error:r})=>{if(r)throw r;return!t||t.length===0?null:new p({id:t[0].id,postId:t[0].post_id,messageId:t[0].message_id,url:t[0].url,mediaType:t[0].media_type,orderIndex:t[0].order_index,createdAt:new Date(t[0].created_at)})}),u(t=>(console.error("Error getting profile media:",t),h(null))))}getPostMedia(e){return d(this.supabase.from("media").select("*").eq("post_id",e).order("order_index",{ascending:!0})).pipe(l(({data:t,error:r})=>{if(r)throw r;return!t||t.length===0?[]:t.map(i=>new p({id:i.id,postId:i.post_id,messageId:i.message_id,url:i.url,mediaType:i.media_type,orderIndex:i.order_index,createdAt:new Date(i.created_at)}))}),u(t=>(console.error("Error getting post media:",t),h([]))))}deleteMedia(e){let t=this.authService.user?.id;return t?d(this.supabase.from("media").select("*").eq("id",e).single()).pipe(c(({data:r,error:i})=>{if(i)throw i;if(!r)throw new Error("Media not found");if(r.user_id!==t)throw new Error("You do not have permission to delete this media");return d(this.supabase.from("media").delete().eq("id",e))}),l(({error:r})=>{if(r)throw r}),u(r=>(console.error("Error deleting media:",r),o(()=>r)))):o(()=>new Error("User not authenticated"))}updateMediaOrder(e){let t=this.authService.user?.id;if(!t)return o(()=>new Error("User not authenticated"));let r=e.map((i,a)=>this.supabase.from("media").update({order_index:a}).eq("id",i).eq("user_id",t));return d(Promise.all(r)).pipe(l(()=>{}),u(i=>(console.error("Error updating media order:",i),o(()=>i))))}static \u0275fac=function(t){return new(t||s)(g(y),g(M))};static \u0275prov=b({token:s,factory:s.\u0275fac,providedIn:"root"})};export{A as a,w as b,x as c,p as d,P as e,T as f};
