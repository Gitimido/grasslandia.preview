import{a as ki,b as Ni}from"./chunk-YQK6ONJR.js";import{a as Ri}from"./chunk-2W252SNX.js";import{b as qe}from"./chunk-LIYFZQGL.js";import{a as Ai,b as Ti,c as fe}from"./chunk-3SCB5KN2.js";import{a as ui,b as mi,c as fi,d as gi,e as hi,f as vi,g as bi,h as xi,i as _i,j as yi,k as Ci,l as Si,m as Pi,n as wi,o as Oi,p as Mi,q as Fi,r as Ii,t as me,u as Le,v as ge}from"./chunk-ZFMLJ4I4.js";import{b as ii,e as ni,f as Ei}from"./chunk-5FDPCJE3.js";import{$ as m,$a as ti,A as Pe,Ab as li,B as Rt,Ba as Ht,Bb as u,C as ee,Ca as Gt,Cb as ie,D as ye,Da as Me,Db as ue,E as N,Ea as Fe,Eb as oe,F as kt,G as H,H as Nt,Ha as Jt,J as j,Ja as Wt,K as z,Ka as Ie,Kb as Ne,L as Lt,La as le,Lb as ne,M as qt,Ma as te,N as Dt,Na as Ee,O as Ut,P as jt,Pa as J,Q as zt,Sa as Kt,T as ae,Ta as Xt,U as Bt,V as p,W as M,Wa as Zt,X as $t,Xa as Qt,Ya as ei,Z as y,Za as Ae,a as it,ab as Te,b as _t,ba as pe,c as de,ca as Yt,d as yt,da as Vt,e as Ct,ea as d,f as St,fa as l,g as Pt,ga as P,h as B,ha as we,i as D,ia as Oe,j as k,ja as V,k as wt,ka as E,kb as ri,l as T,la as _,m as Ot,mb as oi,nb as g,o as nt,ob as v,p as ce,pb as rt,q as U,qb as Re,r as Mt,ra as x,rb as si,s as Ft,sa as L,sb as ai,t as It,tb as di,ub as ot,v as K,vb as ci,w as Et,wb as pi,x as At,xb as ke,y as Tt,z as Y,za as G}from"./chunk-UPP2GHVQ.js";import"./chunk-ZQOO3JOD.js";import{a as s,b as a,c as et,d as tt}from"./chunk-HMJPAHNJ.js";function Er(i,e){i&1&&(d(0,"div",5),P(1,"div",6),d(2,"p"),x(3,"Loading posts..."),l()())}function Ar(i,e){if(i&1){let t=V();d(0,"div",7)(1,"p",8),x(2),l(),d(3,"button",9),E("click",function(){j(t);let r=_();return z(r.loadPosts())}),x(4,"Try Again"),l()()}if(i&2){let t=_();p(2),L(t.error)}}function Tr(i,e){i&1&&(d(0,"div",10)(1,"p",11),x(2,"No posts to display."),l()())}function Rr(i,e){if(i&1){let t=V();d(0,"app-post-card",14),E("deleted",function(r){j(t);let o=_(2);return z(o.handlePostDeleted(r))}),l()}if(i&2){let t=e.$implicit;m("post",t)}}function kr(i,e){if(i&1&&(d(0,"div",12),y(1,Rr,1,1,"app-post-card",13),l()),i&2){let t=_();p(),m("ngForOf",t.posts)}}var De=class i{constructor(e){this.postService=e}style="home";posts=[];isLoading=!0;error;subscriptions=[];ngOnInit(){this.loadPosts()}ngOnDestroy(){this.subscriptions.forEach(e=>{e&&typeof e.unsubscribe=="function"&&e.unsubscribe()})}loadPosts(){this.isLoading=!0,this.error=void 0;let e=this.postService.getHomeFeed().subscribe({next:t=>{console.log("Feed received posts:",t),this.posts=t,this.isLoading=!1,this.loadMediaForPosts(t)},error:t=>{this.error="Failed to load posts. Please try again later.",this.isLoading=!1,console.error("Error loading home feed:",t)}});this.subscriptions.push(e)}loadMediaForPosts(e){if(!e||e.length===0)return;let t=e.map(c=>c.id),n=e.filter(c=>c.sharedPostId).map(c=>c.sharedPostId),r=[...new Set([...t,...n])],o=this.postService.getMediaForMultiplePosts(r).pipe(K(()=>{console.log("Media loading complete")})).subscribe({next:c=>{console.log("Received media for all posts:",c),this.posts=this.posts.map(f=>(f.id in c&&(f.media=c[f.id]),f.sharedPostId&&f.sharedPost&&f.sharedPostId in c&&(f.sharedPost.media=c[f.sharedPostId]),f))},error:c=>{console.error("Error loading media for posts:",c)}});this.subscriptions.push(o)}handlePostDeleted(e){this.posts=this.posts.filter(t=>t.id!==e)}static \u0275fac=function(t){return new(t||i)(M(me))};static \u0275cmp=H({type:i,selectors:[["app-feed"]],inputs:{style:"style"},standalone:!0,features:[G],decls:5,vars:5,consts:[[1,"feed-container",3,"ngClass"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","empty-container",4,"ngIf"],["class","posts-list",4,"ngIf"],[1,"loading-container"],[1,"loading-spinner"],[1,"error-container"],[1,"error-message"],[1,"retry-button",3,"click"],[1,"empty-container"],[1,"empty-message"],[1,"posts-list"],["class","post-card-item",3,"post","deleted",4,"ngFor","ngForOf"],[1,"post-card-item",3,"deleted","post"]],template:function(t,n){t&1&&(d(0,"div",0),y(1,Er,4,0,"div",1)(2,Ar,5,1,"div",2)(3,Tr,3,0,"div",3)(4,kr,2,1,"div",4),l()),t&2&&(m("ngClass",n.style),p(),m("ngIf",n.isLoading),p(),m("ngIf",n.error),p(),m("ngIf",!n.isLoading&&!n.error&&n.posts.length===0),p(),m("ngIf",!n.isLoading&&!n.error&&n.posts.length>0))},dependencies:[J,Ie,le,te,Le],styles:['@charset "UTF-8";.feed-container[_ngcontent-%COMP%]{width:100%;max-width:650px;margin:0 auto;position:relative}.feed-container.home[_ngcontent-%COMP%]{padding:20px 0}.feed-container.profile[_ngcontent-%COMP%]{padding:0;max-width:800px}.feed-container.group[_ngcontent-%COMP%]{padding:16px;background-color:var(--background-color)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:50px 0;background-color:var(--card-background);border-radius:var(--radius-lg);box-shadow:var(--shadow-card);margin-bottom:20px;border:1px solid var(--border-color);animation:_ngcontent-%COMP%_breathing 3s infinite ease-in-out}@keyframes _ngcontent-%COMP%_breathing{0%{box-shadow:0 5px 15px #00000014}50%{box-shadow:0 8px 25px #00000026}to{box-shadow:0 5px 15px #00000014}}.loading-container[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{width:52px;height:52px;border:3px solid rgba(var(--primary-color-rgb, 76, 175, 80),.15);border-top:3px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1.2s cubic-bezier(.5,.1,.5,1) infinite;margin-bottom:24px;position:relative}.loading-container[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]:before, .loading-container[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:-3px;border-radius:50%;border:3px solid transparent;border-top-color:rgba(var(--primary-color-rgb, 76, 175, 80),.4);animation:_ngcontent-%COMP%_spin 1.8s cubic-bezier(.5,.1,.5,1) infinite}.loading-container[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]:after{border-top-color:rgba(var(--primary-color-rgb, 76, 175, 80),.2);animation:_ngcontent-%COMP%_spin 2.4s cubic-bezier(.5,.1,.5,1) infinite}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);opacity:.8;font-size:16px;font-weight:500;margin-top:0}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{background-color:rgba(var(--error-color-rgb, 229, 57, 53),.1);border:1px solid rgba(var(--error-color-rgb, 229, 57, 53),.2);border-radius:var(--radius-lg);padding:24px;margin:24px 0;text-align:center;animation:_ngcontent-%COMP%_shake .5s cubic-bezier(.36,.07,.19,.97) both}@keyframes _ngcontent-%COMP%_shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}.error-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:var(--error-color);margin-bottom:20px;font-size:16px;position:relative;padding-left:28px;display:inline-block}.error-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]:before{content:"error_outline";font-family:Material Icons;position:absolute;left:0;font-size:20px;top:-1px}.error-container[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]{background-color:var(--error-color);color:#fff;border:none;border-radius:var(--radius-md);padding:12px 24px;cursor:pointer;font-weight:600;font-size:14px;transition:all var(--transition-fast);box-shadow:0 3px 8px rgba(var(--error-color-rgb, 229, 57, 53),.2)}.error-container[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]:hover{background-color:rgba(var(--error-color-rgb, 229, 57, 53),.9);transform:translateY(-3px);box-shadow:0 6px 15px rgba(var(--error-color-rgb, 229, 57, 53),.3)}.error-container[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]:active{transform:translateY(-1px)}.empty-container[_ngcontent-%COMP%]{padding:70px 0;text-align:center;background-color:var(--card-background);border-radius:var(--radius-lg);box-shadow:var(--shadow-card);border:1px solid var(--border-color);margin-bottom:20px;position:relative;overflow:hidden}.empty-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(to right,var(--primary-color),var(--accent-color));opacity:.6}.empty-container[_ngcontent-%COMP%]   .empty-message[_ngcontent-%COMP%]{color:var(--text-color);opacity:.8;font-size:17px;margin-bottom:0;line-height:1.6}.empty-container[_ngcontent-%COMP%]   .empty-message[_ngcontent-%COMP%]:before{content:"\\1f4ed";display:block;font-size:50px;margin-bottom:20px;animation:_ngcontent-%COMP%_bounce 2s infinite}@keyframes _ngcontent-%COMP%_bounce{0%,20%,50%,80%,to{transform:translateY(0)}40%{transform:translateY(-20px)}60%{transform:translateY(-10px)}}.posts-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;position:relative}.posts-list[_ngcontent-%COMP%]:before{content:"";position:absolute;left:50%;top:0;bottom:0;width:2px;background:linear-gradient(to bottom,rgba(var(--primary-color-rgb, 76, 175, 80),0),rgba(var(--primary-color-rgb, 76, 175, 80),.05),rgba(var(--primary-color-rgb, 76, 175, 80),.1),rgba(var(--primary-color-rgb, 76, 175, 80),.05),rgba(var(--primary-color-rgb, 76, 175, 80),0));z-index:-1;transform:translate(-50%);opacity:.5}.home[_ngcontent-%COMP%]   .post-card-item[_ngcontent-%COMP%]{box-shadow:var(--shadow-card);transition:all var(--transition-normal);opacity:0;transform:translateY(30px);animation:_ngcontent-%COMP%_slide-up .6s forwards;animation-delay:calc(var(--index, 0) * .1s)}@keyframes _ngcontent-%COMP%_slide-up{to{opacity:1;transform:translateY(0)}}.home[_ngcontent-%COMP%]   .post-card-item[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:var(--shadow-hover)}.home[_ngcontent-%COMP%]   .post-card-item[_ngcontent-%COMP%]:after{content:"";position:absolute;top:20px;left:-12px;width:24px;height:24px;background-color:var(--primary-color);border-radius:50%;transform:scale(0);opacity:0;z-index:-1;transition:all .3s ease}.home[_ngcontent-%COMP%]   .post-card-item[_ngcontent-%COMP%]:hover:after{transform:scale(1);opacity:.1}@media (max-width: 768px){.feed-container[_ngcontent-%COMP%]{padding:12px}.loading-container[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{width:42px;height:42px}.empty-container[_ngcontent-%COMP%]{padding:50px 0}.posts-list[_ngcontent-%COMP%]{gap:16px}}']})};var je=class i{constructor(e,t){this.document=t;this.renderer=e.createRenderer(null,null)}renderer;modalOpen=!1;modalElement=null;modalStateSource=new _t;modalState$=this.modalStateSource.asObservable();openModal(e){this.modalOpen||(this.modalOpen=!0,this.modalElement=this.renderer.createElement("div"),this.renderer.addClass(this.modalElement,"modal-container"),this.modalElement.innerHTML=e,this.renderer.appendChild(this.document.body,this.modalElement),this.renderer.setStyle(this.document.body,"overflow","hidden"),this.modalStateSource.next(!0))}closeModal(){!this.modalOpen||!this.modalElement||(this.renderer.removeChild(this.document.body,this.modalElement),this.modalElement=null,this.modalOpen=!1,this.renderer.removeStyle(this.document.body,"overflow"),this.modalStateSource.next(!1))}isModalOpen(){return this.modalOpen}static \u0275fac=function(t){return new(t||i)(N($t),N(Wt))};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ui=(r=>(r.TEXT="text",r.PHOTO="photo",r.VIDEO="video",r.POLL="poll",r))(Ui||{}),ve=class i{constructor(e,t,n,r,o){this.postService=e;this.authService=t;this.modalService=n;this.mediaService=r;this.userService=o}postCreated=new Ut;postContent="";selectedFiles=[];isSubmitting=!1;privacyLevel="public";error="";showPrivacyOptions=!1;userAvatar="";userName="";postTypes=Ui;selectedPostType="text";modalSubscription;ngOnInit(){this.authService.user&&this.userService.getCurrentUserProfile().subscribe({next:e=>{e?(this.userAvatar=e.avatarUrl||"",this.userName=e.displayName||"User"):(this.userAvatar=this.authService.user?.user_metadata?.avatar_url||"",this.userName=this.authService.user?.user_metadata?.full_name||this.authService.user?.user_metadata?.username||(this.authService.user?.email?this.authService.user.email.split("@")[0]:"User"))},error:e=>{console.error("Error loading user profile:",e),this.userAvatar=this.authService.user?.user_metadata?.avatar_url||"",this.userName=this.authService.user?.user_metadata?.full_name||this.authService.user?.user_metadata?.username||(this.authService.user?.email?this.authService.user.email.split("@")[0]:"User")}}),this.modalSubscription=this.modalService.modalState$.subscribe(e=>{e||this.handleModalClosed()}),this.setupGlobalEventListeners()}ngOnDestroy(){this.modalSubscription&&this.modalSubscription.unsubscribe(),this.modalService.isModalOpen()&&this.modalService.closeModal()}setupGlobalEventListeners(){document.body.addEventListener("click",this.handleGlobalClick)}handleGlobalClick=e=>{let t=e.target;if(t.classList.contains("close-btn")||t.closest(".close-btn")){this.closeModal(),e.stopPropagation();return}if(t.classList.contains("post-modal-overlay")&&!t.closest(".post-modal")){this.closeModal(),e.stopPropagation();return}if(t.classList.contains("option-item")||t.closest(".option-item")){let n=t.classList.contains("option-item")?t:t.closest(".option-item");if(n&&n.getAttribute("data-value")){let r=n.getAttribute("data-value");this.setPrivacyLevel(r),this.updatePrivacyDropdown(),e.stopPropagation()}return}if(t.classList.contains("privacy-btn")||t.closest(".privacy-btn")){this.togglePrivacyOptions(),this.updatePrivacyDropdown(),e.stopPropagation();return}if(t.classList.contains("post-button")&&!t.hasAttribute("disabled")){this.submitPost(),e.stopPropagation();return}if(t.classList.contains("remove-file-btn")||t.closest(".remove-file-btn")){let n=t.classList.contains("remove-file-btn")?t:t.closest(".remove-file-btn");if(n&&n.getAttribute("data-index")){let r=parseInt(n.getAttribute("data-index")||"0",10);this.removeFile(r),e.stopPropagation()}return}};handleTextAreaInput(e){let t=e.target;this.postContent=t.value,this.autoGrow(t),this.updateSubmitButtonState()}openModal(){let e=this.getModalHTML();this.modalService.openModal(e),setTimeout(()=>{let t=document.querySelector(".post-modal textarea");t&&(t.value=this.postContent,t.addEventListener("input",o=>this.handleTextAreaInput(o)),this.autoGrow(t));let n=document.querySelector('.post-modal input[accept="image/*"]');n&&n.addEventListener("change",o=>this.onFileSelected(o));let r=document.querySelector('.post-modal input[accept="video/*"]');r&&r.addEventListener("change",o=>this.onFileSelected(o))},0)}closeModal(){this.modalService.closeModal()}handleModalClosed(){}updatePrivacyDropdown(){let e=document.querySelector(".privacy-dropdown");e&&(this.showPrivacyOptions?e.classList.remove("hidden"):e.classList.add("hidden"));let t=document.querySelector(".privacy-text"),n=document.querySelector(".privacy-btn .material-icons:first-child");if(t&&n){t.textContent=this.privacyLevel==="public"?"Public":this.privacyLevel==="friends"?"Friends":"Only Me";let r=n;r.textContent=this.privacyLevel==="public"?"public":this.privacyLevel==="friends"?"group":"lock"}}getModalHTML(){return`
      <div class="post-modal-overlay">
        <div class="post-modal">
          <!-- Modal header -->
          <div class="modal-header">
            <h2>Create Post</h2>
            <button class="close-btn">
              <span class="material-icons">close</span>
            </button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <!-- User info section -->
            <div class="user-info">
              <div class="user-avatar">
                <img src="${this.userAvatar||"/assets/default-avatar.png"}" alt="Your avatar">
              </div>
              <div class="user-name">
                <span>${this.userName||"You"}</span>
                
                <!-- Privacy dropdown -->
                <div class="privacy-selector">
                  <button class="privacy-btn">
                    <span class="material-icons">
                      ${this.privacyLevel==="public"?"public":this.privacyLevel==="friends"?"group":"lock"}
                    </span>
                    <span class="privacy-text">
                      ${this.privacyLevel==="public"?"Public":this.privacyLevel==="friends"?"Friends":"Only Me"}
                    </span>
                    <span class="material-icons">arrow_drop_down</span>
                  </button>
                  
                  <div class="privacy-dropdown ${this.showPrivacyOptions?"":"hidden"}">
                    <div class="option-item" data-value="public">
                      <span class="material-icons">public</span>
                      <div class="option-details">
                        <span class="option-title">Public</span>
                        <span class="option-desc">Anyone can see this post</span>
                      </div>
                    </div>
                    <div class="option-item" data-value="friends">
                      <span class="material-icons">group</span>
                      <div class="option-details">
                        <span class="option-title">Friends</span>
                        <span class="option-desc">Only your friends can see this post</span>
                      </div>
                    </div>
                    <div class="option-item" data-value="only_me">
                      <span class="material-icons">lock</span>
                      <div class="option-details">
                        <span class="option-title">Only Me</span>
                        <span class="option-desc">Only you can see this post</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Post content textarea -->  
            <div class="content-area">
              <textarea 
                placeholder="What's on your mind?" 
                ${this.isSubmitting?"disabled":""}
                rows="3">${this.postContent}</textarea>
            </div>

            <!-- Media preview area -->
            <div class="media-preview" id="media-preview-container" ${this.selectedFiles.length===0?'style="display:none;"':""}>
              ${this.getMediaPreviewHTML()}
            </div>

            <!-- Error message display -->
            ${this.error?`<div class="error-message">${this.error}</div>`:""}
          </div>

          <!-- Modal footer with action buttons -->
          <div class="modal-footer">
            <div class="add-to-post">
              <span>Add to your post</span>
              <div class="post-options">
                <!-- Photo upload option -->
                <label class="option-btn ${this.isSubmitting?"disabled":""}" title="Add Photo">
                  <span class="material-icons">photo</span>
                  <input type="file" accept="image/*" multiple ${this.isSubmitting?"disabled":""} hidden>
                </label>
                
                <!-- Video upload option -->
                <label class="option-btn ${this.isSubmitting?"disabled":""}" title="Add Video">
                  <span class="material-icons">videocam</span>
                  <input type="file" accept="video/*" ${this.isSubmitting?"disabled":""} hidden>
                </label>
                
                <!-- Poll option - disabled for now -->
                <button class="option-btn" disabled title="Create Poll (Coming Soon)">
                  <span class="material-icons">poll</span>
                </button>
              </div>
            </div>
            
            <!-- Post button -->
<button 
  class="post-button" 
  ${this.isSubmitting||this.postContent.trim()===""&&this.selectedFiles.length===0?"disabled":""}>
  ${this.isSubmitting?'<span class="spinner"></span><span>Posting...</span>':"<span>Post</span>"}
</button>
          </div>
        </div>
      </div>
    `}getMediaPreviewHTML(){return this.selectedFiles.length===0?"":this.selectedFiles.map((e,t)=>e.type.startsWith("image/")?`
          <div class="preview-item" data-index="${t}">
            <img src="${this.getFilePreviewUrl(e)}" alt="Selected image" class="media-thumbnail">
            <button class="remove-file-btn" data-index="${t}" ${this.isSubmitting?"disabled":""} title="Remove media">
              <span class="material-icons">close</span>
            </button>
          </div>
        `:`
          <div class="preview-item" data-index="${t}">
            <div class="video-thumbnail">
              <span class="material-icons video-icon">videocam</span>
              <span class="file-name">${e.name}</span>
            </div>
            <button class="remove-file-btn" data-index="${t}" ${this.isSubmitting?"disabled":""} title="Remove media">
              <span class="material-icons">close</span>
            </button>
          </div>
        `).join("")}autoGrow(e){e.style.height="auto",e.style.height=e.scrollHeight+"px"}togglePrivacyOptions(){this.showPrivacyOptions=!this.showPrivacyOptions}setPrivacyLevel(e){this.privacyLevel=e,this.showPrivacyOptions=!1}onFileSelected(e){let t=e.target;if(t.files){let n=Array.from(t.files);console.log("Files selected:",n),n.length>0&&(n[0].type.startsWith("image/")?this.selectedPostType="photo":n[0].type.startsWith("video/")&&(this.selectedPostType="video")),this.selectedFiles=[...this.selectedFiles,...n],this.updateMediaPreview(),this.updateSubmitButtonState()}}updateMediaPreview(){let e=document.getElementById("media-preview-container");e&&(this.selectedFiles.length>0?(e.style.display="flex",e.innerHTML=this.getMediaPreviewHTML()):e.style.display="none")}removeFile(e){this.selectedFiles=this.selectedFiles.filter((t,n)=>n!==e),this.selectedFiles.length===0&&(this.selectedPostType="text"),this.updateMediaPreview()}submitPost(){if(!this.postContent.trim()&&this.selectedFiles.length===0||this.isSubmitting)return;if(this.isSubmitting=!0,this.error="",this.updateSubmitButtonState(),!this.authService.user){this.error="You must be logged in to create a post",this.isSubmitting=!1,this.updateErrorMessage(),this.updateSubmitButtonState();return}let e=this.authService.user.id,t=new ii({userId:e,content:this.postContent.trim(),privacyLevel:this.privacyLevel,createdAt:new Date,updatedAt:new Date});this.postService.createPost(t).pipe(U(n=>(console.error("Error creating post:",n),this.error="Failed to create post. Please try again.",this.updateErrorMessage(),k(()=>n))),Y(n=>{if(console.log("Post created successfully:",n),!this.selectedFiles||this.selectedFiles.length===0)return D(n);console.log("Uploading",this.selectedFiles.length,"files");let r=[];return this.selectedFiles.forEach((o,c)=>{let f=Date.now(),w=Math.random().toString(36).substring(2,7),b=o.name.split(".").pop(),q=`user/${e}/post/${n.id}/${f}_${w}.${b}`,h=new FormData;h.append("file",o),h.append("userId",e),h.append("postId",n.id),h.append("mediaType",o.type.startsWith("image/")?"image":"video"),h.append("mediaCategory","post");let O=fetch("https://grasslandia-mediahandling.mohamedhazem789.workers.dev/api/media/upload",{method:"POST",body:h}).then(I=>I.json()).then(I=>{if(console.log("Upload result:",I),!I.success)throw new Error(I.error||"Upload failed");return this.supabase.from("media").insert({post_id:n.id,user_id:e,url:I.url,media_type:o.type.startsWith("image/")?"image":"video",order_index:c,created_at:new Date().toISOString()}).select()}).then(({data:I,error:C})=>{if(C)throw console.error("Error saving media record:",C),C;return console.log("Media record created:",I),I});r.push(O)}),B(Promise.all(r)).pipe(T(o=>(console.log("All media uploaded successfully:",o),n)),U(o=>(console.error("Error uploading media:",o),this.error="Post created but there was an issue with media uploads.",this.updateErrorMessage(),D(n))))}),K(()=>{this.isSubmitting=!1,this.updateSubmitButtonState()})).subscribe({next:n=>{n&&(console.log("Post creation complete"),this.postCreated.emit(n),this.resetForm(),this.closeModal())},error:n=>{console.error("Error in post creation flow:",n),this.isSubmitting=!1,this.updateSubmitButtonState()}})}get supabase(){return ue(oe.supabaseUrl,oe.supabaseKey)}createTextPost(e){this.postService.createPost(e).pipe(U(t=>(console.error("Error creating post:",t),t.code==="42501"&&t.message.includes("row-level security policy")?this.error="Permission error: Unable to create post. Please contact an administrator to update your permissions.":this.error="Failed to create post. Please try again.",this.updateErrorMessage(),D(null))),K(()=>{this.isSubmitting=!1,this.updateSubmitButtonState()})).subscribe(t=>{t&&(this.postCreated.emit(t),this.resetForm(),this.closeModal())})}uploadFilesAndCreatePost(e){this.postService.createPost(e).pipe(U(t=>(console.error("Error creating post:",t),t.code==="42501"&&t.message.includes("row-level security policy")?this.error="Permission error: Unable to create post. Please contact an administrator to update your permissions.":this.error="Failed to create post. Please try again.",this.updateErrorMessage(),this.isSubmitting=!1,this.updateSubmitButtonState(),D(null)))).subscribe(t=>{if(!t)return;let n=this.selectedFiles.map((r,o)=>{let c=`${t.id}/${o}-${r.name}`;return this.postService.uploadMedia(r,c)});Promise.all(n).then(r=>{let o=r.map((c,f)=>({postId:t.id,url:c,mediaType:this.getMediaType(this.selectedFiles[f]),orderIndex:f}));this.postService.addMediaToPost(t.id,o).pipe(U(c=>(console.error("Error linking media to post:",c),this.error="Your post was created but media could not be attached.",this.updateErrorMessage(),D(void 0))),K(()=>{this.isSubmitting=!1,this.updateSubmitButtonState()})).subscribe(()=>{this.postCreated.emit(t),this.resetForm(),this.closeModal()})}).catch(r=>{console.error("Error uploading media:",r),this.error="Your post was created but media could not be uploaded.",this.updateErrorMessage(),this.isSubmitting=!1,this.updateSubmitButtonState(),this.postCreated.emit(t),this.resetForm(),this.closeModal()})})}updateErrorMessage(){let e=document.querySelector(".error-message");if(this.error)if(e)e.textContent=this.error;else{let t=document.querySelector(".modal-body");t&&(e=document.createElement("div"),e.className="error-message",e.textContent=this.error,t.appendChild(e))}else e&&e.parentNode?.removeChild(e)}updateSubmitButtonState(){let e=document.querySelector(".post-button");e&&(this.isSubmitting||!this.postContent.trim()&&this.selectedFiles.length===0?e.setAttribute("disabled","true"):e.removeAttribute("disabled"),e.innerHTML=this.isSubmitting?'<span class="spinner"></span><span>Posting...</span>':"<span>Post</span>")}resetForm(){this.postContent="",this.selectedFiles=[],this.privacyLevel="public",this.showPrivacyOptions=!1,this.selectedPostType="text",this.error=""}getMediaType(e){return e.type.startsWith("image/")?"image":"video"}getFilePreviewUrl(e){return URL.createObjectURL(e)}static \u0275fac=function(t){return new(t||i)(M(me),M(ne),M(je),M(Ei),M(fe))};static \u0275cmp=H({type:i,selectors:[["app-create-post"]],outputs:{postCreated:"postCreated"},standalone:!0,features:[G],decls:7,vars:1,consts:[[1,"create-post-trigger",3,"click"],[1,"trigger-content"],[1,"avatar-placeholder"],["alt","Your avatar",3,"src"],[1,"trigger-text"]],template:function(t,n){t&1&&(d(0,"div",0),E("click",function(){return n.openModal()}),d(1,"div",1)(2,"div",2),P(3,"img",3),l(),d(4,"div",4)(5,"span"),x(6,"What's on your mind?"),l()()()()),t&2&&(p(3),m("src",n.userAvatar||"/assets/default-avatar.png",ae))},dependencies:[J,ri],styles:[`.create-post-trigger{background-color:var(--card-background);border-radius:var(--radius-lg);box-shadow:0 4px 16px #0000000f;padding:18px 20px;cursor:pointer;transition:all .3s cubic-bezier(.25,1,.5,1);margin-bottom:24px;border:1px solid var(--border-color);position:relative;overflow:hidden}.create-post-trigger:after{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(to right,var(--primary-color),var(--accent-color),var(--primary-color));opacity:0;transition:opacity .3s ease}.create-post-trigger:hover{box-shadow:0 8px 24px #0000001a;transform:translateY(-5px)}.create-post-trigger:hover:after{opacity:1}.create-post-trigger .trigger-content{display:flex;align-items:center;gap:14px}.create-post-trigger .avatar-placeholder{width:46px;height:46px;border-radius:var(--radius-full);overflow:hidden;border:var(--avatar-border);box-shadow:0 3px 10px #0000001a;transition:transform .3s ease}.create-post-trigger .avatar-placeholder img{width:100%;height:100%;object-fit:cover}.create-post-trigger .avatar-placeholder .create-post-trigger{outline:none;border-left:none;box-shadow:0 4px 16px #0000000f}.create-post-trigger .trigger-text{flex:1;font-size:16px;color:var(--text-color);opacity:.8;background-color:var(--hover-color);padding:14px 18px;border-radius:var(--radius-full);transition:all .25s cubic-bezier(.25,1,.5,1)}.create-post-trigger .trigger-text:hover{background-color:var(--secondary-color);color:var(--primary-color);opacity:1;transform:scale(1.01)}.modal-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999}.post-modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0009;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);display:flex;justify-content:center;align-items:center;padding:0 20px;animation:fade-in .3s cubic-bezier(.25,1,.5,1) forwards}@keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes fade-out{0%{opacity:1}to{opacity:0}}.post-modal{width:100%;max-width:550px;background-color:var(--card-background);border-radius:var(--radius-lg);overflow:hidden;box-shadow:0 10px 40px #00000026;display:flex;flex-direction:column;max-height:90vh;animation:slide-down .4s cubic-bezier(.34,1.56,.64,1);border:1px solid var(--border-color);transform-origin:top center}@keyframes slide-down{0%{opacity:0;transform:translateY(-30px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.modal-header{position:relative;padding:20px 24px;border-bottom:1px solid var(--border-color);text-align:center;background:linear-gradient(to right,rgba(var(--primary-color-rgb, 76, 175, 80),.03),rgba(var(--primary-color-rgb, 76, 175, 80),.07),rgba(var(--primary-color-rgb, 76, 175, 80),.03))}.modal-header h2{font-size:22px;font-weight:600;margin:0;color:var(--text-color);position:relative;display:inline-block}.modal-header h2:after{content:"";position:absolute;bottom:-4px;left:35%;right:35%;height:2px;background-color:var(--primary-color);border-radius:var(--radius-full)}.modal-header .close-btn{position:absolute;top:14px;right:16px;width:36px;height:36px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;background:var(--hover-color);border:none;cursor:pointer;transition:all .25s cubic-bezier(.25,1,.5,1);color:var(--text-color)}.modal-header .close-btn:hover{background:var(--secondary-color);transform:rotate(90deg);box-shadow:0 2px 8px #0000001a}.modal-header .close-btn .material-icons{font-size:20px}.modal-body{padding:20px 24px;overflow-y:auto;flex:1;background-color:var(--card-background)}.modal-body .user-info{display:flex;align-items:center;margin-bottom:20px}.modal-body .user-info .user-avatar{width:48px;height:48px;border-radius:var(--radius-full);overflow:hidden;margin-right:14px;border:var(--avatar-border);box-shadow:0 3px 10px #0000001a;transition:transform .3s ease}.modal-body .user-info .user-avatar img{width:100%;height:100%;object-fit:cover}.modal-body .user-info .user-avatar:hover{transform:scale(1.1)}.modal-body .user-info .user-name{display:flex;flex-direction:column;font-size:15px;font-weight:600;color:var(--text-color)}.modal-body .privacy-selector{position:relative;margin-top:4px}.modal-body .privacy-selector .privacy-btn{display:flex;align-items:center;background:none;border:none;padding:6px 10px;border-radius:var(--radius-md);font-size:13px;color:var(--text-color);opacity:.8;cursor:pointer;transition:all .25s cubic-bezier(.25,1,.5,1)}.modal-body .privacy-selector .privacy-btn:hover{background-color:var(--hover-color);color:var(--primary-color);opacity:1}.modal-body .privacy-selector .privacy-btn .material-icons{font-size:16px;margin-right:6px;transition:transform .2s ease}.privacy-btn:hover .modal-body .privacy-selector .privacy-btn .material-icons{transform:scale(1.2)}.modal-body .privacy-selector .privacy-btn .privacy-text{margin-right:6px;font-weight:500}.modal-body .privacy-selector .privacy-dropdown{position:absolute;top:100%;left:0;width:250px;background-color:var(--card-background);border-radius:var(--radius-md);box-shadow:0 6px 20px #0000001f;z-index:10;margin-top:6px;overflow:hidden;border:1px solid var(--border-color);animation:fadeIn .25s cubic-bezier(.25,1,.5,1)}.modal-body .privacy-selector .privacy-dropdown.hidden{display:none}.modal-body .privacy-selector .privacy-dropdown .option-item{display:flex;align-items:center;padding:12px 16px;cursor:pointer;transition:all .25s cubic-bezier(.25,1,.5,1);border-left:3px solid transparent}.modal-body .privacy-selector .privacy-dropdown .option-item:hover{background-color:var(--hover-color);transform:translate(4px);border-left-color:var(--primary-color)}.modal-body .privacy-selector .privacy-dropdown .option-item .material-icons{margin-right:14px;font-size:20px;color:var(--text-color);opacity:.7;transition:transform .2s ease}.option-item:hover .modal-body .privacy-selector .privacy-dropdown .option-item .material-icons{transform:scale(1.2)}.modal-body .privacy-selector .privacy-dropdown .option-item .option-details{display:flex;flex-direction:column}.modal-body .privacy-selector .privacy-dropdown .option-item .option-title{font-size:14px;font-weight:600;color:var(--text-color);margin-bottom:2px}.modal-body .privacy-selector .privacy-dropdown .option-item .option-desc{font-size:12px;color:var(--text-color);opacity:.7}.modal-body .content-area{margin-bottom:20px;position:relative}.modal-body .content-area:after{content:"";position:absolute;bottom:-10px;left:10%;right:10%;height:1px;background:linear-gradient(to right,rgba(var(--border-color-rgb, 200, 200, 200),0),rgba(var(--border-color-rgb, 200, 200, 200),.5),rgba(var(--border-color-rgb, 200, 200, 200),0))}.modal-body .content-area textarea{width:100%;border:none;resize:none;font-size:17px;line-height:1.6;padding:10px 0;min-height:120px;font-family:inherit;background-color:var(--card-background);color:var(--text-color);transition:all .25s ease}.modal-body .content-area textarea:focus{outline:none}.modal-body .content-area textarea::placeholder{color:var(--text-color);opacity:.5}.modal-body .content-area textarea:disabled{background-color:transparent;color:var(--text-color);opacity:.7}.modal-body .media-preview{display:flex;flex-wrap:wrap;gap:14px;margin-bottom:20px;padding:10px 0}.modal-body .media-preview .preview-item{position:relative;width:130px;height:130px;border-radius:var(--radius-md);overflow:hidden;box-shadow:0 4px 12px #0000001a;transition:all .25s cubic-bezier(.25,1,.5,1)}.modal-body .media-preview .preview-item:hover{transform:scale(1.05) translateY(-5px);box-shadow:0 8px 20px #00000026}.modal-body .media-preview .preview-item .media-thumbnail{width:100%;height:100%;object-fit:cover}.modal-body .media-preview .preview-item .video-thumbnail{width:100%;height:100%;background-color:var(--hover-color);display:flex;flex-direction:column;align-items:center;justify-content:center}.modal-body .media-preview .preview-item .video-thumbnail .video-icon{color:var(--primary-color);font-size:40px;margin-bottom:8px;animation:pulse 2s infinite}@keyframes pulse{0%{transform:scale(.95)}50%{transform:scale(1.05)}to{transform:scale(.95)}}.modal-body .media-preview .preview-item .video-thumbnail .file-name{font-size:12px;color:var(--text-color);opacity:.8;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 8px;text-align:center;font-weight:500}.modal-body .media-preview .preview-item .remove-file-btn{position:absolute;top:8px;right:8px;width:28px;height:28px;border-radius:var(--radius-full);background-color:#0009;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .25s cubic-bezier(.25,1,.5,1);opacity:0}.modal-body .media-preview .preview-item .remove-file-btn .material-icons{color:#fff;font-size:16px}.modal-body .media-preview .preview-item .remove-file-btn:hover{background-color:rgba(var(--error-color-rgb, 229, 57, 53),.9);transform:scale(1.1)}.modal-body .media-preview .preview-item .remove-file-btn:disabled{opacity:.5;cursor:not-allowed}.preview-item:hover .modal-body .media-preview .preview-item .remove-file-btn{opacity:1}.modal-body .error-message{margin-top:16px;color:var(--error-color);font-size:14px;padding:12px 16px;background-color:rgba(var(--error-color-rgb, 229, 57, 53),.1);border-radius:var(--radius-md);border-left:3px solid var(--error-color);display:flex;align-items:center}.modal-body .error-message:before{content:"error_outline";font-family:Material Icons;margin-right:10px;font-size:18px}.modal-footer{padding:16px 24px;border-top:1px solid var(--border-color);background-color:var(--background-color)}.modal-footer .add-to-post{display:flex;justify-content:space-between;align-items:center;padding-bottom:16px}.modal-footer .add-to-post span{font-size:15px;font-weight:600;color:var(--text-color);opacity:.8}.modal-footer .add-to-post .post-options{display:flex;gap:10px}.modal-footer .add-to-post .option-btn{width:40px;height:40px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;background:var(--hover-color);border:none;cursor:pointer;color:var(--text-color);opacity:.9;transition:all .25s cubic-bezier(.25,1,.5,1);box-shadow:0 2px 6px #0000000d}.modal-footer .add-to-post .option-btn:hover{background-color:var(--secondary-color);color:var(--primary-color);opacity:1;transform:scale(1.1);box-shadow:0 4px 10px #0000001a}.modal-footer .add-to-post .option-btn.disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}.modal-footer .add-to-post .option-btn .material-icons{font-size:20px}.modal-footer .post-button{width:100%;padding:14px;border-radius:var(--radius-lg);background-color:var(--primary-color);color:#fff;border:none;font-weight:600;font-size:16px;cursor:pointer;transition:all .25s cubic-bezier(.25,1,.5,1);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px #4caf5033}.modal-footer .post-button:hover{background-color:var(--primary-dark);transform:translateY(-3px);box-shadow:0 8px 20px #4caf5040}.modal-footer .post-button:active{transform:translateY(-1px)}.modal-footer .post-button:disabled{background-color:var(--primary-color);opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.modal-footer .post-button .spinner{width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;margin-right:10px;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.post-modal{max-width:95%}.modal-body{padding:16px 20px}.modal-footer{padding:12px 20px}.content-area textarea{font-size:16px}.privacy-dropdown{width:230px}}
`],encapsulation:2})};function Lr(i,e){if(i&1){let t=V();d(0,"app-create-post",5),E("postCreated",function(r){j(t);let o=_();return z(o.handlePostCreated(r))}),l()}}var Be=class i{constructor(e,t){this.sideNavService=e;this.store=t;this.isLoggedIn$=this.store.select(Ne)}feedStyle="home";isSidebarCollapsed=!1;isLoggedIn$;ngOnInit(){this.sideNavService.sidebarState.subscribe(e=>{this.isSidebarCollapsed=e})}handlePostCreated(e){console.log("Post created successfully:",e.id);let t=document.querySelector("app-feed");if(t)try{t.loadPosts()}catch(n){console.error("Error refreshing feed:",n),window.location.reload()}else console.warn("Feed component not found, cannot refresh")}static \u0275fac=function(t){return new(t||i)(M(ge),M(ke))};static \u0275cmp=H({type:i,selectors:[["app-home"]],standalone:!0,features:[G],decls:7,vars:5,consts:[[1,"home-container"],[1,"content-layout"],[1,"main-content"],["class","create-post-wrapper",3,"postCreated",4,"ngIf"],[1,"feed-container"],[1,"create-post-wrapper",3,"postCreated"]],template:function(t,n){t&1&&(d(0,"div",0)(1,"div",1)(2,"div",2),y(3,Lr,1,0,"app-create-post",3),Me(4,"async"),d(5,"div",4),P(6,"app-feed"),l()()()()),t&2&&(p(3),m("ngIf",Fe(4,3,n.isLoggedIn$)),p(3),Yt(n.feedStyle))},dependencies:[J,te,Ee,De,ve],styles:[".home-container[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease;width:100%;max-width:1200px;margin:0 auto;padding:20px}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.content-layout[_ngcontent-%COMP%]{display:flex;gap:24px;max-width:1200px;margin:0 auto}.main-content[_ngcontent-%COMP%]{flex:1;min-width:0}.create-post-wrapper[_ngcontent-%COMP%]{max-width:600px;margin:0 auto 24px;border-radius:var(--radius-lg);box-shadow:var(--shadow-card);overflow:hidden;background-color:var(--card-background);transition:all var(--transition-normal);animation:_ngcontent-%COMP%_slideDown .4s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-30px)}to{opacity:1;transform:translateY(0)}}.create-post-wrapper[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:var(--shadow-hover)}@media (max-width: 768px){.create-post-wrapper[_ngcontent-%COMP%]{margin-bottom:16px;border-radius:var(--radius-md)}}.feed-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;border-radius:var(--radius-lg);overflow:hidden;position:relative;animation:_ngcontent-%COMP%_slideUp .4s ease;animation-delay:.2s;animation-fill-mode:both}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.feed-container[_ngcontent-%COMP%]   .post-card-item[_ngcontent-%COMP%]{opacity:0;transform:translateY(20px);animation:_ngcontent-%COMP%_postSlideUp .5s forwards;animation-delay:calc(var(--index, 0) * .1s + .3s)}@keyframes _ngcontent-%COMP%_postSlideUp{to{opacity:1;transform:translateY(0)}}@media (max-width: 768px){.feed-container[_ngcontent-%COMP%]{border-radius:var(--radius-md)}}"]})};var be=class i{constructor(e){this.authService=e;this.supabase=ue(oe.supabaseUrl,oe.supabaseKey),this.authService.user$.subscribe(t=>{t?(this.setupRealtimeSubscription(t.id),this.loadNotifications()):this.cleanupSubscription()})}supabase;notificationsSubscription=null;notificationsSubject=new de([]);unreadCountSubject=new de(0);setupRealtimeSubscription(e){this.cleanupSubscription(),this.notificationsSubscription=this.supabase.channel("public:notifications").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e}`},t=>{console.log("Notification change:",t),this.loadNotifications()}).subscribe()}cleanupSubscription(){this.notificationsSubscription&&(this.supabase.removeChannel(this.notificationsSubscription),this.notificationsSubscription=null)}loadNotifications(){this.getNotifications(20,0).subscribe(e=>{this.notificationsSubject.next(e),this.unreadCountSubject.next(e.filter(t=>!t.read).length)})}getNotifications(e=20,t=0){let n=this.authService.user?.id;return n?B(this.supabase.from("notifications").select(`
          *,
          actor:actor_id(id, username, full_name, avatar_url)
        `).eq("user_id",n).order("created_at",{ascending:!1}).range(t,t+e-1)).pipe(T(({data:r,error:o})=>{if(o)throw o;return r?r.map(c=>new ni({id:c.id,userId:c.user_id,type:c.type,content:c.content,icon:c.icon,actorId:c.actor_id,resourceId:c.resource_id,resourceType:c.resource_type,read:c.read,createdAt:new Date(c.created_at),actor:c.actor})):[]}),U(r=>(console.error("Error fetching notifications:",r),D([])))):D([])}get notifications$(){return this.notificationsSubject.asObservable()}get unreadCount$(){return this.unreadCountSubject.asObservable()}createNotification(e){return e.userId?B(this.supabase.from("notifications").insert({user_id:e.userId,type:e.type,content:e.content,icon:e.icon,actor_id:e.actorId,resource_id:e.resourceId,resource_type:e.resourceType,read:e.read||!1,created_at:new Date})).pipe(T(({error:t})=>{if(t)throw t}),U(t=>(console.error("Error creating notification:",t),k(()=>t)))):k(()=>new Error("User ID is required for notifications"))}markAsRead(e){let t=this.authService.user?.id;return t?B(this.supabase.from("notifications").update({read:!0}).eq("id",e).eq("user_id",t)).pipe(T(({error:n})=>{if(n)throw n;let o=this.notificationsSubject.getValue().map(c=>c.id===e?a(s({},c),{read:!0}):c);this.notificationsSubject.next(o),this.unreadCountSubject.next(o.filter(c=>!c.read).length)}),U(n=>(console.error("Error marking notification as read:",n),k(()=>n)))):k(()=>new Error("You must be logged in to update notifications"))}getUnreadCount(){let e=this.authService.user?.id;return e?B(this.supabase.from("notifications").select("id",{count:"exact",head:!0}).eq("user_id",e).eq("read",!1)).pipe(T(({count:t,error:n})=>{if(n)throw n;return t||0}),U(t=>(console.error("Error getting unread notification count:",t),D(0)))):D(0)}static \u0275fac=function(t){return new(t||i)(N(ne))};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};var $e=(r=>(r.PENDING="pending",r.ACCEPTED="accepted",r.REJECTED="rejected",r.BLOCKED="blocked",r))($e||{}),xe=class i{constructor(e,t){this.authService=e;this.notificationService=t;this.supabase=ue(oe.supabaseUrl,oe.supabaseKey),this.authService.user$.subscribe(n=>{n?(this.setupRealtimeSubscriptions(n.id),this.loadAllFriendships(n.id)):this.cleanupSubscriptions()})}supabase;friendRequestsSubscription=null;friendshipUpdatesSubscription=null;pendingRequestsSubject=new de([]);friendsSubject=new de([]);friendshipsByUserIdSubject=new de(new Map);loadAllFriendships(e){B(this.supabase.from("friendships").select("*").or(`user_id.eq.${e},friend_id.eq.${e}`)).subscribe({next:({data:t,error:n})=>{if(n){console.error("Error loading friendships:",n);return}t&&this.processFriendships(t,e)}})}processFriendships(e,t){let n=new Map,r=[],o=[];e.forEach(c=>{let f=c.user_id===t?c.friend_id:c.user_id,w=c.user_id===t;n.set(f,{status:c.status,id:c.id,initiatedByMe:w}),c.status==="pending"?w||r.push(c):c.status==="accepted"&&o.push(f)}),this.friendshipsByUserIdSubject.next(n),this.friendsSubject.next(o),r.length>0?this.loadUserDetailsForRequests(r):this.pendingRequestsSubject.next([])}loadUserDetailsForRequests(e){let t=e.map(n=>n.user_id);B(this.supabase.from("users").select("id, username, full_name, avatar_url").in("id",t)).subscribe({next:({data:n,error:r})=>{if(r){console.error("Error loading user details:",r);return}if(!n)return;let o=new Map;n.forEach(f=>{o.set(f.id,f)});let c=e.map(f=>a(s({},f),{users:o.get(f.user_id)}));this.pendingRequestsSubject.next(c)}})}setupRealtimeSubscriptions(e){this.cleanupSubscriptions(),this.friendRequestsSubscription=this.supabase.channel("friendship-changes").on("postgres_changes",{event:"*",schema:"public",table:"friendships",filter:`friend_id=eq.${e}`},t=>{console.log("Friendship change (as recipient):",t),this.loadAllFriendships(e)}).on("postgres_changes",{event:"*",schema:"public",table:"friendships",filter:`user_id=eq.${e}`},t=>{console.log("Friendship change (as sender):",t),this.loadAllFriendships(e)}).subscribe()}cleanupSubscriptions(){this.friendRequestsSubscription&&(this.supabase.removeChannel(this.friendRequestsSubscription),this.friendRequestsSubscription=null),this.friendshipUpdatesSubscription&&(this.supabase.removeChannel(this.friendshipUpdatesSubscription),this.friendshipUpdatesSubscription=null)}sendFriendRequest(e){let t=this.authService.user?.id;return t?t===e?k(()=>new Error("You cannot send a friend request to yourself")):this.getFriendshipStatus(e).pipe(Y(n=>n?k(()=>new Error("A friendship relationship already exists")):B(this.supabase.from("friendships").insert({user_id:t,friend_id:e,status:"pending"}).select("*")).pipe(Y(({data:r,error:o})=>{if(o)throw o;if(!r||r.length===0)throw new Error("Failed to create friendship");return this.notificationService.createNotification({userId:e,type:"friend_request",content:"sent you a friend request",actorId:t,resourceId:r[0].id,resourceType:"friendship",read:!1}).pipe(T(()=>(this.updateLocalFriendshipState(e,r[0].id,"pending",!0),r[0])))}))),U(n=>(console.error("Error sending friend request:",n),k(()=>n)))):k(()=>new Error("You must be logged in to send friend requests"))}acceptFriendRequest(e){let t=this.authService.user?.id;return t?B(this.supabase.from("friendships").select("*").eq("id",e).single()).pipe(Y(({data:n,error:r})=>{if(r)throw r;if(!n)throw new Error("Friendship not found");return n.friend_id!==t?k(()=>new Error("You cannot accept a friend request that was not sent to you")):B(this.supabase.from("friendships").update({status:"accepted",updated_at:new Date}).eq("id",e).select("*")).pipe(Y(({data:o,error:c})=>{if(c)throw c;if(!o||o.length===0)throw new Error("Failed to update friendship");return this.updateLocalFriendshipState(n.user_id,e,"accepted",!1),this.notificationService.createNotification({userId:n.user_id,type:"friend_accepted",content:"accepted your friend request",actorId:t,resourceId:e,resourceType:"friendship",read:!1}).pipe(T(()=>o[0]))}))}),U(n=>(console.error("Error accepting friend request:",n),k(()=>n)))):k(()=>new Error("You must be logged in to accept friend requests"))}rejectFriendRequest(e){let t=this.authService.user?.id;return t?B(this.supabase.from("friendships").select("*").eq("id",e).single()).pipe(Y(({data:n,error:r})=>{if(r)throw r;if(!n)throw new Error("Friendship not found");return n.friend_id!==t?k(()=>new Error("You cannot reject a friend request that was not sent to you")):B(this.supabase.from("friendships").update({status:"rejected",updated_at:new Date}).eq("id",e).select("*")).pipe(T(({data:o,error:c})=>{if(c)throw c;if(!o||o.length===0)throw new Error("Failed to update friendship");return this.updateLocalFriendshipState(n.user_id,e,"rejected",!1),o[0]}))}),U(n=>(console.error("Error rejecting friend request:",n),k(()=>n)))):k(()=>new Error("You must be logged in to reject friend requests"))}removeFriendship(e){let t=this.authService.user?.id;return t?B(this.supabase.from("friendships").select("id").or(`user_id.eq.${t},friend_id.eq.${t}`).or(`user_id.eq.${e},friend_id.eq.${e}`).limit(1)).pipe(Y(({data:n,error:r})=>{if(r)throw r;if(!n||n.length===0)throw new Error("Friendship not found");let o=n[0].id;return B(this.supabase.from("friendships").delete().eq("id",o))}),T(({error:n})=>{if(n)throw n;this.updateLocalFriendshipState(e,"",null,!1)}),U(n=>(console.error("Error removing friendship:",n),k(()=>n)))):k(()=>new Error("You must be logged in to remove friendships"))}updateLocalFriendshipState(e,t,n,r){let o=this.friendshipsByUserIdSubject.getValue(),c=new Map(o);if(n===null?c.delete(e):c.set(e,{status:n,id:t,initiatedByMe:r}),this.friendshipsByUserIdSubject.next(c),n==="accepted"){let f=this.friendsSubject.getValue();f.includes(e)||this.friendsSubject.next([...f,e])}else{let f=this.friendsSubject.getValue();this.friendsSubject.next(f.filter(w=>w!==e))}if(!(n==="pending"&&!r)){let f=this.pendingRequestsSubject.getValue();this.pendingRequestsSubject.next(f.filter(w=>w.user_id!==e))}}getFriends(){return this.friendsSubject.asObservable()}get pendingFriendRequests$(){return this.pendingRequestsSubject.asObservable()}get friends$(){return this.friendsSubject.asObservable()}get friendshipsByUserId$(){return this.friendshipsByUserIdSubject.asObservable()}getPendingFriendRequests(){return this.pendingFriendRequests$}getFriendshipStatus(e){return this.friendshipsByUserId$.pipe(T(t=>t.has(e)?t.get(e):null))}static \u0275fac=function(t){return new(t||i)(N(ne),N(be))};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};function Dr(i,e){i&1&&(d(0,"div",4),P(1,"div",5),d(2,"p"),x(3,"Loading profile..."),l()())}function Ur(i,e){if(i&1){let t=V();d(0,"div",6)(1,"p"),x(2,"Sorry, we couldn't load this profile. Please try again later."),l(),d(3,"button",7),E("click",function(){j(t);let r=_();return z(r.ngOnInit())}),x(4,"Retry"),l()()}}function jr(i,e){if(i&1){let t=V();d(0,"div",34)(1,"div",35),Lt(),d(2,"svg",36),P(3,"path",37)(4,"circle",38),l()(),qt(),d(5,"div",39)(6,"app-profile-picture-uploader",40),E("pictureChanged",function(r){j(t);let o=_(2);return z(o.onProfilePictureChanged(r))}),l()()()}}function zr(i,e){if(i&1&&(d(0,"p",41),x(1),l()),i&2){let t=_(2);p(),L(t.profile.bio)}}function Br(i,e){i&1&&(d(0,"button",42),x(1,"Edit Profile"),l())}function $r(i,e){if(i&1&&(d(0,"span"),x(1),l()),i&2){let t=_(4);p(),L(t.getFriendButtonText())}}function Yr(i,e){i&1&&P(0,"span",47)}function Vr(i,e){if(i&1){let t=V();d(0,"button",45),E("click",function(){j(t);let r=_(3);return z(r.onFriendButtonClick())}),y(1,$r,2,1,"span",25)(2,Yr,1,0,"span",46),l()}if(i&2){let t=_(3);Vt(t.getFriendButtonClass()),m("disabled",t.isFriendActionLoading||t.friendshipStatus===t.FriendshipStatus.PENDING&&t.isInitiator),p(),m("ngIf",!t.isFriendActionLoading),p(),m("ngIf",t.isFriendActionLoading)}}function Hr(i,e){i&1&&(d(0,"span"),x(1,"Accept"),l())}function Gr(i,e){i&1&&P(0,"span",47)}function Jr(i,e){i&1&&(d(0,"span"),x(1,"Reject"),l())}function Wr(i,e){i&1&&P(0,"span",47)}function Kr(i,e){if(i&1){let t=V();d(0,"div",48)(1,"button",49),E("click",function(){j(t);let r=_(3);return z(r.acceptFriendRequest())}),y(2,Hr,2,0,"span",25)(3,Gr,1,0,"span",46),l(),d(4,"button",50),E("click",function(){j(t);let r=_(3);return z(r.rejectFriendRequest())}),y(5,Jr,2,0,"span",25)(6,Wr,1,0,"span",46),l()()}if(i&2){let t=_(3);p(),m("disabled",t.isFriendActionLoading),p(),m("ngIf",!t.isFriendActionLoading),p(),m("ngIf",t.isFriendActionLoading),p(),m("disabled",t.isFriendActionLoading),p(),m("ngIf",!t.isFriendActionLoading),p(),m("ngIf",t.isFriendActionLoading)}}function Xr(i,e){if(i&1&&(we(0),y(1,Vr,3,5,"button",43)(2,Kr,7,6,"div",44),Oe()),i&2){let t=_(2);p(),m("ngIf",t.friendshipStatus!==t.FriendshipStatus.PENDING||t.isInitiator),p(),m("ngIf",t.friendshipStatus===t.FriendshipStatus.PENDING&&!t.isInitiator)}}function Zr(i,e){i&1&&(d(0,"button",51),x(1,"Message"),l())}function Qr(i,e){if(i&1){let t=V();d(0,"div",52)(1,"app-create-post",53),E("postCreated",function(r){j(t);let o=_(2);return z(o.handlePostCreated(r))}),l()()}}function eo(i,e){i&1&&(d(0,"div",54)(1,"p"),x(2,"No posts yet"),l()())}function to(i,e){if(i&1&&(d(0,"div",55),P(1,"app-post-card",56),l()),i&2){let t=e.$implicit;p(),m("post",t)}}function io(i,e){if(i&1&&(d(0,"div",8)(1,"div",9),P(2,"div",10),d(3,"div",11)(4,"div",12),P(5,"img",13),y(6,jr,7,0,"div",14),l(),d(7,"div",15)(8,"h1",16),x(9),l(),d(10,"p",17),x(11),l(),y(12,zr,2,1,"p",18),d(13,"div",19)(14,"div",20)(15,"span",21),x(16),l(),d(17,"span",22),x(18,"Posts"),l()()()(),d(19,"div",23),y(20,Br,2,0,"button",24)(21,Xr,3,2,"ng-container",25)(22,Zr,2,0,"button",26),l()()(),d(23,"div",27)(24,"button",28),x(25,"Posts"),l(),d(26,"button",29),x(27,"Media"),l(),d(28,"button",29),x(29,"Likes"),l()(),y(30,Qr,2,0,"div",30),d(31,"div",31),y(32,eo,3,0,"div",32)(33,to,2,1,"div",33),l()()),i&2){let t=_();p(5),m("src",t.profile.avatarUrl||"/assets/default-avatar.png",ae),p(),m("ngIf",t.isCurrentUser),p(3),L(t.profile.fullName),p(2),L("@"+t.profile.username),p(),m("ngIf",t.profile.bio),p(4),L(t.posts.length),p(4),m("ngIf",t.isCurrentUser),p(),m("ngIf",!t.isCurrentUser&&t.authService.isAuthenticated()),p(),m("ngIf",!t.isCurrentUser&&t.friendshipStatus===t.FriendshipStatus.ACCEPTED),p(8),m("ngIf",t.isCurrentUser),p(2),m("ngIf",t.posts.length===0),p(),m("ngForOf",t.posts)}}var Ye=class i{constructor(e,t,n,r,o,c,f){this.route=e;this.router=t;this.userService=n;this.postService=r;this.authService=o;this.friendshipService=c;this.sideNavService=f}profile=null;posts=[];feedStyle="profile";isLoading=!0;isError=!1;isCurrentUser=!1;isSidebarCollapsed=!1;friendshipStatusSubscription=null;FriendshipStatus=$e;friendshipStatus=null;friendshipId=null;isInitiator=!1;isFriendActionLoading=!1;sidebarSubscription=null;ngOnInit(){this.sidebarSubscription=this.sideNavService.sidebarState.subscribe(e=>{this.isSidebarCollapsed=e}),this.route.paramMap.pipe(Y(e=>{let t=e.get("username");return t?t==="me"?(this.isCurrentUser=!0,this.userService.getCurrentUserProfile()):this.userService.getUserByUsername(t).pipe(Y(n=>n?(this.isCurrentUser=this.authService.user?.id===n.id,D(n)):(this.router.navigate(["/"]),D(null)))):D(null)})).subscribe({next:e=>{this.profile=e,e?(this.loadUserPosts(e.username),!this.isCurrentUser&&this.authService.isAuthenticated()&&(this.friendshipStatusSubscription=this.friendshipService.friendshipsByUserId$.subscribe(t=>{if(this.profile&&t.has(this.profile.id)){let n=t.get(this.profile.id);this.friendshipStatus=n.status,this.friendshipId=n.id,this.isInitiator=n.initiatedByMe}else this.profile&&(this.friendshipStatus=null,this.friendshipId=null,this.isInitiator=!1)}),this.checkFriendshipStatus(e.id))):this.isLoading=!1},error:e=>{console.error("Error loading profile:",e),this.isLoading=!1,this.isError=!0}})}loadUserPosts(e){this.postService.getPostsByUsername(e).subscribe({next:t=>{this.posts=t,this.isLoading=!1},error:t=>{console.error("Error loading posts:",t),this.isLoading=!1,this.isError=!0}})}handlePostCreated(e){this.profile&&this.loadUserPosts(this.profile.username)}checkFriendshipStatus(e){this.friendshipService.getFriendshipStatus(e).subscribe({next:t=>{t?(this.friendshipStatus=t.status,this.friendshipId=t.id,this.isInitiator=t.initiatedByMe):(this.friendshipStatus=null,this.friendshipId=null)},error:t=>{console.error("Error checking friendship status:",t)}})}sendFriendRequest(){!this.profile||!this.profile.id||this.isFriendActionLoading||(this.isFriendActionLoading=!0,this.friendshipService.sendFriendRequest(this.profile.id).pipe(K(()=>this.isFriendActionLoading=!1)).subscribe({next:e=>{this.friendshipStatus="pending",this.friendshipId=e.id,this.isInitiator=!0},error:e=>{console.error("Error sending friend request:",e)}}))}acceptFriendRequest(){!this.friendshipId||this.isFriendActionLoading||(this.isFriendActionLoading=!0,this.friendshipService.acceptFriendRequest(this.friendshipId).pipe(K(()=>this.isFriendActionLoading=!1)).subscribe({next:e=>{this.friendshipStatus="accepted"},error:e=>{console.error("Error accepting friend request:",e)}}))}rejectFriendRequest(){!this.friendshipId||this.isFriendActionLoading||(this.isFriendActionLoading=!0,this.friendshipService.rejectFriendRequest(this.friendshipId).pipe(K(()=>this.isFriendActionLoading=!1)).subscribe({next:e=>{this.friendshipStatus="rejected"},error:e=>{console.error("Error rejecting friend request:",e)}}))}removeFriendship(){!this.profile||!this.profile.id||this.isFriendActionLoading||(this.isFriendActionLoading=!0,this.friendshipService.removeFriendship(this.profile.id).pipe(K(()=>this.isFriendActionLoading=!1)).subscribe({next:()=>{this.friendshipStatus=null,this.friendshipId=null},error:e=>{console.error("Error removing friendship:",e)}}))}getFriendButtonText(){switch(this.friendshipStatus){case"pending":return this.isInitiator?"Friend Request Sent":"Respond to Request";case"accepted":return"Friends";case"rejected":return"Request Rejected";default:return"Add Friend"}}getFriendButtonClass(){switch(this.friendshipStatus){case"pending":return this.isInitiator?"btn-disabled":"btn-primary";case"accepted":return"btn-success";case"rejected":return"btn-warning";default:return"btn-primary"}}onFriendButtonClick(){if(!this.isFriendActionLoading)switch(this.friendshipStatus){case"pending":this.isInitiator;break;case"accepted":confirm("Are you sure you want to remove this friend?")&&this.removeFriendship();break;case null:this.sendFriendRequest();break}}onProfilePictureChanged(e){if(!this.profile)return;let t=e?.url||null;this.profile.avatarUrl=t??void 0,this.userService.updateUserProfilePicture(this.profile.id,t).subscribe({next:n=>{n&&console.log("Profile picture updated successfully")},error:n=>{console.error("Error updating profile picture:",n)}})}static \u0275fac=function(t){return new(t||i)(M(Zt),M(ei),M(fe),M(me),M(ne),M(xe),M(ge))};static \u0275cmp=H({type:i,selectors:[["app-profile"]],standalone:!0,features:[G],decls:5,vars:5,consts:[[1,"profile-container"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","profile-content",4,"ngIf"],[1,"loading-container"],[1,"loading-spinner"],[1,"error-container"],[1,"retry-button",3,"click"],[1,"profile-content"],[1,"profile-header"],[1,"profile-banner"],[1,"profile-info"],[1,"profile-avatar"],["alt","Profile picture",3,"src"],["class","avatar-update-overlay",4,"ngIf"],[1,"profile-details"],[1,"profile-name"],[1,"profile-username"],["class","profile-bio",4,"ngIf"],[1,"profile-stats"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"],[1,"profile-actions"],["class","edit-profile-btn","routerLink","/settings",4,"ngIf"],[4,"ngIf"],["class","message-btn",4,"ngIf"],[1,"profile-tabs"],[1,"tab-btn","active"],[1,"tab-btn"],["class","create-post-wrapper",4,"ngIf"],[1,"posts-feed"],["class","empty-posts",4,"ngIf"],["class","post-card-item",4,"ngFor","ngForOf"],[1,"avatar-update-overlay"],[1,"camera-icon-wrapper"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"camera-icon"],["d","M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"],["cx","12","cy","13","r","4"],[1,"hidden-uploader"],[3,"pictureChanged"],[1,"profile-bio"],["routerLink","/settings",1,"edit-profile-btn"],["class","friend-btn",3,"class","disabled","click",4,"ngIf"],["class","friend-request-actions",4,"ngIf"],[1,"friend-btn",3,"click","disabled"],["class","loading-spinner-sm",4,"ngIf"],[1,"loading-spinner-sm"],[1,"friend-request-actions"],[1,"accept-btn",3,"click","disabled"],[1,"reject-btn",3,"click","disabled"],[1,"message-btn"],[1,"create-post-wrapper"],[3,"postCreated"],[1,"empty-posts"],[1,"post-card-item"],[3,"post"]],template:function(t,n){t&1&&(P(0,"app-side-nav"),d(1,"div",0),y(2,Dr,4,0,"div",1)(3,Ur,5,0,"div",2)(4,io,34,12,"div",3),l()),t&2&&(p(),pe("sidebar-collapsed",n.isSidebarCollapsed),p(),m("ngIf",n.isLoading),p(),m("ngIf",n.isError),p(),m("ngIf",!n.isLoading&&!n.isError&&n.profile))},dependencies:[J,le,te,Te,Ae,qe,Le,ve,ki],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;background-color:var(--background-color);min-height:100vh;font-family:var(--font-sans)}.profile-container[_ngcontent-%COMP%]{margin-left:250px;transition:margin-left var(--transition-normal)}.profile-container.sidebar-collapsed[_ngcontent-%COMP%]{margin-left:68px}@media (max-width: 768px){.profile-container[_ngcontent-%COMP%]{margin-left:68px}}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 0}.loading-container[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:3px solid var(--hover-color);border-top:3px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);opacity:.7;font-size:16px;font-weight:500}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{background-color:rgba(var(--error-color-rgb, 229, 57, 53),.1);border:1px solid rgba(var(--error-color-rgb, 229, 57, 53),.2);border-radius:var(--radius-md);padding:20px;margin:40px auto;max-width:600px;text-align:center}.error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--error-color);margin-bottom:16px;font-size:15px}.error-container[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]{background-color:var(--error-color);color:#fff;border:none;border-radius:var(--radius-md);padding:10px 20px;cursor:pointer;font-weight:500;font-size:14px;transition:all var(--transition-fast)}.error-container[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]:hover{opacity:.9;transform:translateY(-2px)}.error-container[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]:active{transform:translateY(0)}.profile-content[_ngcontent-%COMP%]{margin:0 auto;max-width:800px;padding:24px}@media (max-width: 860px){.profile-content[_ngcontent-%COMP%]{padding:16px}}.profile-header[_ngcontent-%COMP%]{background-color:var(--card-background);border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-card);margin-bottom:24px;border:1px solid var(--border-color);animation:_ngcontent-%COMP%_slideDown .4s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.profile-banner[_ngcontent-%COMP%]{height:180px;background-color:var(--primary-color);background-image:linear-gradient(120deg,var(--primary-color) 0%,var(--accent-color) 100%);position:relative;overflow:hidden}.profile-banner[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:0;right:0;height:70px;background:linear-gradient(to top,rgba(0,0,0,.1),transparent)}.profile-info[_ngcontent-%COMP%]{display:flex;padding:0 20px 20px;position:relative}@media (max-width: 768px){.profile-info[_ngcontent-%COMP%]{flex-direction:column;align-items:center;text-align:center}}.profile-avatar[_ngcontent-%COMP%]{margin-top:-50px;margin-right:20px;position:relative;z-index:2;width:120px;height:120px;border-radius:50%;overflow:hidden}.profile-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border:4px solid var(--card-background);background-color:var(--hover-color);box-shadow:var(--shadow);transition:transform var(--transition-fast)}.avatar-update-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;opacity:0;transition:opacity var(--transition-normal);background:#0009;cursor:pointer}.camera-icon-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:40px;height:40px}.camera-icon[_ngcontent-%COMP%]{width:100%;height:100%;color:#fff}.hidden-uploader[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;z-index:10}.avatar-update-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;opacity:0;transition:opacity var(--transition-normal);background:#00000080;border-radius:50%;overflow:hidden}.avatar-update-overlay[_ngcontent-%COMP%]:hover{opacity:1}.profile-details[_ngcontent-%COMP%]{flex:1;padding-top:16px}.profile-name[_ngcontent-%COMP%]{font-size:28px;font-weight:700;margin:0 0 4px;color:var(--text-color)}.profile-username[_ngcontent-%COMP%]{font-size:16px;color:var(--text-color);opacity:.7;margin:0 0 12px}.profile-bio[_ngcontent-%COMP%]{font-size:15px;line-height:1.5;color:var(--text-color);margin-bottom:16px;max-width:600px}.profile-stats[_ngcontent-%COMP%]{display:flex;gap:24px;margin-top:16px}@media (max-width: 768px){.profile-stats[_ngcontent-%COMP%]{justify-content:center}}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;transition:transform var(--transition-fast)}.stat-item[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.stat-item[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:var(--text-color)}.stat-item[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color);opacity:.7}.profile-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:20px;align-self:flex-end}@media (max-width: 768px){.profile-actions[_ngcontent-%COMP%]{align-self:center;margin-top:16px}}.edit-profile-btn[_ngcontent-%COMP%], .message-btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:var(--radius-full);font-size:14px;font-weight:500;cursor:pointer;transition:all var(--transition-fast);background-color:var(--hover-color);color:var(--text-color);border:1px solid var(--border-color)}.edit-profile-btn[_ngcontent-%COMP%]:hover, .message-btn[_ngcontent-%COMP%]:hover{background-color:var(--secondary-color);transform:translateY(-2px);box-shadow:var(--shadow)}.friend-btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:var(--radius-full);font-size:14px;font-weight:500;cursor:pointer;transition:all var(--transition-fast);border:none;display:flex;align-items:center;justify-content:center;min-width:120px}.friend-btn.btn-primary[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff}.friend-btn.btn-primary[_ngcontent-%COMP%]:hover{background-color:var(--primary-dark);transform:translateY(-2px);box-shadow:var(--shadow)}.friend-btn.btn-success[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.friend-btn.btn-success[_ngcontent-%COMP%]:hover{opacity:.9;transform:translateY(-2px);box-shadow:var(--shadow)}.friend-btn.btn-warning[_ngcontent-%COMP%]{background-color:var(--warning-color);color:#fff}.friend-btn.btn-warning[_ngcontent-%COMP%]:hover{opacity:.9;transform:translateY(-2px);box-shadow:var(--shadow)}.friend-btn.btn-disabled[_ngcontent-%COMP%]{background-color:var(--hover-color);color:var(--text-color);opacity:.7;cursor:not-allowed}.friend-btn.btn-disabled[_ngcontent-%COMP%]:hover{transform:none;box-shadow:none}.friend-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.friend-btn[_ngcontent-%COMP%]   .loading-spinner-sm[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:6px}.friend-request-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.friend-request-actions[_ngcontent-%COMP%]   .accept-btn[_ngcontent-%COMP%], .friend-request-actions[_ngcontent-%COMP%]   .reject-btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:var(--radius-full);font-size:14px;font-weight:500;cursor:pointer;transition:all var(--transition-fast);border:none}.friend-request-actions[_ngcontent-%COMP%]   .accept-btn[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.friend-request-actions[_ngcontent-%COMP%]   .accept-btn[_ngcontent-%COMP%]:hover{opacity:.9;transform:translateY(-2px);box-shadow:var(--shadow)}.friend-request-actions[_ngcontent-%COMP%]   .reject-btn[_ngcontent-%COMP%]{background-color:var(--error-color);color:#fff}.friend-request-actions[_ngcontent-%COMP%]   .reject-btn[_ngcontent-%COMP%]:hover{opacity:.9;transform:translateY(-2px);box-shadow:var(--shadow)}.friend-request-actions[_ngcontent-%COMP%]   .loading-spinner-sm[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.profile-tabs[_ngcontent-%COMP%]{display:flex;background-color:var(--card-background);border-radius:var(--radius-lg);box-shadow:var(--shadow-card);margin-bottom:24px;overflow:hidden;border:1px solid var(--border-color);animation:_ngcontent-%COMP%_slideUp .4s ease;animation-delay:.1s;animation-fill-mode:both}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.tab-btn[_ngcontent-%COMP%]{flex:1;padding:14px;background:none;border:none;font-size:15px;font-weight:500;color:var(--text-color);opacity:.7;cursor:pointer;transition:all var(--transition-fast);border-bottom:3px solid transparent;position:relative;overflow:hidden}.tab-btn[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);opacity:1}.tab-btn.active[_ngcontent-%COMP%]{color:var(--primary-color);border-bottom-color:var(--primary-color);opacity:1;font-weight:600}.tab-btn[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:0;width:100%;height:3px;background-color:var(--primary-color);transform:translate(-100%);transition:transform .3s ease}.tab-btn[_ngcontent-%COMP%]:hover:after{transform:translate(0)}.tab-btn.active[_ngcontent-%COMP%]:after{transform:translate(0)}.create-post-wrapper[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-card);animation:_ngcontent-%COMP%_slideUp .4s ease;animation-delay:.2s;animation-fill-mode:both}.empty-posts[_ngcontent-%COMP%]{background-color:var(--card-background);border-radius:var(--radius-lg);padding:40px;text-align:center;box-shadow:var(--shadow-card);border:1px solid var(--border-color);animation:_ngcontent-%COMP%_slideUp .4s ease;animation-delay:.3s;animation-fill-mode:both}.empty-posts[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);opacity:.7;font-size:16px}.empty-posts[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:before{content:"\\1f4ed";display:block;font-size:36px;margin-bottom:16px}.post-card-item[_ngcontent-%COMP%]{margin-bottom:16px;display:block;animation:_ngcontent-%COMP%_slideUp .4s ease;animation-delay:calc(.3s + var(--index, 0) * .1s);animation-fill-mode:both}']})};var Yi=[{path:"Home",component:Be},{path:"Login",component:Ri},{path:"",redirectTo:"Home",pathMatch:"full"},{path:"signin",loadComponent:()=>import("./chunk-LOIR5ZCA.js").then(i=>i.SignInComponent)},{path:"signup",loadComponent:()=>import("./chunk-JW5EUJZS.js").then(i=>i.SignUpComponent)},{path:"bookmarks",loadComponent:()=>import("./chunk-YQYE6ENV.js").then(i=>i.BookmarksComponent)},{path:"profile/:username",component:Ye},{path:"profile",redirectTo:"/profile/me",pathMatch:"full"},{path:"search",loadComponent:()=>import("./chunk-NJXFMRXV.js").then(i=>i.SearchResultsComponent)},{path:"post/:id",loadComponent:()=>import("./chunk-EYAP7EKA.js").then(i=>i.PostDetailComponent)},{path:"settings",loadComponent:()=>import("./chunk-MKZSDVUI.js").then(i=>i.SettingsComponent)},{path:"**",redirectTo:""}];var Se="PERFORM_ACTION",no="REFRESH",Ki="RESET",Xi="ROLLBACK",Zi="COMMIT",Qi="SWEEP",en="TOGGLE_ACTION",ro="SET_ACTIONS_ACTIVE",tn="JUMP_TO_STATE",nn="JUMP_TO_ACTION",bt="IMPORT_STATE",rn="LOCK_CHANGES",on="PAUSE_RECORDING",_e=class{constructor(e,t){if(this.action=e,this.timestamp=t,this.type=Se,typeof e.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}},st=class{constructor(){this.type=no}},at=class{constructor(e){this.timestamp=e,this.type=Ki}},dt=class{constructor(e){this.timestamp=e,this.type=Xi}},ct=class{constructor(e){this.timestamp=e,this.type=Zi}},pt=class{constructor(){this.type=Qi}},lt=class{constructor(e){this.id=e,this.type=en}};var ut=class{constructor(e){this.index=e,this.type=tn}},mt=class{constructor(e){this.actionId=e,this.type=nn}},ft=class{constructor(e){this.nextLiftedState=e,this.type=bt}},gt=class{constructor(e){this.status=e,this.type=rn}},ht=class{constructor(e){this.status=e,this.type=on}};var Je=new ye("@ngrx/store-devtools Options"),Vi=new ye("@ngrx/store-devtools Initial Config");function sn(){return null}var oo="NgRx Store DevTools";function so(i){let e={maxAge:!1,monitor:sn,actionSanitizer:void 0,stateSanitizer:void 0,name:oo,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectInZone:!1},t=typeof i=="function"?i():i,n=t.logOnly?{pause:!0,export:!0,test:!0}:!1,r=t.features||n||e.features;r.import===!0&&(r.import="custom");let o=Object.assign({},e,{features:r},t);if(o.maxAge&&o.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${o.maxAge}`);return o}function Hi(i,e){return i.filter(t=>e.indexOf(t)<0)}function an(i){let{computedStates:e,currentStateIndex:t}=i;if(t>=e.length){let{state:r}=e[e.length-1];return r}let{state:n}=e[t];return n}function Ce(i){return new _e(i,+Date.now())}function ao(i,e){return Object.keys(e).reduce((t,n)=>{let r=Number(n);return t[r]=dn(i,e[r],r),t},{})}function dn(i,e,t){return a(s({},e),{action:i(e.action,t)})}function co(i,e){return e.map((t,n)=>({state:cn(i,t.state,n),error:t.error}))}function cn(i,e,t){return i(e,t)}function pn(i){return i.predicate||i.actionsSafelist||i.actionsBlocklist}function po(i,e,t,n){let r=[],o={},c=[];return i.stagedActionIds.forEach((f,w)=>{let b=i.actionsById[f];b&&(w&&xt(i.computedStates[w],b,e,t,n)||(o[f]=b,r.push(f),c.push(i.computedStates[w])))}),a(s({},i),{stagedActionIds:r,actionsById:o,computedStates:c})}function xt(i,e,t,n,r){let o=t&&!t(i,e.action),c=n&&!e.action.type.match(n.map(w=>Gi(w)).join("|")),f=r&&e.action.type.match(r.map(w=>Gi(w)).join("|"));return o||c||f}function Gi(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ln(i){return{ngZone:i?kt(jt):null,connectInZone:i}}var We=(()=>{class i extends Re{static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Dt(i)))(r||i)}})()}static{this.\u0275prov=ee({token:i,factory:i.\u0275fac})}}return i})(),Ve={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},vt=new ye("@ngrx/store-devtools Redux Devtools Extension"),un=(()=>{class i{constructor(t,n,r){this.config=n,this.dispatcher=r,this.zoneConfig=ln(this.config.connectInZone),this.devtoolsExtension=t,this.createActionStreams()}notify(t,n){if(this.devtoolsExtension)if(t.type===Se){if(n.isLocked||n.isPaused)return;let r=an(n);if(pn(this.config)&&xt(r,t,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;let o=this.config.stateSanitizer?cn(this.config.stateSanitizer,r,n.currentStateIndex):r,c=this.config.actionSanitizer?dn(this.config.actionSanitizer,t,n.nextActionId):t;this.sendToReduxDevtools(()=>this.extensionConnection.send(c,o))}else{let r=a(s({},n),{stagedActionIds:n.stagedActionIds,actionsById:this.config.actionSanitizer?ao(this.config.actionSanitizer,n.actionsById):n.actionsById,computedStates:this.config.stateSanitizer?co(this.config.stateSanitizer,n.computedStates):n.computedStates});this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,r,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new it(t=>{let n=this.zoneConfig.connectInZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=n,n.init(),n.subscribe(r=>t.next(r)),n.unsubscribe}):St}createActionStreams(){let t=this.createChangesObservable().pipe(At()),n=t.pipe(ce(b=>b.type===Ve.START)),r=t.pipe(ce(b=>b.type===Ve.STOP)),o=t.pipe(ce(b=>b.type===Ve.DISPATCH),T(b=>this.unwrapAction(b.payload)),Mt(b=>b.type===bt?this.dispatcher.pipe(ce(q=>q.type===ot),wt(1e3),Ft(1e3),T(()=>b),U(()=>D(b)),It(1)):D(b))),f=t.pipe(ce(b=>b.type===Ve.ACTION),T(b=>this.unwrapAction(b.payload))).pipe(Pe(r)),w=o.pipe(Pe(r));this.start$=n.pipe(Pe(r)),this.actions$=this.start$.pipe(Y(()=>f)),this.liftedActions$=this.start$.pipe(Y(()=>w))}unwrapAction(t){return typeof t=="string"?(0,eval)(`(${t})`):t}getExtensionConfig(t){let n={name:t.name,features:t.features,serialize:t.serialize,autoPause:t.autoPause??!1,trace:t.trace??!1,traceLimit:t.traceLimit??75};return t.maxAge!==!1&&(n.maxAge=t.maxAge),n}sendToReduxDevtools(t){try{t()}catch(n){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",n)}}static{this.\u0275fac=function(n){return new(n||i)(N(vt),N(Je),N(We))}}static{this.\u0275prov=ee({token:i,factory:i.\u0275fac})}}return i})(),Ge={type:rt},lo="@ngrx/store-devtools/recompute",uo={type:lo};function mn(i,e,t,n,r){if(n)return{state:t,error:"Interrupted by an error up the chain"};let o=t,c;try{o=i(t,e)}catch(f){c=f.toString(),r.handleError(f)}return{state:o,error:c}}function He(i,e,t,n,r,o,c,f,w){if(e>=i.length&&i.length===o.length)return i;let b=i.slice(0,e),q=o.length-(w?1:0);for(let h=e;h<q;h++){let O=o[h],I=r[O].action,C=b[h-1],S=C?C.state:n,X=C?C.error:void 0,Z=c.indexOf(O)>-1?C:mn(t,I,S,X,f);b.push(Z)}return w&&b.push(i[i.length-1]),b}function mo(i,e){return{monitorState:e(void 0,{}),nextActionId:1,actionsById:{0:Ce(Ge)},stagedActionIds:[0],skippedActionIds:[],committedState:i,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function fo(i,e,t,n,r={}){return o=>(c,f)=>{let{monitorState:w,actionsById:b,nextActionId:q,stagedActionIds:h,skippedActionIds:O,committedState:I,currentStateIndex:C,computedStates:S,isLocked:X,isPaused:$}=c||e;c||(b=Object.create(b));function Z(R){let A=R,se=h.slice(1,A+1);for(let W=0;W<se.length;W++)if(S[W+1].error){A=W,se=h.slice(1,A+1);break}else delete b[se[W]];O=O.filter(W=>se.indexOf(W)===-1),h=[0,...h.slice(A+1)],I=S[A].state,S=S.slice(A),C=C>A?C-A:0}function Q(){b={0:Ce(Ge)},q=1,h=[0],O=[],I=S[C].state,C=0,S=[]}let F=0;switch(f.type){case rn:{X=f.status,F=1/0;break}case on:{$=f.status,$?(h=[...h,q],b[q]=new _e({type:"@ngrx/devtools/pause"},+Date.now()),q++,F=h.length-1,S=S.concat(S[S.length-1]),C===h.length-2&&C++,F=1/0):Q();break}case Ki:{b={0:Ce(Ge)},q=1,h=[0],O=[],I=i,C=0,S=[];break}case Zi:{Q();break}case Xi:{b={0:Ce(Ge)},q=1,h=[0],O=[],C=0,S=[];break}case en:{let{id:R}=f;O.indexOf(R)===-1?O=[R,...O]:O=O.filter(se=>se!==R),F=h.indexOf(R);break}case ro:{let{start:R,end:A,active:se}=f,W=[];for(let Qe=R;Qe<A;Qe++)W.push(Qe);se?O=Hi(O,W):O=[...O,...W],F=h.indexOf(R);break}case tn:{C=f.index,F=1/0;break}case nn:{let R=h.indexOf(f.actionId);R!==-1&&(C=R),F=1/0;break}case Qi:{h=Hi(h,O),O=[],C=Math.min(C,h.length-1);break}case Se:{if(X)return c||e;if($||c&&xt(c.computedStates[C],f,r.predicate,r.actionsSafelist,r.actionsBlocklist)){let A=S[S.length-1];S=[...S.slice(0,-1),mn(o,f.action,A.state,A.error,t)],F=1/0;break}r.maxAge&&h.length===r.maxAge&&Z(1),C===h.length-1&&C++;let R=q++;b[R]=f,h=[...h,R],F=h.length-1;break}case bt:{({monitorState:w,actionsById:b,nextActionId:q,stagedActionIds:h,skippedActionIds:O,committedState:I,currentStateIndex:C,computedStates:S,isLocked:X,isPaused:$}=f.nextLiftedState);break}case rt:{F=0,r.maxAge&&h.length>r.maxAge&&(S=He(S,F,o,I,b,h,O,t,$),Z(h.length-r.maxAge),F=1/0);break}case ot:{if(S.filter(A=>A.error).length>0)F=0,r.maxAge&&h.length>r.maxAge&&(S=He(S,F,o,I,b,h,O,t,$),Z(h.length-r.maxAge),F=1/0);else{if(!$&&!X){C===h.length-1&&C++;let A=q++;b[A]=new _e(f,+Date.now()),h=[...h,A],F=h.length-1,S=He(S,F,o,I,b,h,O,t,$)}S=S.map(A=>a(s({},A),{state:o(A.state,uo)})),C=h.length-1,r.maxAge&&h.length>r.maxAge&&Z(h.length-r.maxAge),F=1/0}break}default:{F=1/0;break}}return S=He(S,F,o,I,b,h,O,t,$),w=n(w,f),{monitorState:w,actionsById:b,nextActionId:q,stagedActionIds:h,skippedActionIds:O,committedState:I,currentStateIndex:C,computedStates:S,isLocked:X,isPaused:$}}}var Ji=(()=>{class i{constructor(t,n,r,o,c,f,w,b){let q=mo(w,b.monitor),h=fo(w,q,f,b.monitor,b),O=nt(nt(n.asObservable().pipe(Tt(1)),o.actions$).pipe(T(Ce)),t,o.liftedActions$).pipe(Pt(Ct)),I=r.pipe(T(h)),C=ln(b.connectInZone),S=new yt(1);this.liftedStateSubscription=O.pipe(Rt(I),Wi(C),Et(({state:Z},[Q,F])=>{let R=F(Z,Q);return Q.type!==Se&&pn(b)&&(R=po(R,b.predicate,b.actionsSafelist,b.actionsBlocklist)),o.notify(Q,R),{state:R,action:Q}},{state:q,action:null})).subscribe(({state:Z,action:Q})=>{if(S.next(Z),Q.type===Se){let F=Q.action;c.next(F)}}),this.extensionStartSubscription=o.start$.pipe(Wi(C)).subscribe(()=>{this.refresh()});let X=S.asObservable(),$=X.pipe(T(an));Object.defineProperty($,"state",{value:oi($,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=t,this.liftedState=X,this.state=$}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(t){this.dispatcher.next(t)}next(t){this.dispatcher.next(t)}error(t){}complete(){}performAction(t){this.dispatch(new _e(t,+Date.now()))}refresh(){this.dispatch(new st)}reset(){this.dispatch(new at(+Date.now()))}rollback(){this.dispatch(new dt(+Date.now()))}commit(){this.dispatch(new ct(+Date.now()))}sweep(){this.dispatch(new pt)}toggleAction(t){this.dispatch(new lt(t))}jumpToAction(t){this.dispatch(new mt(t))}jumpToState(t){this.dispatch(new ut(t))}importState(t){this.dispatch(new ft(t))}lockChanges(t){this.dispatch(new gt(t))}pauseRecording(t){this.dispatch(new ht(t))}static{this.\u0275fac=function(n){return new(n||i)(N(We),N(Re),N(ai),N(un),N(ci),N(zt),N(si),N(Je))}}static{this.\u0275prov=ee({token:i,factory:i.\u0275fac})}}return i})();function Wi({ngZone:i,connectInZone:e}){return t=>e?new it(n=>t.subscribe({next:r=>i.run(()=>n.next(r)),error:r=>i.run(()=>n.error(r)),complete:()=>i.run(()=>n.complete())})):t}var go=new ye("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function ho(i,e){return!!i||e.monitor!==sn}function vo(){let i="__REDUX_DEVTOOLS_EXTENSION__";return typeof window=="object"&&typeof window[i]<"u"?window[i]:null}function fn(i={}){return Nt([un,We,Ji,{provide:Vi,useValue:i},{provide:go,deps:[vt,Je],useFactory:ho},{provide:vt,useFactory:vo},{provide:Je,deps:[Vi],useFactory:so},{provide:pi,deps:[Ji],useFactory:bo},{provide:di,useExisting:We}])}function bo(i){return i.state}var gn={feedPosts:[],userPosts:{},currentPost:null,isLoading:!1,error:null};var hn=g("[Posts] Load Feed"),vn=g("[Posts] Load Feed Success",v()),bn=g("[Posts] Load Feed Failure",v()),xn=g("[Posts] Post Added",v()),_n=g("[Posts] Post Updated",v()),yn=g("[Posts] Post Deleted",v()),Cn=g("[Posts] Create Post",v()),Sn=g("[Posts] Create Post Success",v()),Pn=g("[Posts] Create Post Failure",v()),wn=g("[Posts] Load User Posts",v()),On=g("[Posts] Load User Posts Success",v()),Mn=g("[Posts] Load User Posts Failure",v()),Fn=ie(gn,u(hn,i=>a(s({},i),{isLoading:!0,error:null})),u(vn,(i,{posts:e})=>a(s({},i),{feedPosts:e,isLoading:!1})),u(bn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(xn,(i,{post:e})=>a(s({},i),{feedPosts:[e,...i.feedPosts]})),u(_n,(i,{post:e})=>a(s({},i),{feedPosts:i.feedPosts.map(t=>t.id===e.id?s(s({},t),e):t),currentPost:i.currentPost?.id===e.id?s(s({},i.currentPost),e):i.currentPost})),u(yn,(i,{postId:e})=>a(s({},i),{feedPosts:i.feedPosts.filter(t=>t.id!==e),currentPost:i.currentPost?.id===e?null:i.currentPost})),u(Cn,i=>a(s({},i),{isLoading:!0,error:null})),u(Sn,(i,{post:e})=>a(s({},i),{feedPosts:[e,...i.feedPosts],isLoading:!1})),u(Pn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(wn,i=>a(s({},i),{isLoading:!0,error:null})),u(On,(i,{username:e,posts:t})=>a(s({},i),{userPosts:a(s({},i.userPosts),{[e]:t}),isLoading:!1})),u(Mn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})));var In={byPost:{},byParent:{},isLoading:!1,error:null};var En=ie(In,u(ui,i=>a(s({},i),{isLoading:!0,error:null})),u(mi,(i,{postId:e,comments:t})=>a(s({},i),{byPost:a(s({},i.byPost),{[e]:t}),isLoading:!1})),u(fi,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(gi,i=>a(s({},i),{error:null})),u(hi,(i,{commentId:e,replies:t})=>a(s({},i),{byParent:a(s({},i.byParent),{[e]:t})})),u(vi,(i,{error:e})=>a(s({},i),{error:e})),u(bi,i=>a(s({},i),{isLoading:!0,error:null})),u(xi,(i,{comment:e})=>{if(e.parentId){let t=i.byParent[e.parentId]||[];return a(s({},i),{byParent:a(s({},i.byParent),{[e.parentId]:[e,...t]}),isLoading:!1})}else{let t=i.byPost[e.postId]||[];return a(s({},i),{byPost:a(s({},i.byPost),{[e.postId]:[e,...t]}),isLoading:!1})}}),u(_i,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(yi,i=>a(s({},i),{error:null})),u(Ci,(i,{comment:e})=>{let t=s({},i);return e.postId&&i.byPost[e.postId]&&(t.byPost=a(s({},i.byPost),{[e.postId]:i.byPost[e.postId].map(n=>n.id===e.id?e:n)})),e.parentId&&i.byParent[e.parentId]&&(t.byParent=a(s({},i.byParent),{[e.parentId]:i.byParent[e.parentId].map(n=>n.id===e.id?e:n)})),t}),u(Si,(i,{error:e})=>a(s({},i),{error:e})),u(Pi,i=>a(s({},i),{error:null})),u(wi,(i,{commentId:e,postId:t,parentId:n})=>{let r=s({},i);if(t&&i.byPost[t]&&(r.byPost=a(s({},i.byPost),{[t]:i.byPost[t].filter(c=>c.id!==e)})),n&&i.byParent[n]&&(r.byParent=a(s({},i.byParent),{[n]:i.byParent[n].filter(c=>c.id!==e)})),i.byParent[e]){let o=i.byParent,{[e]:c}=o,f=tt(o,[et(e)]);r.byParent=f}return r}),u(Oi,(i,{error:e})=>a(s({},i),{error:e})),u(Mi,(i,{comment:e})=>{if(e.parentId){let t=i.byParent[e.parentId]||[];return t.some(n=>n.id===e.id)?i:a(s({},i),{byParent:a(s({},i.byParent),{[e.parentId]:[e,...t]})})}else{let t=i.byPost[e.postId]||[];return t.some(n=>n.id===e.id)?i:a(s({},i),{byPost:a(s({},i.byPost),{[e.postId]:[e,...t]})})}}),u(Fi,(i,{comment:e})=>{let t=s({},i);return e.postId&&i.byPost[e.postId]&&(t.byPost=a(s({},i.byPost),{[e.postId]:i.byPost[e.postId].map(n=>n.id===e.id?e:n)})),e.parentId&&i.byParent[e.parentId]&&(t.byParent=a(s({},i.byParent),{[e.parentId]:i.byParent[e.parentId].map(n=>n.id===e.id?e:n)})),t}),u(Ii,(i,{commentId:e,postId:t,parentId:n})=>{let r=s({},i);if(t&&i.byPost[t]&&(r.byPost=a(s({},i.byPost),{[t]:i.byPost[t].filter(c=>c.id!==e)})),n&&i.byParent[n]&&(r.byParent=a(s({},i.byParent),{[n]:i.byParent[n].filter(c=>c.id!==e)})),i.byParent[e]){let o=i.byParent,{[e]:c}=o,f=tt(o,[et(e)]);r.byParent=f}return r}));var An={friends:[],pendingRequests:[],sentRequests:[],friendships:new Map,isLoading:!1,error:null};var Tn=g("[Friendship] Load Friends"),Rn=g("[Friendship] Load Friends Success",v()),kn=g("[Friendship] Load Friends Failure",v()),Nn=g("[Friendship] Load Pending Requests"),Ln=g("[Friendship] Load Pending Requests Success",v()),qn=g("[Friendship] Load Pending Requests Failure",v()),Dn=g("[Friendship] Load Sent Requests"),Un=g("[Friendship] Load Sent Requests Success",v()),jn=g("[Friendship] Load Sent Requests Failure",v()),zn=g("[Friendship] Send Friend Request",v()),Bn=g("[Friendship] Send Friend Request Success",v()),$n=g("[Friendship] Send Friend Request Failure",v()),Yn=g("[Friendship] Accept Friend Request",v()),Vn=g("[Friendship] Accept Friend Request Success",v()),Hn=g("[Friendship] Accept Friend Request Failure",v()),Gn=g("[Friendship] Reject Friend Request",v()),Jn=g("[Friendship] Reject Friend Request Success",v()),Wn=g("[Friendship] Reject Friend Request Failure",v()),Kn=g("[Friendship] Remove Friendship",v()),Xn=g("[Friendship] Remove Friendship Success",v()),Zn=g("[Friendship] Remove Friendship Failure",v()),Ua=g("[Friendship] Check Friendship Status",v()),Qn=g("[Friendship] Update Friendship Status",v()),er=g("[Friendship] Friend Request Received",v()),tr=g("[Friendship] Friend Request Accepted",v()),ir=g("[Friendship] Friend Request Rejected",v()),nr=g("[Friendship] Friendship Removed",v());var rr=ie(An,u(Tn,i=>a(s({},i),{isLoading:!0,error:null})),u(Rn,(i,{friends:e})=>a(s({},i),{friends:e,isLoading:!1})),u(kn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(Nn,i=>a(s({},i),{isLoading:!0,error:null})),u(Ln,(i,{requests:e})=>a(s({},i),{pendingRequests:e,isLoading:!1})),u(qn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(Dn,i=>a(s({},i),{isLoading:!0,error:null})),u(Un,(i,{requests:e})=>a(s({},i),{sentRequests:e,isLoading:!1})),u(jn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(zn,i=>a(s({},i),{isLoading:!0,error:null})),u(Bn,(i,{request:e})=>{let t=new Map(i.friendships);return t.set(e.friendId,{status:"pending",id:e.id,initiatedByMe:!0}),a(s({},i),{sentRequests:[...i.sentRequests,e],friendships:t,isLoading:!1})}),u($n,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(Yn,i=>a(s({},i),{isLoading:!0,error:null})),u(Vn,(i,{request:e})=>{let t=i.pendingRequests.find(o=>o.id===e.id);if(!t)return i;let n=t.userId,r=new Map(i.friendships);return r.set(n,{status:"accepted",id:e.id,initiatedByMe:!1}),a(s({},i),{friends:[...i.friends,n],pendingRequests:i.pendingRequests.filter(o=>o.id!==e.id),friendships:r,isLoading:!1})}),u(Hn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(Gn,i=>a(s({},i),{isLoading:!0,error:null})),u(Jn,(i,{request:e})=>{let t=i.pendingRequests.find(o=>o.id===e.id);if(!t)return i;let n=t.userId,r=new Map(i.friendships);return r.set(n,{status:"rejected",id:e.id,initiatedByMe:!1}),a(s({},i),{pendingRequests:i.pendingRequests.filter(o=>o.id!==e.id),friendships:r,isLoading:!1})}),u(Wn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(Kn,i=>a(s({},i),{isLoading:!0,error:null})),u(Xn,(i,{friendId:e})=>{let t=new Map(i.friendships);return t.delete(e),a(s({},i),{friends:i.friends.filter(n=>n!==e),friendships:t,isLoading:!1})}),u(Zn,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(Qn,(i,{userId:e,status:t,friendshipId:n,initiatedByMe:r})=>{let o=new Map(i.friendships);return t===null?o.delete(e):o.set(e,{status:t,id:n||"",initiatedByMe:r}),a(s({},i),{friendships:o})}),u(er,(i,{request:e})=>{if(i.pendingRequests.some(n=>n.id===e.id))return i;let t=new Map(i.friendships);return t.set(e.userId,{status:"pending",id:e.id,initiatedByMe:!1}),a(s({},i),{pendingRequests:[...i.pendingRequests,e],friendships:t})}),u(tr,(i,{request:e})=>{let t=i.sentRequests.find(r=>r.id===e.id);if(!t)return i;let n=new Map(i.friendships);return n.set(t.friendId,{status:"accepted",id:e.id,initiatedByMe:!0}),a(s({},i),{friends:[...i.friends,t.friendId],sentRequests:i.sentRequests.filter(r=>r.id!==e.id),friendships:n})}),u(ir,(i,{request:e})=>{let t=new Map(i.friendships),n=i.sentRequests.find(r=>r.id===e.id);return n?(t.set(n.friendId,{status:"rejected",id:e.id,initiatedByMe:!0}),a(s({},i),{sentRequests:i.sentRequests.filter(r=>r.id!==e.id),friendships:t})):i}),u(nr,(i,{userId:e})=>{let t=new Map(i.friendships);return t.delete(e),a(s({},i),{friends:i.friends.filter(n=>n!==e),friendships:t})}));var or={items:[],unreadCount:0,isLoading:!1,error:null};var sr=g("[Notifications] Load Notifications"),ar=g("[Notifications] Load Notifications Success",v()),dr=g("[Notifications] Load Notifications Failure",v()),cr=g("[Notifications] Load Unread Count"),pr=g("[Notifications] Load Unread Count Success",v()),lr=g("[Notifications] Load Unread Count Failure",v()),ur=g("[Notifications] Mark As Read",v()),mr=g("[Notifications] Mark As Read Success",v()),fr=g("[Notifications] Mark As Read Failure",v()),gr=g("[Notifications] Mark All As Read"),hr=g("[Notifications] Mark All As Read Success"),vr=g("[Notifications] Mark All As Read Failure",v()),br=g("[Notifications] Notification Received",v()),xr=g("[Notifications] Notification Updated",v());var _r=ie(or,u(sr,i=>a(s({},i),{isLoading:!0,error:null})),u(ar,(i,{notifications:e})=>a(s({},i),{items:e,isLoading:!1,unreadCount:e.filter(t=>!t.read).length})),u(dr,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(cr,i=>a(s({},i),{isLoading:!0,error:null})),u(pr,(i,{count:e})=>a(s({},i),{unreadCount:e,isLoading:!1})),u(lr,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(ur,i=>a(s({},i),{isLoading:!0,error:null})),u(mr,(i,{notificationId:e})=>{let t=i.items.map(n=>n.id===e?a(s({},n),{read:!0}):n);return a(s({},i),{items:t,unreadCount:t.filter(n=>!n.read).length,isLoading:!1})}),u(fr,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(gr,i=>a(s({},i),{isLoading:!0,error:null})),u(hr,i=>a(s({},i),{items:i.items.map(e=>a(s({},e),{read:!0})),unreadCount:0,isLoading:!1})),u(vr,(i,{error:e})=>a(s({},i),{error:e,isLoading:!1})),u(br,(i,{notification:e})=>i.items.some(t=>t.id===e.id)?i:a(s({},i),{items:[e,...i.items],unreadCount:i.unreadCount+(e.read?0:1)})),u(xr,(i,{notification:e})=>{let t=i.items.find(r=>r.id===e.id)?.read===!1,n=e.read;return a(s({},i),{items:i.items.map(r=>r.id===e.id?e:r),unreadCount:i.unreadCount+(t&&n?-1:0)})}));var yr={sidebar:{isCollapsed:!0},modals:{createPost:!1,search:!1},toast:{show:!1,message:"",toastType:"info"}};var Cr=g("[UI] Toggle Sidebar"),Sr=g("[UI] Set Sidebar State",v()),Pr=g("[UI] Open Modal",v()),wr=g("[UI] Close Modal",v()),Or=g("[UI] Show Toast",v()),Mr=g("[UI] Hide Toast");var Fr=ie(yr,u(Cr,i=>a(s({},i),{sidebar:a(s({},i.sidebar),{isCollapsed:!i.sidebar.isCollapsed})})),u(Sr,(i,{isCollapsed:e})=>a(s({},i),{sidebar:a(s({},i.sidebar),{isCollapsed:e})})),u(Pr,(i,{modalId:e})=>a(s({},i),{modals:a(s({},i.modals),{[e]:!0})})),u(wr,(i,{modalId:e})=>a(s({},i),{modals:a(s({},i.modals),{[e]:!1})})),u(Or,(i,{message:e,toastType:t})=>a(s({},i),{toast:{show:!0,message:e,toastType:t}})),u(Mr,i=>a(s({},i),{toast:a(s({},i.toast),{show:!1})})));var Ir={providers:[Jt({eventCoalescing:!0}),ti(Yi),Kt(),li({userData:Ai,auth:Ti,posts:Fn,comments:En,friendship:rr,notifications:_r,ui:Fr}),fn({maxAge:25,connectInZone:!0})]};var So=i=>["/profile",i];function Po(i,e){if(i&1&&(d(0,"span",9),x(1),l()),i&2){let t=_();p(),L(t.friendRequestCount)}}function wo(i,e){if(i&1&&(d(0,"span",17),x(1),l()),i&2){let t=_(2);p(),L(t.friendRequestCount)}}function Oo(i,e){i&1&&(d(0,"div",21),P(1,"div",22),d(2,"span"),x(3,"Loading friend requests..."),l()())}function Mo(i,e){i&1&&(d(0,"div",23)(1,"p"),x(2,"No pending friend requests"),l()())}function Fo(i,e){if(i&1&&(d(0,"span",37),x(1),l()),i&2){let t=_().$implicit,n=_(4);p(),L(n.formatTimeAgo(t.timestamp))}}function Io(i,e){i&1&&(d(0,"span"),x(1,"Accept"),l())}function Eo(i,e){i&1&&P(0,"span",38)}function Ao(i,e){i&1&&(d(0,"span"),x(1,"Reject"),l())}function To(i,e){i&1&&P(0,"span",38)}function Ro(i,e){if(i&1){let t=V();d(0,"li",26)(1,"div",27),P(2,"img",28),d(3,"div",29)(4,"span",30),x(5),l(),d(6,"span",31),x(7),l(),y(8,Fo,2,1,"span",32),l()(),d(9,"div",33)(10,"button",34),E("click",function(){let r=j(t).$implicit,o=_(4);return z(o.acceptFriendRequest(r.id))}),y(11,Io,2,0,"span",16)(12,Eo,1,0,"span",35),l(),d(13,"button",36),E("click",function(){let r=j(t).$implicit,o=_(4);return z(o.rejectFriendRequest(r.id))}),y(14,Ao,2,0,"span",16)(15,To,1,0,"span",35),l()()()}if(i&2){let t=e.$implicit,n=_(4);p(2),m("src",t.avatarUrl||"/assets/default-avatar.png",ae)("alt",t.username),p(3),L(t.fullName||"User"),p(2),L(t.username),p(),m("ngIf",t.timestamp),p(2),m("disabled",n.actionLoading[t.id]),p(),m("ngIf",!n.actionLoading[t.id]),p(),m("ngIf",n.actionLoading[t.id]),p(),m("disabled",n.actionLoading[t.id]),p(),m("ngIf",!n.actionLoading[t.id]),p(),m("ngIf",n.actionLoading[t.id])}}function ko(i,e){if(i&1&&(d(0,"ul",24),y(1,Ro,16,11,"li",25),l()),i&2){let t=_(3);p(),m("ngForOf",t.friendRequests)}}function No(i,e){if(i&1&&(d(0,"div"),y(1,Oo,4,0,"div",18)(2,Mo,3,0,"div",19)(3,ko,2,1,"ul",20),l()),i&2){let t=_(2);p(),m("ngIf",t.isFriendsLoading),p(),m("ngIf",!t.isFriendsLoading&&t.friendRequests.length===0),p(),m("ngIf",!t.isFriendsLoading&&t.friendRequests.length>0)}}function Lo(i,e){i&1&&(d(0,"div",21),P(1,"div",22),d(2,"span"),x(3,"Loading friends..."),l()())}function qo(i,e){i&1&&(d(0,"div",23)(1,"p"),x(2,"You don't have any friends yet"),l()())}function Do(i,e){if(i&1&&(d(0,"li",42)(1,"a",43),P(2,"img",28),d(3,"div",29)(4,"span",30),x(5),l(),d(6,"span",31),x(7),l()()()()),i&2){let t=e.$implicit;p(),m("routerLink",Ht(5,So,t.username)),p(),m("src",t.avatarUrl||"/assets/default-avatar.png",ae)("alt",t.username),p(3),L(t.fullName||"User"),p(2),L(t.username)}}function Uo(i,e){if(i&1&&(d(0,"ul",40),y(1,Do,8,7,"li",41),l()),i&2){let t=_(3);p(),m("ngForOf",t.currentFriends)}}function jo(i,e){if(i&1&&(d(0,"div"),y(1,Lo,4,0,"div",18)(2,qo,3,0,"div",19)(3,Uo,2,1,"ul",39),l()),i&2){let t=_(2);p(),m("ngIf",t.isFriendsLoading),p(),m("ngIf",!t.isFriendsLoading&&t.currentFriends.length===0),p(),m("ngIf",!t.isFriendsLoading&&t.currentFriends.length>0)}}function zo(i,e){if(i&1){let t=V();d(0,"div",10)(1,"div",11)(2,"div",12)(3,"button",13),E("click",function(){j(t);let r=_();return z(r.setActiveTab("requests"))}),x(4," Requests "),y(5,wo,2,1,"span",14),l(),d(6,"button",13),E("click",function(){j(t);let r=_();return z(r.setActiveTab("friends"))}),x(7," Friends "),l()()(),d(8,"div",15),y(9,No,4,3,"div",16)(10,jo,4,3,"div",16),l()()}if(i&2){let t=_();p(3),pe("active",t.activeFriendsTab==="requests"),p(2),m("ngIf",t.friendRequestCount>0),p(),pe("active",t.activeFriendsTab==="friends"),p(3),m("ngIf",t.activeFriendsTab==="requests"),p(),m("ngIf",t.activeFriendsTab==="friends")}}function Bo(i,e){if(i&1&&(d(0,"span",9),x(1),l()),i&2){let t=_();p(),L(t.notificationCount)}}function $o(i,e){i&1&&(d(0,"div",21),P(1,"div",22),d(2,"span"),x(3,"Loading notifications..."),l()())}function Yo(i,e){i&1&&(d(0,"div",23)(1,"p"),x(2,"No notifications yet"),l()())}function Vo(i,e){i&1&&P(0,"div",55)}function Ho(i,e){if(i&1){let t=V();d(0,"li",48),E("click",function(){let r=j(t).$implicit,o=_(3);return z(o.markNotificationAsRead(r.id))}),d(1,"div",49),P(2,"img",28),l(),d(3,"div",50)(4,"div",51)(5,"span",52),x(6),l(),d(7,"span"),x(8),l()(),d(9,"div",53),x(10),l()(),y(11,Vo,1,0,"div",54),l()}if(i&2){let t=e.$implicit,n=_(3);pe("unread",!t.read),p(2),m("src",n.getActorAvatar(t),ae)("alt",n.getActorUsername(t)),p(4),L(n.getActorUsername(t)),p(2),L(t.content),p(2),L(n.formatTimeAgo(t.createdAt)),p(),m("ngIf",!t.read)}}function Go(i,e){if(i&1&&(d(0,"ul",46),y(1,Ho,12,8,"li",47),l()),i&2){let t=_(2);p(),m("ngForOf",t.notifications)}}function Jo(i,e){if(i&1&&(d(0,"div",44)(1,"div",11)(2,"h3"),x(3,"Notifications"),l()(),d(4,"div",15),y(5,$o,4,0,"div",18)(6,Yo,3,0,"div",19)(7,Go,2,1,"ul",45),l()()),i&2){let t=_();p(5),m("ngIf",t.isNotificationsLoading),p(),m("ngIf",!t.isNotificationsLoading&&t.notifications.length===0),p(),m("ngIf",!t.isNotificationsLoading&&t.notifications.length>0)}}var Ke=class i{constructor(e,t,n,r){this.friendshipService=e;this.notificationService=t;this.authService=n;this.userService=r}isFriendsDropdownOpen=!1;isNotificationsDropdownOpen=!1;activeFriendsTab="requests";friendRequests=[];currentFriends=[];notifications=[];friendRequestCount=0;notificationCount=0;isFriendsLoading=!0;isNotificationsLoading=!0;actionLoading={};subscriptions=[];ngOnInit(){this.authService.isAuthenticated()&&(this.subscriptions.push(this.friendshipService.pendingFriendRequests$.subscribe(e=>{this.friendRequests=e.map(t=>({id:t.id,username:t.users?.username||"User",fullName:t.users?.full_name||"",avatarUrl:t.users?.avatar_url,status:t.status,timestamp:new Date(t.created_at)})),this.friendRequestCount=this.friendRequests.length,this.isFriendsLoading=!1})),this.subscriptions.push(this.friendshipService.friends$.subscribe(e=>{if(this.isFriendsLoading=!0,!e||e.length===0){this.currentFriends=[],this.isFriendsLoading=!1;return}let t=e.map(n=>this.userService.getUserById(n).pipe(T(r=>r?{id:r.id,username:r.username,fullName:r.fullName,avatarUrl:r.avatarUrl,status:"accepted"}:{id:n,username:"Unknown User",fullName:"Unknown",avatarUrl:void 0,status:"accepted"})));Ot(t).subscribe({next:n=>{this.currentFriends=n,this.isFriendsLoading=!1},error:n=>{console.error("Error loading friends:",n),this.isFriendsLoading=!1,this.currentFriends=e.map(r=>({id:r,username:"friend_"+r.substring(0,5),fullName:"Friend User",status:"accepted"}))}})})),this.subscriptions.push(this.notificationService.notifications$.subscribe(e=>{this.notifications=e,this.isNotificationsLoading=!1})),this.subscriptions.push(this.notificationService.unreadCount$.subscribe(e=>{this.notificationCount=e})))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.subscriptions=[]}toggleFriendsDropdown(){this.isFriendsDropdownOpen=!this.isFriendsDropdownOpen,this.isFriendsDropdownOpen&&(this.isNotificationsDropdownOpen=!1)}toggleNotificationsDropdown(){this.isNotificationsDropdownOpen=!this.isNotificationsDropdownOpen,this.isNotificationsDropdownOpen&&(this.isFriendsDropdownOpen=!1)}setActiveTab(e){this.activeFriendsTab=e}acceptFriendRequest(e){this.actionLoading[e]=!0,this.friendshipService.acceptFriendRequest(e).subscribe({next:()=>{this.actionLoading[e]=!1;let t=this.friendRequests.find(n=>n.id===e);t&&(this.friendRequests=this.friendRequests.filter(n=>n.id!==e),this.friendRequestCount=this.friendRequests.length,this.currentFriends.push({id:t.id,username:t.username,fullName:t.fullName,avatarUrl:t.avatarUrl,status:"accepted"}))},error:t=>{console.error("Error accepting friend request:",t),this.actionLoading[e]=!1}})}rejectFriendRequest(e){this.actionLoading[e]=!0,this.friendshipService.rejectFriendRequest(e).subscribe({next:()=>{this.actionLoading[e]=!1,this.friendRequests=this.friendRequests.filter(t=>t.id!==e),this.friendRequestCount=this.friendRequests.length},error:t=>{console.error("Error rejecting friend request:",t),this.actionLoading[e]=!1}})}markNotificationAsRead(e){this.notificationService.markAsRead(e).subscribe({error:t=>{console.error("Error marking notification as read:",t)}})}onClickOutside(e){let t=document.querySelector(".friends-dropdown"),n=document.querySelector(".friend-toggle"),r=document.querySelector(".notifications-dropdown"),o=document.querySelector(".notification-toggle");this.isFriendsDropdownOpen&&t&&n&&!t.contains(e.target)&&!n.contains(e.target)&&(this.isFriendsDropdownOpen=!1),this.isNotificationsDropdownOpen&&r&&o&&!r.contains(e.target)&&!o.contains(e.target)&&(this.isNotificationsDropdownOpen=!1)}formatTimeAgo(e){let n=Math.floor((new Date().getTime()-e.getTime())/1e3),r=n/31536e3;return r>1?Math.floor(r)+"y":(r=n/2592e3,r>1?Math.floor(r)+"mo":(r=n/86400,r>1?Math.floor(r)+"d":(r=n/3600,r>1?Math.floor(r)+"h":(r=n/60,r>1?Math.floor(r)+"m":Math.floor(n)+"s"))))}getActorAvatar(e){if(e.actor){if(e.actor.avatarUrl)return e.actor.avatarUrl;if(e.actor.avatar_url)return e.actor.avatar_url}return"/assets/default-avatar.png"}getActorUsername(e){return e.actor&&(e.actor.username||e.actor.userName)||"User"}static \u0275fac=function(t){return new(t||i)(M(xe),M(be),M(ne),M(fe))};static \u0275cmp=H({type:i,selectors:[["app-top-nav-bar"]],hostBindings:function(t,n){t&1&&E("click",function(o){return n.onClickOutside(o)},!1,Bt)},standalone:!0,features:[G],decls:14,vars:4,consts:[[1,"top-nav-container"],[1,"nav-icons"],[1,"nav-icon-wrapper"],[1,"nav-icon","friend-toggle",3,"click"],[1,"material-icons"],["class","badge",4,"ngIf"],["class","dropdown-panel friends-dropdown",4,"ngIf"],[1,"nav-icon","notification-toggle",3,"click"],["class","dropdown-panel notifications-dropdown",4,"ngIf"],[1,"badge"],[1,"dropdown-panel","friends-dropdown"],[1,"dropdown-header"],[1,"tab-buttons"],[1,"tab-btn",3,"click"],["class","badge-small",4,"ngIf"],[1,"dropdown-content"],[4,"ngIf"],[1,"badge-small"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","requests-list",4,"ngIf"],[1,"loading-state"],[1,"spinner"],[1,"empty-state"],[1,"requests-list"],["class","request-item",4,"ngFor","ngForOf"],[1,"request-item"],[1,"request-user"],[1,"user-avatar",3,"src","alt"],[1,"user-details"],[1,"user-name"],[1,"username"],["class","timestamp",4,"ngIf"],[1,"request-actions"],[1,"accept-btn",3,"click","disabled"],["class","btn-spinner",4,"ngIf"],[1,"reject-btn",3,"click","disabled"],[1,"timestamp"],[1,"btn-spinner"],["class","friends-list",4,"ngIf"],[1,"friends-list"],["class","friend-item",4,"ngFor","ngForOf"],[1,"friend-item"],[1,"friend-link",3,"routerLink"],[1,"dropdown-panel","notifications-dropdown"],["class","notifications-list",4,"ngIf"],[1,"notifications-list"],["class","notification-item",3,"unread","click",4,"ngFor","ngForOf"],[1,"notification-item",3,"click"],[1,"notification-avatar"],[1,"notification-content"],[1,"notification-message"],[1,"actor-name"],[1,"notification-time"],["class","notification-indicator",4,"ngIf"],[1,"notification-indicator"]],template:function(t,n){t&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),E("click",function(o){return n.toggleFriendsDropdown(),o.stopPropagation()}),d(4,"span",4),x(5,"people"),l(),y(6,Po,2,1,"span",5),l(),y(7,zo,11,7,"div",6),l(),d(8,"div",2)(9,"button",7),E("click",function(o){return n.toggleNotificationsDropdown(),o.stopPropagation()}),d(10,"span",4),x(11,"notifications"),l(),y(12,Bo,2,1,"span",5),l(),y(13,Jo,8,3,"div",8),l()()()),t&2&&(p(6),m("ngIf",n.friendRequestCount>0),p(),m("ngIf",n.isFriendsDropdownOpen),p(5),m("ngIf",n.notificationCount>0),p(),m("ngIf",n.isNotificationsDropdownOpen))},dependencies:[J,le,te,Te,Ae],styles:['.top-nav-container[_ngcontent-%COMP%]{position:fixed;top:0;right:24px;height:var(--header-height);display:flex;align-items:center;z-index:99}.nav-icons[_ngcontent-%COMP%]{display:flex;gap:18px}.nav-icon-wrapper[_ngcontent-%COMP%]{position:relative}.nav-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:44px;height:44px;border-radius:var(--radius-full);background-color:var(--hover-color);border:none;cursor:pointer;position:relative;transition:all .25s cubic-bezier(.25,1,.5,1);color:var(--text-color);box-shadow:0 2px 8px #0000000d}.nav-icon[_ngcontent-%COMP%]:hover{background-color:var(--secondary-color);transform:translateY(-3px);box-shadow:0 6px 15px #00000014}.nav-icon[_ngcontent-%COMP%]:active{transform:translateY(-1px)}.nav-icon[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:22px;color:var(--text-color);transition:transform .2s ease}.nav-icon[_ngcontent-%COMP%]:hover   .nav-icon[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{transform:scale(1.2)}.nav-icon[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;background-color:var(--error-color);color:#fff;border-radius:var(--radius-full);padding:2px 6px;font-size:12px;font-weight:600;min-width:20px;text-align:center;box-shadow:0 2px 6px #e539354d;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #e5393566}70%{box-shadow:0 0 0 8px #e5393500}to{box-shadow:0 0 #e5393500}}.dropdown-panel[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 10px);right:0;background-color:var(--card-background);border-radius:var(--radius-lg);box-shadow:0 10px 30px #0000001f;width:340px;max-height:520px;overflow:hidden;z-index:1000;animation:_ngcontent-%COMP%_dropdown-appear .3s cubic-bezier(.25,1,.5,1);border:1px solid var(--border-color);transform-origin:top right}.dropdown-panel[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-8px;right:18px;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--card-background);filter:drop-shadow(0 -2px 2px rgba(0,0,0,.05))}@keyframes _ngcontent-%COMP%_dropdown-appear{0%{opacity:0;transform:translateY(-15px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}.dropdown-header[_ngcontent-%COMP%]{padding:16px 20px;border-bottom:1px solid var(--border-color);background:linear-gradient(to right,rgba(var(--primary-color-rgb, 76, 175, 80),.03),rgba(var(--primary-color-rgb, 76, 175, 80),.07),rgba(var(--primary-color-rgb, 76, 175, 80),.03))}.dropdown-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600;color:var(--text-color);position:relative;display:inline-block}.dropdown-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-4px;left:0;width:40px;height:2px;background-color:var(--primary-color);border-radius:var(--radius-full)}.dropdown-header[_ngcontent-%COMP%]   .tab-buttons[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid var(--border-color);margin:0 -20px -16px;padding:0 10px}.dropdown-header[_ngcontent-%COMP%]   .tab-buttons[_ngcontent-%COMP%]   .tab-btn[_ngcontent-%COMP%]{flex:1;background:none;border:none;padding:14px 10px;font-size:15px;font-weight:500;color:var(--text-color);opacity:.8;cursor:pointer;position:relative;transition:all .25s cubic-bezier(.25,1,.5,1)}.dropdown-header[_ngcontent-%COMP%]   .tab-buttons[_ngcontent-%COMP%]   .tab-btn[_ngcontent-%COMP%]:hover{color:var(--primary-color);opacity:1}.dropdown-header[_ngcontent-%COMP%]   .tab-buttons[_ngcontent-%COMP%]   .tab-btn.active[_ngcontent-%COMP%]{color:var(--primary-color);opacity:1;font-weight:600}.dropdown-header[_ngcontent-%COMP%]   .tab-buttons[_ngcontent-%COMP%]   .tab-btn.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-1px;left:20%;right:20%;height:2px;background-color:var(--primary-color);border-radius:var(--radius-full)}.dropdown-header[_ngcontent-%COMP%]   .tab-buttons[_ngcontent-%COMP%]   .tab-btn[_ngcontent-%COMP%]   .badge-small[_ngcontent-%COMP%]{background-color:var(--error-color);color:#fff;border-radius:var(--radius-full);padding:2px 6px;font-size:11px;margin-left:5px;box-shadow:0 2px 4px #e5393533}.dropdown-content[_ngcontent-%COMP%]{overflow-y:auto;max-height:420px;scrollbar-width:thin;scrollbar-color:var(--border-color) transparent}.dropdown-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.dropdown-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--border-color);border-radius:4px}.dropdown-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background-color:transparent}.dropdown-content[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:32px 0;color:var(--text-color);opacity:.7}.dropdown-content[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:28px;height:28px;border:2px solid rgba(var(--primary-color-rgb, 76, 175, 80),.15);border-top:2px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:12px}.dropdown-content[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:15px}.dropdown-content[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{padding:32px 20px;text-align:center;color:var(--text-color);opacity:.7;font-size:15px}.dropdown-content[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{position:relative;display:inline-block;padding:16px 24px;border:1px dashed var(--border-color);border-radius:var(--radius-md);background-color:var(--hover-color)}.requests-list[_ngcontent-%COMP%], .friends-list[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:0}.request-item[_ngcontent-%COMP%]{padding:16px 20px;border-bottom:1px solid var(--border-color);display:flex;flex-direction:column;gap:14px;transition:all .25s cubic-bezier(.25,1,.5,1)}.request-item[_ngcontent-%COMP%]:hover{background-color:var(--hover-color)}.request-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.request-user[_ngcontent-%COMP%]{display:flex;align-items:center}.user-avatar[_ngcontent-%COMP%]{width:46px;height:46px;border-radius:var(--radius-full);object-fit:cover;margin-right:14px;background-color:var(--hover-color);border:var(--avatar-border);box-shadow:0 2px 6px #00000014;transition:all .25s cubic-bezier(.25,1,.5,1)}.request-user[_ngcontent-%COMP%]:hover   .user-avatar[_ngcontent-%COMP%]{transform:scale(1.1);box-shadow:0 4px 10px #0000001f}.user-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:var(--text-color)}.username[_ngcontent-%COMP%]{font-size:13px;color:var(--text-color);opacity:.7}.timestamp[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color);opacity:.6;margin-top:2px}.request-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.accept-btn[_ngcontent-%COMP%], .reject-btn[_ngcontent-%COMP%]{flex:1;padding:8px 0;border-radius:var(--radius-md);font-size:14px;font-weight:600;border:none;cursor:pointer;transition:all .25s cubic-bezier(.25,1,.5,1);display:flex;align-items:center;justify-content:center}.accept-btn[_ngcontent-%COMP%]:disabled, .reject-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed;transform:none!important;box-shadow:none!important}.accept-btn[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff;box-shadow:0 2px 6px #43a04733}.accept-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--success-color);opacity:.9;transform:translateY(-2px);box-shadow:0 6px 12px #43a04740}.reject-btn[_ngcontent-%COMP%]{background-color:var(--hover-color);color:var(--text-color)}.reject-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--secondary-color);transform:translateY(-2px);box-shadow:0 4px 10px #00000014}.btn-spinner[_ngcontent-%COMP%]{width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.friend-item[_ngcontent-%COMP%]{padding:14px 20px;border-bottom:1px solid var(--border-color);transition:all .25s cubic-bezier(.25,1,.5,1)}.friend-item[_ngcontent-%COMP%]:hover{background-color:var(--hover-color)}.friend-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.friend-link[_ngcontent-%COMP%]{display:flex;align-items:center;text-decoration:none;color:inherit;transition:all .25s cubic-bezier(.25,1,.5,1)}.friend-link[_ngcontent-%COMP%]:hover{transform:translate(5px)}.friend-link[_ngcontent-%COMP%]:hover   .user-avatar[_ngcontent-%COMP%]{transform:scale(1.1);box-shadow:0 4px 10px #0000001f}.notifications-list[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:0}.notification-item[_ngcontent-%COMP%]{display:flex;padding:16px 20px;border-bottom:1px solid var(--border-color);cursor:pointer;position:relative;transition:all .25s cubic-bezier(.25,1,.5,1)}.notification-item[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);transform:translate(5px)}.notification-item.unread[_ngcontent-%COMP%]{background-color:rgba(var(--primary-color-rgb, 76, 175, 80),.08)}.notification-item.unread[_ngcontent-%COMP%]:hover{background-color:var(--hover-color)}.notification-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.notification-avatar[_ngcontent-%COMP%]{margin-right:14px}.notification-content[_ngcontent-%COMP%]{flex:1}.notification-message[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color);line-height:1.5}.notification-message[_ngcontent-%COMP%]   .actor-name[_ngcontent-%COMP%]{font-weight:600;margin-right:4px;color:var(--text-color)}.notification-time[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color);opacity:.6;margin-top:4px}.notification-indicator[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:var(--radius-full);background-color:var(--primary-color);position:absolute;right:15px;top:50%;transform:translateY(-50%);box-shadow:0 0 0 3px rgba(var(--primary-color-rgb, 76, 175, 80),.2)}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.dropdown-panel[_ngcontent-%COMP%]{width:320px}}@media (max-width: 480px){.dropdown-panel[_ngcontent-%COMP%]{width:290px;right:-10px}.dropdown-panel[_ngcontent-%COMP%]:before{right:14px}}']})};var Wo=(i,e)=>({"sidebar-expanded":i,"sidebar-collapsed":e});function Ko(i,e){i&1&&(we(0),P(1,"app-top-nav-bar"),Oe())}var Xe=class i{constructor(e,t,n){this.store=e;this.sideNavService=t;this.themeService=n;this.isAuthenticated$=this.store.select(Ne)}isAuthenticated$;isSidebarCollapsed=!0;currentThemeClass="theme-light";themeSubscription=null;sidebarSubscription=null;ngOnInit(){this.sidebarSubscription=this.sideNavService.sidebarState.subscribe(e=>{this.isSidebarCollapsed=e}),this.themeSubscription=this.themeService.currentTheme$.subscribe(e=>{this.currentThemeClass=`theme-${e}`,console.log("Theme changed to:",e)})}ngOnDestroy(){this.sidebarSubscription&&this.sidebarSubscription.unsubscribe(),this.themeSubscription&&this.themeSubscription.unsubscribe()}static \u0275fac=function(t){return new(t||i)(M(ke),M(ge),M(Ni))};static \u0275cmp=H({type:i,selectors:[["app-main"]],standalone:!0,features:[G],decls:6,vars:8,consts:[[1,"app-wrapper","theme-transition",3,"ngClass"],[4,"ngIf"],[1,"main-content",3,"ngClass"]],template:function(t,n){t&1&&(d(0,"div",0),P(1,"app-side-nav"),y(2,Ko,2,0,"ng-container",1),Me(3,"async"),d(4,"div",2),P(5,"router-outlet"),l()()),t&2&&(m("ngClass",n.currentThemeClass),p(2),m("ngIf",Fe(3,3,n.isAuthenticated$)),p(2),m("ngClass",Gt(5,Wo,!n.isSidebarCollapsed,n.isSidebarCollapsed)))},dependencies:[J,Ie,te,Ee,Qt,qe,Ke],styles:[".app-wrapper[_ngcontent-%COMP%]{display:block;min-height:100vh;width:100%;position:relative;transition:background-color .3s ease;background-color:var(--background-color);color:var(--text-color)}.main-content[_ngcontent-%COMP%]{padding:24px;transition:padding-left .3s ease,background-color .3s ease;min-height:100vh;box-sizing:border-box;background-color:var(--background-color)}.sidebar-collapsed[_ngcontent-%COMP%]{padding-left:84px}.sidebar-expanded[_ngcontent-%COMP%]{padding-left:266px}@media (max-width: 768px){.main-content[_ngcontent-%COMP%]{padding:16px}.sidebar-collapsed[_ngcontent-%COMP%], .sidebar-expanded[_ngcontent-%COMP%]{padding-left:84px}}"]})};var Ze=class i{title="grasslandia";static \u0275fac=function(t){return new(t||i)};static \u0275cmp=H({type:i,selectors:[["app-root"]],standalone:!0,features:[G],decls:1,vars:0,template:function(t,n){t&1&&P(0,"app-main")},dependencies:[Xe],styles:["[_nghost-%COMP%]{display:block;margin:0;padding:0}"]})};Xt(Ze,Ir).catch(i=>console.error(i));
