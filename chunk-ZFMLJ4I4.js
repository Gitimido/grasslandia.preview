import{b as Pe,c as st,d as ke,f as lt}from"./chunk-5FDPCJE3.js";import{$ as l,Ba as ae,C as K,Db as ue,E as G,Eb as B,G as J,I as Je,Ia as ce,J as x,Jb as ct,K as P,Ka as ot,Kb as ye,La as le,Lb as j,Ma as Z,O as Ce,Pa as ee,R as Xe,T as V,V as s,W as w,Y as Qe,Z as _,Za as de,_ as Ze,a as Ke,ab as me,ba as X,bb as Oe,c as Y,db as we,ea as o,fa as a,fb as Ee,ga as D,h as v,ha as et,i as y,ia as tt,j as C,ja as O,k as Se,ka as b,kb as pe,l as h,la as p,m as ve,n as qe,nb as E,ob as L,pa as nt,q as g,ra as m,s as Ne,sa as z,t as A,ta as T,ua as it,v as H,va as rt,wa as be,xa as _e,xb as te,y as Ge,ya as xe,yb as Me,z as I,za as Q,zb as at}from"./chunk-UPP2GHVQ.js";import{a as k,b as M}from"./chunk-HMJPAHNJ.js";var Le=at("comments"),dt=Me(Le,i=>i.isLoading),mt=Me(Le,i=>i.error),pt=i=>Me(Le,e=>e.byPost[i]||[]),ut=i=>Me(Le,e=>e.byParent[i]||[]);var ht=E("[Comments] Load Comments",L()),gt=E("[Comments] Load Comments Success",L()),ft=E("[Comments] Load Comments Failure",L()),vt=E("[Comments] Load Replies",L()),Ct=E("[Comments] Load Replies Success",L()),bt=E("[Comments] Load Replies Failure",L()),_t=E("[Comments] Create Comment",L()),xt=E("[Comments] Create Comment Success",L()),Pt=E("[Comments] Create Comment Failure",L()),kt=E("[Comments] Update Comment",L()),Mt=E("[Comments] Update Comment Success",L()),yt=E("[Comments] Update Comment Failure",L()),St=E("[Comments] Delete Comment",L()),Ot=E("[Comments] Delete Comment Success",L()),wt=E("[Comments] Delete Comment Failure",L()),Et=E("[Comments] Comment Added",L()),Lt=E("[Comments] Comment Updated",L()),It=E("[Comments] Comment Deleted",L());var ne=class i{constructor(e,t){this.authService=e;this.store=t;this.supabase=ue(B.supabaseUrl,B.supabaseKey),this.authService.user$.subscribe(n=>{n?this.setupRealtimeSubscription():this.cleanupSubscription()})}supabase;commentsSubscription=null;loadedCommentIds=new Set;commentCountsSubject=new Y({});recentlyCreatedComments=new Set;ngOnDestroy(){this.cleanupSubscription()}setupRealtimeSubscription(){this.cleanupSubscription(),this.commentsSubscription=this.supabase.channel("comments-public").on("postgres_changes",{event:"*",schema:"public",table:"comments"},e=>{if(console.log("Comment change detected:",e),e.eventType==="INSERT"){let t=e.new.id;if(this.recentlyCreatedComments.has(t)){console.log("Skipping realtime update for recently created comment:",t),this.recentlyCreatedComments.delete(t);return}this.enrichCommentWithUserData(e.new).subscribe(n=>{if(this.loadedCommentIds.add(n.id),this.store.dispatch(Et({comment:n})),!n.parentId){let r=this.commentCountsSubject.value;this.commentCountsSubject.next(M(k({},r),{[n.postId]:(r[n.postId]||0)+1}))}})}else if(e.eventType==="UPDATE")this.enrichCommentWithUserData(e.new).subscribe(t=>{this.store.dispatch(Lt({comment:t}))});else if(e.eventType==="DELETE"&&(this.store.dispatch(It({commentId:e.old.id,postId:e.old.post_id,parentId:e.old.parent_id})),this.loadedCommentIds.delete(e.old.id),!e.old.parent_id)){let t=e.old.post_id,n=this.commentCountsSubject.value;this.commentCountsSubject.next(M(k({},n),{[t]:Math.max(0,(n[t]||0)-1)}))}}).subscribe(e=>{console.log("Comments channel status:",e)})}cleanupSubscription(){this.commentsSubscription&&(this.supabase.removeChannel(this.commentsSubscription),this.commentsSubscription=null),this.loadedCommentIds.clear(),this.recentlyCreatedComments.clear()}enrichCommentWithUserData(e){return!e||!e.user_id?(console.error("Invalid comment data:",e),y(null)):v(this.supabase.from("users").select("id, username, full_name, avatar_url, email").eq("id",e.user_id).single().then(({data:t,error:n})=>n?(console.error("Error fetching user data for comment:",n),this.mapComment(M(k({},e),{users:null}))):this.mapComment(M(k({},e),{users:t})),t=>(console.error("Error in enrichCommentWithUserData:",t),this.mapComment(e))))}getComment(e){return v(this.supabase.from("comments").select("*, users:user_id(*)").eq("id",e).single()).pipe(h(({data:t,error:n})=>{if(n)throw n;return t?this.mapComment(t):null}),g(t=>(console.error("Error fetching comment:",t),y(null))))}createComment(e,t,n){let r=this.authService.user?.id;if(!r)return C(()=>new Error("User not authenticated"));this.store.dispatch(_t({postId:e,content:t,parentId:n}));let c={user_id:r,post_id:e,content:t,parent_id:n||null};return v(this.supabase.from("comments").insert(c).select("*")).pipe(I(({data:d,error:u})=>{if(u)throw u;if(!d||d.length===0)throw new Error("Failed to create comment");let f=d[0].id;return this.recentlyCreatedComments.add(f),v(this.supabase.from("users").select("id, username, full_name, avatar_url, email").eq("id",r).single()).pipe(h(({data:S,error:F})=>{if(F)throw F;let se={id:r,username:S?.username||this.getUsernameFromAuth()||"User",fullName:S?.full_name||this.getFullNameFromAuth()||"",avatarUrl:S?.avatar_url||this.getAvatarUrlFromAuth()||"",email:S?.email||this.authService.user?.email||""},ie=this.mapComment(M(k({},d[0]),{users:se}));if(this.store.dispatch(xt({comment:ie})),!n){let re=this.commentCountsSubject.value;this.commentCountsSubject.next(M(k({},re),{[e]:(re[e]||0)+1}))}return ie}))}),g(d=>(console.error("Error creating comment:",d),this.store.dispatch(Pt({error:d.message||"Failed to create comment"})),C(()=>d))))}getCommentCountObservable(e){return this.getCommentCount(e).subscribe(t=>{let n=this.commentCountsSubject.value;this.commentCountsSubject.next(M(k({},n),{[e]:t}))}),this.commentCountsSubject.asObservable().pipe(h(t=>t[e]||0))}getPostComments(e,t=5,n=0,r="top"){this.store.dispatch(ht({postId:e}));let c="created_at",d="desc";return v(this.supabase.from("comments").select("*, users:user_id(*)").eq("post_id",e).is("parent_id",null).order(c,{ascending:!1}).range(n,n+t-1)).pipe(h(({data:u,error:f})=>{if(f)throw f;let S=[];return u&&u.length>0&&(S=u.map(F=>(this.loadedCommentIds.add(F.id),this.mapComment(F)))),this.store.dispatch(gt({postId:e,comments:S})),S}),g(u=>(console.error("Error fetching post comments:",u),this.store.dispatch(ft({error:"Failed to load comments"})),y([]))))}getCommentReplies(e,t=5,n=0,r="top"){this.store.dispatch(vt({commentId:e}));let c="created_at",d=!1;return console.log(`Fetching replies for comment ${e}, limit: ${t}, offset: ${n}`),v(this.supabase.from("comments").select("*, users:user_id(*)").eq("parent_id",e).order(c,{ascending:d}).range(n,n+t-1).then(({data:u,error:f})=>{if(f)throw console.error("Supabase error fetching replies:",f),f;let S=[];return u&&u.length>0?(console.log(`Found ${u.length} replies for comment ${e}`),S=u.map(F=>(this.loadedCommentIds.add(F.id),this.mapComment(F)))):console.log(`No replies found for comment ${e}`),this.store.dispatch(Ct({commentId:e,replies:S})),S},u=>(console.error(`Error fetching replies for comment ${e}:`,u),this.store.dispatch(bt({error:"Failed to load replies"})),[])))}updateComment(e,t){let n=this.authService.user?.id;return n?(this.store.dispatch(kt({commentId:e,content:t})),v(this.supabase.from("comments").select("user_id").eq("id",e).single()).pipe(I(({data:r,error:c})=>{if(c)throw c;if(!r)throw new Error("Comment not found");if(r.user_id!==n)throw new Error("You are not authorized to edit this comment");return v(this.supabase.from("comments").update({content:t,updated_at:new Date}).eq("id",e).select("*, users:user_id(*)").single())}),h(({data:r,error:c})=>{if(c)throw c;if(!r)throw new Error("Failed to update comment");let d=this.mapComment(r);return this.store.dispatch(Mt({comment:d})),d}),g(r=>(console.error("Error updating comment:",r),this.store.dispatch(yt({error:r.message||"Failed to update comment"})),C(()=>r))))):C(()=>new Error("User not authenticated"))}deleteComment(e){let t=this.authService.user?.id;return t?this.getComment(e).pipe(I(n=>{if(!n)throw new Error("Comment not found");let r=n.postId,c=n.parentId;return this.store.dispatch(St({commentId:e,postId:r,parentId:c})),v(this.supabase.from("comments").select("user_id").eq("id",e).single()).pipe(I(({data:d,error:u})=>{if(u)throw u;if(!d)throw new Error("Comment not found");if(d.user_id!==t)throw new Error("You are not authorized to delete this comment");return v(this.supabase.from("comments").delete().eq("id",e)).pipe(h(({error:f})=>{if(f)throw f;if(this.loadedCommentIds.delete(e),!c){let S=this.commentCountsSubject.value;this.commentCountsSubject.next(M(k({},S),{[r]:Math.max(0,(S[r]||0)-1)}))}this.store.dispatch(Ot({commentId:e,postId:r,parentId:c}))}))}))}),g(n=>(console.error("Error deleting comment:",n),this.store.dispatch(wt({error:n.message||"Failed to delete comment"})),C(()=>n)))):C(()=>new Error("User not authenticated"))}getCommentCount(e){return v(this.supabase.from("comments").select("id",{count:"exact",head:!0}).eq("post_id",e)).pipe(h(({count:t,error:n})=>{if(n)throw n;return t||0}),g(t=>(console.error("Error getting comment count:",t),y(0))))}getCommentRepliesCount(e){return v(this.supabase.from("comments").select("id",{count:"exact",head:!0}).eq("parent_id",e)).pipe(h(({count:t,error:n})=>{if(n)throw n;return t||0}),g(t=>(console.error("Error counting replies:",t),y(0))))}getUsernameFromAuth(){let e=this.authService.user;return e?e.user_metadata?.username||(e.email?e.email.split("@")[0]:null):null}getFullNameFromAuth(){let e=this.authService.user;return e?e.user_metadata?.full_name:null}getAvatarUrlFromAuth(){let e=this.authService.user;return e?e.user_metadata?.avatar_url:null}mapComment(e){let t;return e.users?t={id:e.users.id,username:e.users.username,fullName:e.users.full_name,avatarUrl:e.users.avatar_url,email:e.users.email||""}:this.authService.user&&e.user_id===this.authService.user.id&&(t={id:this.authService.user.id,username:this.getUsernameFromAuth()||"User",fullName:this.getFullNameFromAuth()||"",avatarUrl:this.getAvatarUrlFromAuth()||"",email:this.authService.user.email||""}),new st({id:e.id,userId:e.user_id,postId:e.post_id,parentId:e.parent_id,content:e.content,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),user:t,replies:[]})}static \u0275fac=function(t){return new(t||i)(G(j),G(te))};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};var he=class i{constructor(e){this.authService=e;console.log("LikeService initialized"),this.supabase=ue(B.supabaseUrl,B.supabaseKey),this.authService.user$.pipe(A(1)).subscribe(t=>{t&&!this.initialized&&(this.initialized=!0,this.setupRealtimeSubscriptions())}),this.authService.user$.pipe(Ge(1)).subscribe(t=>{this.cleanupSubscriptions(),t&&this.setupRealtimeSubscriptions()})}supabase;likesSubscription=null;postLikesChannel=null;postLikes=new Y({});commentLikes=new Y({});userPostLikes=new Y({});userCommentLikes=new Y({});pendingPostOperations=new Set;initialized=!1;ngOnDestroy(){this.cleanupSubscriptions()}setupRealtimeSubscriptions(){console.log("Setting up realtime subscriptions for likes"),this.likesSubscription=this.supabase.channel("likes-changes").on("postgres_changes",{event:"*",schema:"public",table:"likes"},e=>{console.log("Like change event received:",e.eventType,e),e.eventType==="INSERT"?this.handleLikeInsert(e.new):e.eventType==="DELETE"&&this.handleLikeDelete(e.old)}).subscribe(e=>{console.log("Likes channel status:",e)}),this.postLikesChannel=this.supabase.channel("post-like-counts").on("broadcast",{event:"like-count-update"},e=>{if(console.log("Received like count broadcast:",e),e.payload&&typeof e.payload=="object"){let{postId:t,count:n}=e.payload;if(t&&typeof n=="number"){let r=this.postLikes.value;this.postLikes.next(M(k({},r),{[t]:n}))}}}).subscribe()}cleanupSubscriptions(){console.log("Cleaning up like service subscriptions"),this.likesSubscription&&(this.supabase.removeChannel(this.likesSubscription),this.likesSubscription=null),this.postLikesChannel&&(this.supabase.removeChannel(this.postLikesChannel),this.postLikesChannel=null),this.pendingPostOperations.clear(),this.initialized=!1}handleLikeInsert(e){if(console.log("Processing like insert event:",e),e.post_id){if(this.refreshPostLikeCount(e.post_id),e.user_id===this.authService.user?.id){let t=this.userPostLikes.value;this.userPostLikes.next(M(k({},t),{[e.post_id]:!0}))}}else if(e.comment_id&&(this.refreshCommentLikeCount(e.comment_id),e.user_id===this.authService.user?.id)){let t=this.userCommentLikes.value;this.userCommentLikes.next(M(k({},t),{[e.comment_id]:!0}))}}handleLikeDelete(e){if(console.log("Processing like delete event:",e),e.post_id){if(this.refreshPostLikeCount(e.post_id),e.user_id===this.authService.user?.id){let t=this.userPostLikes.value;this.userPostLikes.next(M(k({},t),{[e.post_id]:!1}))}}else if(e.comment_id&&(this.refreshCommentLikeCount(e.comment_id),e.user_id===this.authService.user?.id)){let t=this.userCommentLikes.value;this.userCommentLikes.next(M(k({},t),{[e.comment_id]:!1}))}}refreshPostLikeCount(e){console.log(`Refreshing like count for post ${e}`),v(this.supabase.from("likes").select("id",{count:"exact",head:!0}).eq("post_id",e)).pipe(A(1),h(({count:t,error:n})=>{if(n)throw n;return t||0}),g(t=>(console.error(`Error fetching like count for post ${e}:`,t),y(null)))).subscribe(t=>{if(t!==null){console.log(`Received updated like count for post ${e}: ${t}`);let n=this.postLikes.value;this.postLikes.next(M(k({},n),{[e]:t})),this.broadcastLikeCountUpdate(e,t)}})}broadcastLikeCountUpdate(e,t){this.postLikesChannel&&this.postLikesChannel.send({type:"broadcast",event:"like-count-update",payload:{postId:e,count:t}})}refreshCommentLikeCount(e){v(this.supabase.from("likes").select("id",{count:"exact",head:!0}).eq("comment_id",e)).pipe(A(1),h(({count:t,error:n})=>{if(n)throw n;return t||0}),g(t=>(console.error(`Error fetching like count for comment ${e}:`,t),y(null)))).subscribe(t=>{if(t!==null){let n=this.commentLikes.value;this.commentLikes.next(M(k({},n),{[e]:t}))}})}getPostLikesObservable(e){return e in this.postLikes.value||this.refreshPostLikeCount(e),this.postLikes.asObservable().pipe(h(t=>t[e]||0),Ne(50))}getCommentLikesObservable(e){return e in this.commentLikes.value||this.refreshCommentLikeCount(e),this.commentLikes.asObservable().pipe(h(t=>t[e]||0),Ne(50))}getUserPostLikeObservable(e){return e in this.userPostLikes.value||this.hasUserLikedPost(e).pipe(A(1)).subscribe(t=>{let n=this.userPostLikes.value;this.userPostLikes.next(M(k({},n),{[e]:t}))}),this.userPostLikes.asObservable().pipe(h(t=>t[e]||!1))}getUserCommentLikeObservable(e){return e in this.userCommentLikes.value||this.hasUserLikedComment(e).pipe(A(1)).subscribe(t=>{let n=this.userCommentLikes.value;this.userCommentLikes.next(M(k({},n),{[e]:t}))}),this.userCommentLikes.asObservable().pipe(h(t=>t[e]||!1))}togglePostLike(e){let t=this.authService.user?.id;if(!t)return C(()=>new Error("User not authenticated"));let n=`toggle:${e}`;if(this.pendingPostOperations.has(n))return console.log(`Operation ${n} already in progress, ignoring duplicate request`),C(()=>new Error("Operation already in progress"));this.pendingPostOperations.add(n);let r=this.userPostLikes.value[e]||!1,c=this.userPostLikes.value;this.userPostLikes.next(M(k({},c),{[e]:!r}));let d=this.postLikes.value[e]||0;return this.postLikes.next(M(k({},this.postLikes.value),{[e]:r?Math.max(0,d-1):d+1})),v(this.supabase.from("likes").insert({user_id:t,post_id:e,comment_id:null})).pipe(h(({error:u})=>{if(u)throw u;this.refreshPostLikeCount(e)}),g(u=>(console.error("Error toggling post like:",u),this.userPostLikes.next(M(k({},this.userPostLikes.value),{[e]:r})),this.postLikes.next(M(k({},this.postLikes.value),{[e]:d})),C(()=>u))),H(()=>{this.pendingPostOperations.delete(n)}))}toggleCommentLike(e){let t=this.authService.user?.id;if(!t)return C(()=>new Error("User not authenticated"));let n=`toggle:comment:${e}`;if(this.pendingPostOperations.has(n))return console.log(`Operation ${n} already in progress, ignoring duplicate request`),C(()=>new Error("Operation already in progress"));this.pendingPostOperations.add(n);let r=this.userCommentLikes.value[e]||!1,c=this.userCommentLikes.value;this.userCommentLikes.next(M(k({},c),{[e]:!r}));let d=this.commentLikes.value[e]||0;return this.commentLikes.next(M(k({},this.commentLikes.value),{[e]:r?Math.max(0,d-1):d+1})),v(this.supabase.from("likes").insert({user_id:t,post_id:null,comment_id:e})).pipe(h(({error:u})=>{if(u)throw u;this.refreshCommentLikeCount(e)}),g(u=>(console.error("Error toggling comment like:",u),this.userCommentLikes.next(M(k({},this.userCommentLikes.value),{[e]:r})),this.commentLikes.next(M(k({},this.commentLikes.value),{[e]:d})),C(()=>u))),H(()=>{this.pendingPostOperations.delete(n)}))}hasUserLikedPost(e){let t=this.authService.user?.id;return t?v(this.supabase.from("likes").select("id",{count:"exact",head:!0}).eq("user_id",t).eq("post_id",e)).pipe(h(({data:n,error:r})=>{if(r)throw r;let c=n&&n.length>0;return console.log(`User ${t} has liked post ${e}: ${c}`),c}),g(n=>(console.error("Error checking if post is liked:",n),y(!1)))):y(!1)}hasUserLikedComment(e){let t=this.authService.user?.id;return t?v(this.supabase.from("likes").select("id",{count:"exact",head:!0}).eq("user_id",t).eq("comment_id",e)).pipe(h(({data:n,error:r})=>{if(r)throw r;let c=n&&n.length>0;return console.log(`User ${t} has liked comment ${e}: ${c}`),c}),g(n=>(console.error("Error checking if comment is liked:",n),y(!1)))):y(!1)}likePost(e){return this.togglePostLike(e)}unlikePost(e){return this.togglePostLike(e)}likeComment(e){return this.toggleCommentLike(e)}unlikeComment(e){return this.toggleCommentLike(e)}static \u0275fac=function(t){return new(t||i)(G(j))};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};var Rt=i=>["/profile",i];function jt(i,e){if(i&1&&(o(0,"span",27),m(1),a()),i&2){let t=p();s(),z(t.comment.user==null?null:t.comment.user.email)}}function $t(i,e){i&1&&(o(0,"span"),m(1," Replying to "),a())}function qt(i,e){if(i&1&&(o(0,"a",28),m(1),a()),i&2){let t=p();l("routerLink",ae(2,Rt,t.replyingToUsername)),s(),z(t.getReplyingToText(t.replyingToUsername))}}function Nt(i,e){if(i&1){let t=O();o(0,"button",32),b("click",function(){x(t);let r=p(2);return P(r.toggleEditMode())}),o(1,"span",21),m(2,"edit"),a()()}}function Yt(i,e){if(i&1){let t=O();o(0,"div",29),_(1,Nt,3,0,"button",30),o(2,"button",31),b("click",function(){x(t);let r=p();return P(r.deleteComment())}),o(3,"span",21),m(4,"delete"),a()()()}if(i&2){let t=p();s(),l("ngIf",!t.isEditing)}}function Bt(i,e){if(i&1&&(o(0,"div",33),m(1),a()),i&2){let t=p();s(),T(" ",t.comment.content," ")}}function Wt(i,e){if(i&1){let t=O();o(0,"div",34)(1,"textarea",35),xe("ngModelChange",function(r){x(t);let c=p();return _e(c.editContent,r)||(c.editContent=r),P(r)}),a(),o(2,"div",36)(3,"button",37),b("click",function(){x(t);let r=p();return P(r.cancelEdit())}),m(4,"Cancel"),a(),o(5,"button",38),b("click",function(){x(t);let r=p();return P(r.saveEdit())}),m(6,"Save"),a()()()}if(i&2){let t=p();s(),be("ngModel",t.editContent)}}function Ht(i,e){if(i&1&&(o(0,"span",39),m(1),a()),i&2){let t=p();s(),z(t.likeCount)}}function Kt(i,e){if(i&1){let t=O();o(0,"button",40),b("click",function(){x(t);let r=p();return P(r.toggleReplies())}),o(1,"span",21),m(2),a(),o(3,"span"),m(4),a()()}if(i&2){let t=p();s(2),T(" ",t.areRepliesExpanded?"expand_less":"expand_more"," "),s(2),rt(" ",t.areRepliesExpanded?"Hide":"View"," ",t.repliesCount," ",t.repliesCount===1?"reply":"replies"," ")}}function Gt(i,e){if(i&1){let t=O();o(0,"div",41)(1,"textarea",42),xe("ngModelChange",function(r){x(t);let c=p();return _e(c.replyContent,r)||(c.replyContent=r),P(r)}),a(),o(2,"div",43)(3,"button",37),b("click",function(){x(t);let r=p();return P(r.toggleReplyForm())}),m(4,"Cancel"),a(),o(5,"button",44),b("click",function(){x(t);let r=p();return P(r.submitReply())}),m(6,"Reply"),a()()()}if(i&2){let t=p();s(),be("ngModel",t.replyContent),s(4),l("disabled",!t.replyContent.trim())}}function Jt(i,e){i&1&&(o(0,"div",48),D(1,"div",49),o(2,"span"),m(3,"Loading replies..."),a()())}function Xt(i,e){if(i&1){let t=O();o(0,"app-comment",52),b("deleted",function(r){x(t);let c=p(3);return P(c.handleCommentDeleted(r))}),a()}if(i&2){let t=e.$implicit,n=p(3);l("comment",t)("isReply",!0)("replyDepth",n.replyDepth+1)("replyingToUsername",n.comment.user==null?null:n.comment.user.username)}}function Qt(i,e){i&1&&(o(0,"span"),m(1,"Load more replies"),a())}function Zt(i,e){i&1&&(o(0,"span"),m(1,"Loading..."),a())}function en(i,e){if(i&1){let t=O();o(0,"div",53)(1,"button",54),b("click",function(){x(t);let r=p(3);return P(r.loadMoreReplies())}),_(2,Qt,2,0,"span",13)(3,Zt,2,0,"span",13),a()()}if(i&2){let t=p(3);s(),l("disabled",t.isLoadingMoreReplies),s(),l("ngIf",!t.isLoadingMoreReplies),s(),l("ngIf",t.isLoadingMoreReplies)}}function tn(i,e){if(i&1&&(o(0,"div"),_(1,Xt,1,4,"app-comment",50)(2,en,4,3,"div",51),a()),i&2){let t=p(2);s(),l("ngForOf",t.visibleReplies),s(),l("ngIf",t.hasMoreReplies)}}function nn(i,e){i&1&&(o(0,"div",55)(1,"p"),m(2,"No replies yet. Be the first to reply!"),a()())}function rn(i,e){if(i&1&&(o(0,"div",45),_(1,Jt,4,0,"div",46)(2,tn,3,2,"div",13)(3,nn,3,0,"div",47),a()),i&2){let t=p();s(),l("ngIf",t.isLoadingReplies),s(),l("ngIf",!t.isLoadingReplies&&t.visibleReplies.length>0),s(),l("ngIf",!t.isLoadingReplies&&t.visibleReplies.length===0&&t.repliesLoaded)}}var Te=class i{constructor(e,t,n,r,c){this.commentService=e;this.likeService=t;this.authService=n;this.store=r;this.cdr=c}comment;isReply=!1;replyDepth=0;replyingToUsername;deleted=new Ce;isLiked=!1;likeCount=0;isEditing=!1;showReplyForm=!1;replyContent="";editContent="";isLikeInProgress=!1;areRepliesExpanded=!1;isLoadingReplies=!1;isLoadingMoreReplies=!1;repliesCount=0;repliesLoaded=!1;repliesOffset=0;repliesLimit=5;hasMoreReplies=!1;visibleReplies=[];subscriptions=[];ngOnInit(){this.getRepliesCount(),this.subscriptions.push(this.likeService.getCommentLikesObservable(this.comment.id).subscribe(e=>{this.likeCount=e,this.cdr.markForCheck()})),this.subscriptions.push(this.likeService.getUserCommentLikeObservable(this.comment.id).subscribe(e=>{this.isLiked=e,this.cdr.markForCheck()})),this.subscriptions.push(this.store.select(ut(this.comment.id)).subscribe(e=>{this.visibleReplies=e,this.isLoadingReplies&&(this.repliesLoaded=!0,this.isLoadingReplies=!1),e&&e.length>0&&(this.repliesOffset=e.length),this.isLoadingMoreReplies&&(this.isLoadingMoreReplies=!1),this.cdr.markForCheck()}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}getReplyingToText(e){return"@"+e}getRepliesCount(){this.subscriptions.push(this.commentService.getCommentRepliesCount(this.comment.id).subscribe({next:e=>{this.repliesCount=e,this.cdr.markForCheck()},error:e=>{console.error("Error getting replies count:",e),this.cdr.markForCheck()}}))}toggleReplies(){this.areRepliesExpanded=!this.areRepliesExpanded,this.cdr.markForCheck(),this.areRepliesExpanded&&(!this.repliesLoaded||this.visibleReplies.length===0)&&this.loadReplies()}loadReplies(){if(this.isLoadingReplies)return;console.log(`Loading replies for comment ${this.comment.id}`),this.isLoadingReplies=!0,this.cdr.markForCheck();let e=qe(1e4).subscribe(()=>{this.isLoadingReplies&&(console.log("Loading replies timed out - resetting state"),this.isLoadingReplies=!1,this.cdr.markForCheck())});this.commentService.getCommentReplies(this.comment.id,this.repliesLimit,0,"recent").pipe(Se(8e3),H(()=>{e.unsubscribe(),this.cdr.markForCheck()}),g(t=>(console.error("Error loading replies:",t),this.isLoadingReplies=!1,this.cdr.markForCheck(),C(()=>t)))).subscribe({next:t=>{console.log(`Loaded ${t.length} replies for comment ${this.comment.id}`),this.hasMoreReplies=t.length>=this.repliesLimit,t.length===0&&(this.repliesLoaded=!0,this.isLoadingReplies=!1,this.cdr.markForCheck())},error:t=>{console.error("Error in replies subscription:",t),this.isLoadingReplies=!1,this.cdr.markForCheck()}})}loadMoreReplies(){if(this.isLoadingMoreReplies)return;this.isLoadingMoreReplies=!0,this.cdr.markForCheck();let e=qe(1e4).subscribe(()=>{this.isLoadingMoreReplies&&(console.log("Loading more replies timed out - resetting state"),this.isLoadingMoreReplies=!1,this.cdr.markForCheck())});this.commentService.getCommentReplies(this.comment.id,30,this.repliesOffset,"recent").pipe(Se(8e3),H(()=>{e.unsubscribe(),this.cdr.markForCheck()}),g(t=>(console.error("Error loading more replies:",t),this.isLoadingMoreReplies=!1,this.cdr.markForCheck(),C(()=>t)))).subscribe({next:t=>{console.log(`Loaded ${t.length} more replies`),this.hasMoreReplies=t.length>=30},error:t=>{console.error("Error in more replies subscription:",t),this.isLoadingMoreReplies=!1,this.cdr.markForCheck()}})}toggleLike(){if(this.authService.isAuthenticated()){if(this.isLikeInProgress){console.log("Like operation already in progress, ignoring click");return}this.isLikeInProgress=!0,setTimeout(()=>{this.isLikeInProgress=!1},1500),this.likeService.toggleCommentLike(this.comment.id).subscribe({error:e=>{console.error("Error toggling comment like:",e),this.isLikeInProgress=!1,this.cdr.markForCheck()},complete:()=>{this.isLikeInProgress=!1}})}}toggleReplyForm(){this.authService.isAuthenticated()&&(this.showReplyForm=!this.showReplyForm,this.showReplyForm||(this.replyContent=""),this.cdr.markForCheck())}toggleEditMode(){this.isEditing=!this.isEditing,this.isEditing&&(this.editContent=this.comment.content),this.cdr.markForCheck()}submitReply(){if(!this.replyContent.trim())return;console.log(`Submitting reply to comment ${this.comment.id}`);let e=this.replyContent.trim();this.replyContent="";let t=this.showReplyForm;this.showReplyForm=!1,this.cdr.markForCheck(),this.commentService.createComment(this.comment.postId,e,this.comment.id).pipe(Se(1e4),g(n=>(console.error("Error creating reply:",n),this.replyContent=e,this.showReplyForm=t,this.cdr.markForCheck(),C(()=>n)))).subscribe({next:n=>{console.log("Reply created successfully:",n),n.replyingToUsername=this.comment.user?.username,this.areRepliesExpanded||(this.areRepliesExpanded=!0),this.repliesCount++,setTimeout(()=>{this.getRepliesCount(),this.repliesLoaded||this.loadReplies()},300),this.cdr.markForCheck()}})}saveEdit(){if(!this.editContent.trim()||this.editContent===this.comment.content){this.isEditing=!1,this.cdr.markForCheck();return}let e=this.comment.content,t=this.editContent.trim();this.comment.content=t,this.isEditing=!1,this.cdr.markForCheck(),this.commentService.updateComment(this.comment.id,t).subscribe({next:n=>{this.comment=n,this.cdr.markForCheck()},error:n=>{console.error("Error updating comment:",n),this.comment.content=e,this.cdr.markForCheck()}})}deleteComment(){confirm("Are you sure you want to delete this comment?")&&this.commentService.deleteComment(this.comment.id).subscribe({next:()=>{this.deleted.emit(this.comment.id)},error:e=>console.error("Error deleting comment:",e)})}cancelEdit(){this.isEditing=!1,this.editContent="",this.cdr.markForCheck()}get isCommentOwner(){return this.authService.user?.id===this.comment.userId}get hasReplies(){return this.visibleReplies.length>0||this.repliesCount>0}handleCommentDeleted(e){this.visibleReplies=this.visibleReplies.filter(t=>t.id!==e),this.repliesCount--,this.cdr.markForCheck()}static \u0275fac=function(t){return new(t||i)(w(ne),w(he),w(j),w(te),w(ce))};static \u0275cmp=J({type:i,selectors:[["app-comment"]],inputs:{comment:"comment",isReply:"isReply",replyDepth:"replyDepth",replyingToUsername:"replyingToUsername"},outputs:{deleted:"deleted"},standalone:!0,features:[Q],decls:35,vars:27,consts:[[1,"comment-container",3,"ngClass"],[1,"comment-header"],[1,"user-info"],[1,"username-container"],[1,"username",3,"routerLink"],[1,"profile-hover-card"],[1,"hover-card-content"],[1,"hover-avatar",3,"src","alt"],[1,"hover-user-info"],[1,"hover-username"],["class","hover-email",4,"ngIf"],[1,"replying-to"],[1,"timestamp"],[4,"ngIf"],[3,"routerLink",4,"ngIf"],["class","comment-actions",4,"ngIf"],[1,"comment-body"],["class","comment-content",4,"ngIf"],["class","edit-form",4,"ngIf"],[1,"comment-footer"],[1,"action-btn",3,"click"],[1,"material-icons"],["class","like-count",4,"ngIf"],[1,"reply-btn",3,"click"],["class","replies-btn",3,"click",4,"ngIf"],["class","reply-form",4,"ngIf"],["class","replies",4,"ngIf"],[1,"hover-email"],[3,"routerLink"],[1,"comment-actions"],["class","action-btn","title","Edit comment",3,"click",4,"ngIf"],["title","Delete comment",1,"action-btn",3,"click"],["title","Edit comment",1,"action-btn",3,"click"],[1,"comment-content"],[1,"edit-form"],["placeholder","Edit your comment","rows","3",3,"ngModelChange","ngModel"],[1,"edit-actions"],[1,"cancel-btn",3,"click"],[1,"save-btn",3,"click"],[1,"like-count"],[1,"replies-btn",3,"click"],[1,"reply-form"],["placeholder","Write a reply...","rows","2",3,"ngModelChange","ngModel"],[1,"reply-actions"],[1,"submit-btn",3,"click","disabled"],[1,"replies"],["class","loading-replies",4,"ngIf"],["class","no-replies",4,"ngIf"],[1,"loading-replies"],[1,"spinner"],[3,"comment","isReply","replyDepth","replyingToUsername","deleted",4,"ngFor","ngForOf"],["class","load-more-container",4,"ngIf"],[3,"deleted","comment","isReply","replyDepth","replyingToUsername"],[1,"load-more-container"],[1,"load-more-btn",3,"click","disabled"],[1,"no-replies"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"a",4),m(5),o(6,"div",5)(7,"div",6),D(8,"img",7),o(9,"div",8)(10,"span",9),m(11),a(),_(12,jt,2,1,"span",10),a()()()(),o(13,"div",11)(14,"span",12),m(15),a(),_(16,$t,2,0,"span",13)(17,qt,2,4,"a",14),a()()(),_(18,Yt,5,1,"div",15),a(),o(19,"div",16),_(20,Bt,2,1,"div",17)(21,Wt,7,1,"div",18),a(),o(22,"div",19)(23,"button",20),b("click",function(){return n.toggleLike()}),o(24,"span",21),m(25),a(),_(26,Ht,2,1,"span",22),a(),o(27,"button",23),b("click",function(){return n.toggleReplyForm()}),o(28,"span",21),m(29,"reply"),a(),o(30,"span"),m(31,"Reply"),a()(),_(32,Kt,5,4,"button",24),a(),_(33,Gt,7,2,"div",25)(34,rn,4,3,"div",26),a()),t&2&&(X("is-reply",n.isReply)("replies-expanded",n.areRepliesExpanded),l("ngClass","level-"+n.replyDepth),Ze("data-id",n.comment.id),s(4),l("routerLink",ae(25,Rt,n.comment.user==null?null:n.comment.user.username)),s(),T(" ",n.comment.user==null?null:n.comment.user.username," "),s(3),l("src",(n.comment.user==null?null:n.comment.user.avatarUrl)||"/assets/default-avatar.png",V)("alt",n.comment.user==null?null:n.comment.user.username),s(3),z(n.comment.user==null?null:n.comment.user.username),s(),l("ngIf",n.comment.user==null?null:n.comment.user.email),s(3),z(n.comment.timeSince),s(),l("ngIf",n.isReply&&n.replyingToUsername),s(),l("ngIf",n.isReply&&n.replyingToUsername),s(),l("ngIf",n.isCommentOwner),s(2),l("ngIf",!n.isEditing),s(),l("ngIf",n.isEditing),s(2),X("liked",n.isLiked),s(2),z(n.isLiked?"favorite":"favorite_border"),s(),l("ngIf",n.likeCount>0),s(6),l("ngIf",n.hasReplies||n.repliesCount>0),s(),l("ngIf",n.showReplyForm),s(),l("ngIf",n.areRepliesExpanded))},dependencies:[i,ee,ot,le,Z,pe,Oe,we,Ee,me,de],styles:['@charset "UTF-8";.comment-container[_ngcontent-%COMP%]{padding:16px;margin-bottom:16px;position:relative;background-color:var(--card-background);border-radius:var(--radius-md);transition:background-color var(--transition-fast),transform var(--transition-fast),box-shadow var(--transition-fast);box-shadow:0 2px 4px #0000000d}.comment-container[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);box-shadow:0 4px 8px #00000014;transform:translateY(-2px)}.comment-container.is-reply[_ngcontent-%COMP%]{margin-left:36px;border-left:3px solid var(--border-color);padding-left:16px}.comment-container.is-reply[_ngcontent-%COMP%]:before{content:"";position:absolute;left:-3px;top:0;bottom:0;width:3px;background-color:var(--border-color);transition:background-color var(--transition-fast)}.comment-container.is-reply[_ngcontent-%COMP%]:hover:before{background-color:var(--primary-light)}.comment-container.level-2[_ngcontent-%COMP%]{border-left-color:var(--primary-light)}.comment-container.level-2[_ngcontent-%COMP%]:before{background-color:var(--primary-light)}.comment-container.level-2[_ngcontent-%COMP%]:hover:before{background-color:var(--primary-color)}.comment-container.level-3[_ngcontent-%COMP%]{border-left-color:var(--accent-color)}.comment-container.level-3[_ngcontent-%COMP%]:before{background-color:var(--accent-color)}.comment-container.level-3[_ngcontent-%COMP%]:hover:before{opacity:.8}.comment-container.level-4[_ngcontent-%COMP%], .comment-container.level-5[_ngcontent-%COMP%], .comment-container.level-6[_ngcontent-%COMP%]{border-left-color:var(--primary-color)}.comment-container.level-4[_ngcontent-%COMP%]:before, .comment-container.level-5[_ngcontent-%COMP%]:before, .comment-container.level-6[_ngcontent-%COMP%]:before{background-color:var(--primary-color)}.comment-container.level-4[_ngcontent-%COMP%]:hover:before, .comment-container.level-5[_ngcontent-%COMP%]:hover:before, .comment-container.level-6[_ngcontent-%COMP%]:hover:before{opacity:.9}.comment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center}.username-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:relative}.username[_ngcontent-%COMP%]{font-weight:600;font-size:15px;color:var(--text-color);text-decoration:none;position:relative;display:inline-block;transition:color var(--transition-fast)}.username[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.username[_ngcontent-%COMP%]:hover   .profile-hover-card[_ngcontent-%COMP%]{visibility:visible;opacity:1;transform:translateY(0) scale(1)}.profile-hover-card[_ngcontent-%COMP%]{position:absolute;top:-12px;left:-12px;transform:translateY(-8px) scale(.95);visibility:hidden;opacity:0;transition:all .25s cubic-bezier(.25,1,.5,1);z-index:100;filter:drop-shadow(var(--shadow-dropdown));pointer-events:none}.profile-hover-card[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-8px;left:12px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid var(--card-background)}.hover-card-content[_ngcontent-%COMP%]{background-color:var(--card-background);border-radius:var(--radius-md);padding:16px;width:220px;display:flex;align-items:center;border:1px solid var(--border-color);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.hover-avatar[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:var(--radius-full);object-fit:cover;margin-right:14px;border:var(--avatar-border);box-shadow:0 3px 8px #0000001f}.hover-user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.hover-username[_ngcontent-%COMP%]{font-weight:600;font-size:16px;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.hover-email[_ngcontent-%COMP%]{font-size:13px;color:var(--text-color);opacity:.7;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:4px}.timestamp[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color);opacity:.7;margin-top:3px}.comment-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.action-btn[_ngcontent-%COMP%]{background:none;border:none;padding:6px;border-radius:var(--radius-full);color:var(--text-color);opacity:.8;cursor:pointer;display:flex;align-items:center;transition:all var(--transition-fast)}.action-btn[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);color:var(--primary-color);opacity:1;transform:translateY(-1px) scale(1.1)}.action-btn.liked[_ngcontent-%COMP%]{color:var(--error-color)}.action-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:18px}.action-btn[_ngcontent-%COMP%]   .like-count[_ngcontent-%COMP%]{font-size:12px;margin-left:4px;font-weight:500}.comment-body[_ngcontent-%COMP%]{margin-bottom:10px}.comment-content[_ngcontent-%COMP%]{font-size:15px;line-height:1.5;color:var(--text-color);word-break:break-word;margin-left:0;padding:2px 0}.comment-footer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-top:10px}.reply-btn[_ngcontent-%COMP%], .replies-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-color);opacity:.8;font-size:13px;cursor:pointer;display:flex;align-items:center;padding:6px 10px;border-radius:var(--radius-md);transition:all var(--transition-fast);font-weight:500}.reply-btn[_ngcontent-%COMP%]:hover, .replies-btn[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);color:var(--primary-color);opacity:1;transform:translateY(-1px)}.reply-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%], .replies-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:15px;margin-right:4px}.edit-form[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:16px}.edit-form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid var(--border-color);border-radius:var(--radius-md);resize:vertical;font-size:14px;background-color:var(--card-background);color:var(--text-color);transition:all var(--transition-fast);min-height:80px}.edit-form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .reply-form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px #4caf5026}.edit-form[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%], .edit-form[_ngcontent-%COMP%]   .reply-actions[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   .reply-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:10px}.edit-form[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .edit-form[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%], .edit-form[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]{border:none;border-radius:var(--radius-md);padding:8px 14px;font-size:13px;font-weight:500;cursor:pointer;transition:all var(--transition-fast)}.edit-form[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background-color:var(--hover-color);color:var(--text-color)}.edit-form[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover, .reply-form[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover{background-color:var(--secondary-color);transform:translateY(-1px)}.edit-form[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%], .edit-form[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%], .reply-form[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff}.edit-form[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%]:hover, .edit-form[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]:hover, .reply-form[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%]:hover, .reply-form[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]:hover{background-color:var(--primary-dark);transform:translateY(-1px);box-shadow:0 2px 5px #0000001a}.edit-form[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%]:disabled, .edit-form[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]:disabled, .reply-form[_ngcontent-%COMP%]   .save-btn[_ngcontent-%COMP%]:disabled, .reply-form[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.replies[_ngcontent-%COMP%]{margin-top:16px;animation:_ngcontent-%COMP%_slideDown .3s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.replying-to[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color);opacity:.7;margin-bottom:4px;display:flex;align-items:center}.replying-to[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{margin-right:6px;position:relative}.replying-to[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]:after{content:"\\2022";margin-left:6px}.replying-to[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary-color);text-decoration:none;font-weight:500}.replying-to[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.loading-replies[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:20px 0}.loading-replies[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:24px;height:24px;border:2px solid rgba(var(--primary-color-rgb, 76, 175, 80),.2);border-top:2px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:10px}.loading-replies[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:var(--text-color);opacity:.7}.load-more-container[_ngcontent-%COMP%]{text-align:center;padding:10px 0}.load-more-container[_ngcontent-%COMP%]   .load-more-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary-color);font-size:13px;font-weight:500;padding:8px 16px;border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-fast);background-color:var(--secondary-color)}.load-more-container[_ngcontent-%COMP%]   .load-more-btn[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);transform:translateY(-1px);box-shadow:0 2px 5px #00000014}.load-more-container[_ngcontent-%COMP%]   .load-more-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.no-replies[_ngcontent-%COMP%]{padding:16px;text-align:center;color:var(--text-color);opacity:.7;font-size:14px;background-color:var(--hover-color);border-radius:var(--radius-md);margin-top:10px;border:1px dashed var(--border-color)}'],changeDetection:0})};function on(i,e){if(i&1){let t=O();o(0,"div",8)(1,"div",9)(2,"textarea",10,0),xe("ngModelChange",function(r){x(t);let c=p();return _e(c.newCommentContent,r)||(c.newCommentContent=r),P(r)}),b("input",function(){x(t);let r=nt(3),c=p();return P(c.autoGrow(r))}),a(),o(4,"button",11),b("click",function(){x(t);let r=p();return P(r.submitComment())}),o(5,"span",12),m(6,"send"),a()()()()}if(i&2){let t=p();s(2),be("ngModel",t.newCommentContent),s(2),l("disabled",!t.newCommentContent.trim())}}function sn(i,e){i&1&&(o(0,"div",13)(1,"p"),m(2,"Please "),o(3,"a",14),m(4,"sign in"),a(),m(5," to post a comment."),a()())}function an(i,e){if(i&1&&(o(0,"div",15),m(1),a()),i&2){let t=p();s(),T(" ",t.error," ")}}function cn(i,e){i&1&&(o(0,"div",16),D(1,"div",17),o(2,"span"),m(3,"Loading comments..."),a()())}function ln(i,e){i&1&&(o(0,"div",22)(1,"p"),m(2,"No comments yet. Be the first to comment!"),a()())}function dn(i,e){if(i&1){let t=O();o(0,"app-comment",23),b("deleted",function(r){x(t);let c=p(2);return P(c.handleCommentDeleted(r))}),a()}if(i&2){let t=e.$implicit;l("comment",t)}}function mn(i,e){i&1&&(o(0,"span"),m(1,"Show More Comments"),a())}function pn(i,e){i&1&&(o(0,"span"),m(1,"Loading..."),a())}function un(i,e){if(i&1){let t=O();o(0,"div",24)(1,"button",25),b("click",function(){x(t);let r=p(2);return P(r.loadMoreComments())}),_(2,mn,2,0,"span",26)(3,pn,2,0,"span",26),a()()}if(i&2){let t=p(2);s(),l("disabled",t.isLoadingMore),s(),l("ngIf",!t.isLoadingMore),s(),l("ngIf",t.isLoadingMore)}}function hn(i,e){if(i&1&&(o(0,"div",18),_(1,ln,3,0,"div",19)(2,dn,1,1,"app-comment",20)(3,un,4,3,"div",21),a()),i&2){let t=p();s(),l("ngIf",t.visibleComments.length===0),s(),l("ngForOf",t.visibleComments),s(),l("ngIf",t.hasMoreComments)}}var Fe=class i{constructor(e,t,n,r){this.commentService=e;this.authService=t;this.store=n;this.cdr=r}postId;comments$;isLoading$;error$;newCommentContent="";isLoadingMore=!1;initialLoadComplete=!1;visibleComments=[];isLoading=!0;error;offset=0;limit=10;hasMoreComments=!1;sortBy="recent";subscriptions=[];ngOnInit(){this.isLoading$=this.store.select(dt),this.error$=this.store.select(mt),this.comments$=this.store.select(pt(this.postId)),this.setSortBy("recent",!1),this.subscriptions.push(this.isLoading$.subscribe(e=>{this.isLoading=e,this.cdr.markForCheck()})),this.subscriptions.push(this.comments$.subscribe(e=>{if(this.initialLoadComplete&&this.visibleComments.length>0){let t=new Map;this.visibleComments.forEach(n=>{let r=document.querySelector(`app-comment[data-id="${n.id}"]`);r&&t.set(n.id,r.classList.contains("replies-expanded"))}),this.visibleComments=e}else this.visibleComments=e,this.initialLoadComplete=!0;this.hasMoreComments=e.length>=this.limit,this.offset=e.length,this.cdr.markForCheck()})),this.subscriptions.push(this.error$.subscribe(e=>{this.error=e||void 0,this.cdr.markForCheck()})),this.loadComments()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}get isLoggedIn(){return this.authService.isAuthenticated()}autoGrow(e){e.style.height="auto",e.style.height=e.scrollHeight+"px"}setSortBy(e,t=!0){this.sortBy!==e&&(this.sortBy=e,this.offset=0,t&&this.loadComments())}loadComments(){this.commentService.getPostComments(this.postId,this.limit,0,this.sortBy).subscribe({error:e=>{console.error("Error loading comments:",e)}})}loadMoreComments(){this.isLoadingMore||(this.isLoadingMore=!0,this.cdr.markForCheck(),this.commentService.getPostComments(this.postId,30,this.offset,this.sortBy).subscribe({next:e=>{this.hasMoreComments=e.length>=30,this.isLoadingMore=!1,this.cdr.markForCheck()},error:e=>{console.error("Error loading more comments:",e),this.isLoadingMore=!1,this.cdr.markForCheck()}}))}submitComment(){this.newCommentContent.trim()&&this.isLoggedIn&&this.commentService.createComment(this.postId,this.newCommentContent.trim()).subscribe({next:()=>{this.newCommentContent="",this.cdr.markForCheck()},error:e=>{console.error("Error creating comment:",e)}})}handleCommentDeleted(e){this.visibleComments=this.visibleComments.filter(t=>t.id!==e),this.cdr.markForCheck()}static \u0275fac=function(t){return new(t||i)(w(ne),w(j),w(te),w(ce))};static \u0275cmp=J({type:i,selectors:[["app-comments-section"]],inputs:{postId:"postId"},standalone:!0,features:[Q],decls:9,vars:5,consts:[["commentInput",""],[1,"comments-section"],[1,"comments-header"],["class","comment-form",4,"ngIf"],["class","login-prompt",4,"ngIf"],["class","error-message",4,"ngIf"],["class","loading",4,"ngIf"],["class","comments-list",4,"ngIf"],[1,"comment-form"],[1,"input-wrapper"],["placeholder","Write a comment...","rows","1",3,"ngModelChange","input","ngModel"],[1,"post-btn",3,"click","disabled"],[1,"material-icons"],[1,"login-prompt"],["routerLink","/signin"],[1,"error-message"],[1,"loading"],[1,"spinner"],[1,"comments-list"],["class","no-comments",4,"ngIf"],[3,"comment","deleted",4,"ngFor","ngForOf"],["class","load-more-container",4,"ngIf"],[1,"no-comments"],[3,"deleted","comment"],[1,"load-more-container"],[1,"load-more-btn",3,"click","disabled"],[4,"ngIf"]],template:function(t,n){t&1&&(o(0,"div",1)(1,"div",2)(2,"h3"),m(3,"Comments"),a()(),_(4,on,7,2,"div",3)(5,sn,6,0,"div",4)(6,an,2,1,"div",5)(7,cn,4,0,"div",6)(8,hn,4,3,"div",7),a()),t&2&&(s(4),l("ngIf",n.isLoggedIn),s(),l("ngIf",!n.isLoggedIn),s(),l("ngIf",n.error),s(),l("ngIf",n.isLoading),s(),l("ngIf",!n.isLoading))},dependencies:[ee,le,Z,pe,Oe,we,Ee,Te,me,de],styles:['.comments-section[_ngcontent-%COMP%]{padding:20px;background-color:var(--card-background);border-radius:var(--radius-md);border-top:1px solid var(--border-color);position:relative}.comments-section[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;width:100%;height:4px;background:linear-gradient(to right,rgba(var(--primary-color-rgb, 76, 175, 80),.1),rgba(var(--primary-color-rgb, 76, 175, 80),.3),rgba(var(--primary-color-rgb, 76, 175, 80),.1));border-radius:var(--radius-md) var(--radius-md) 0 0;transform:translateY(-4px);opacity:.8}.comments-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.comments-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:var(--text-color);margin:0;position:relative;padding-left:8px}.comments-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:20px;background-color:var(--primary-color);border-radius:var(--radius-full)}.comment-form[_ngcontent-%COMP%]{margin-bottom:20px;position:relative}.comment-form[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-12px;left:5%;right:5%;height:1px;background:linear-gradient(to right,rgba(var(--border-color-rgb, 200, 200, 200),0),rgba(var(--border-color-rgb, 200, 200, 200),.5),rgba(var(--border-color-rgb, 200, 200, 200),0))}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;border:2px solid var(--border-color);border-radius:var(--radius-full);padding:10px 14px;background-color:var(--hover-color);transition:all var(--transition-fast);box-shadow:0 2px 6px #0000000d}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]:focus-within{border-color:var(--primary-color);background-color:var(--card-background);box-shadow:0 4px 12px #4caf5026;transform:translateY(-2px)}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{flex:1;border:none;background:transparent;resize:none;padding:0;font-size:15px;min-height:24px;max-height:150px;overflow-y:auto;color:var(--text-color);line-height:1.5}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:var(--text-color);opacity:.6}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .post-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary-color);cursor:pointer;padding:6px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;transition:all var(--transition-fast);margin-left:8px;opacity:.8}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .post-btn[_ngcontent-%COMP%]:hover{background-color:var(--secondary-color);transform:translateY(-1px) scale(1.1);opacity:1}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .post-btn[_ngcontent-%COMP%]:disabled{color:var(--text-color);opacity:.4;cursor:not-allowed;transform:none}.comment-form[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .post-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:22px}.login-prompt[_ngcontent-%COMP%]{background-color:var(--hover-color);border-radius:var(--radius-md);padding:16px;margin-bottom:20px;text-align:center;font-size:15px;color:var(--text-color);border:1px solid var(--border-color);box-shadow:0 2px 6px #0000000d}.login-prompt[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary-color);text-decoration:none;font-weight:600;position:relative;display:inline-block;padding:0 2px}.login-prompt[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:2px;background-color:var(--primary-color);transform:scaleX(0);transform-origin:bottom right;transition:transform .3s ease}.login-prompt[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover:after{transform:scaleX(1);transform-origin:bottom left}.error-message[_ngcontent-%COMP%]{background-color:rgba(var(--error-color-rgb, 229, 57, 53),.1);border:1px solid rgba(var(--error-color-rgb, 229, 57, 53),.2);border-radius:var(--radius-md);padding:12px 16px;margin-bottom:16px;color:var(--error-color);font-size:14px;display:flex;align-items:center}.error-message[_ngcontent-%COMP%]:before{content:"error_outline";font-family:Material Icons;margin-right:8px;font-size:18px}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:30px 0}.loading[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:28px;height:28px;border:2px solid rgba(var(--primary-color-rgb, 76, 175, 80),.15);border-top:2px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:12px}.loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-color);opacity:.7;font-size:15px}.no-comments[_ngcontent-%COMP%]{text-align:center;padding:24px 0}.no-comments[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);opacity:.7;font-size:15px;margin:0;position:relative;display:inline-block;padding:16px 24px;border:1px dashed var(--border-color);border-radius:var(--radius-md);background-color:var(--hover-color)}.comments-list[_ngcontent-%COMP%]{margin-top:20px;animation:_ngcontent-%COMP%_fadeIn .4s ease;position:relative}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.load-more-container[_ngcontent-%COMP%]{text-align:center;padding:16px 0}.load-more-container[_ngcontent-%COMP%]   .load-more-btn[_ngcontent-%COMP%]{background-color:var(--hover-color);color:var(--primary-color);border:none;border-radius:var(--radius-md);padding:10px 20px;font-size:14px;font-weight:600;cursor:pointer;transition:all var(--transition-fast);box-shadow:0 2px 6px #0000000d}.load-more-container[_ngcontent-%COMP%]   .load-more-btn[_ngcontent-%COMP%]:hover{background-color:var(--secondary-color);transform:translateY(-2px);box-shadow:0 4px 10px #0000001a}.load-more-container[_ngcontent-%COMP%]   .load-more-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}'],changeDetection:0})};var Re=class i{constructor(e,t){this.authService=e;this.mediaService=t;this.supabase=ue(B.supabaseUrl,B.supabaseKey)}supabase;getPost(e){return v(this.supabase.from("posts").select(`
          *, 
          users:user_id(*),
          shared_post:shared_post_id(*, users:user_id(*))
        `).eq("id",e).single()).pipe(h(({data:t,error:n})=>{if(n)throw n;return this.mapPostFromSupabase(t)}),g(t=>C(()=>t)))}hidePost(e,t){return v(this.supabase.from("user_hidden_posts").insert({user_id:t,post_id:e})).pipe(h(({error:n})=>{if(n)throw n}),g(n=>C(()=>n)))}savePost(e,t){return v(this.supabase.from("user_saved_posts").insert({user_id:t,post_id:e})).pipe(h(({error:n})=>{if(n)throw n}),g(n=>C(()=>n)))}unsavePost(e,t){return v(this.supabase.from("user_saved_posts").delete().match({user_id:t,post_id:e})).pipe(h(({error:n})=>{if(n)throw n}),g(n=>C(()=>n)))}unhidePost(e,t){return v(this.supabase.from("user_hidden_posts").delete().match({user_id:t,post_id:e})).pipe(h(({error:n})=>{if(n)throw n}),g(n=>C(()=>n)))}isPostSaved(e,t){return v(this.supabase.from("user_saved_posts").select("*").match({user_id:t,post_id:e})).pipe(h(({data:n,error:r})=>{if(r)throw r;return n.length>0}),g(n=>C(()=>n)))}isPostHidden(e,t){return v(this.supabase.from("user_hidden_posts").select("*").match({user_id:t,post_id:e})).pipe(h(({data:n,error:r})=>{if(r)throw r;return n.length>0}),g(n=>C(()=>n)))}getSavedPosts(e){return v(this.supabase.from("user_saved_posts").select(`
        post_id, 
        posts:post_id(
          *, 
          users:user_id(*),
          shared_post:shared_post_id(*, users:user_id(*))
        )
      `).eq("user_id",e).order("saved_at",{ascending:!1})).pipe(I(({data:t,error:n})=>{if(n)throw n;if(!t||t.length===0)return y([]);let r=t.map(d=>this.mapPostFromSupabase(d.posts)),c=[];return r.forEach(d=>{c.push(this.getPostMedia(d.id).pipe(h(u=>(d.media=u,d)))),d.sharedPostId&&d.sharedPost&&c.push(this.getPostMedia(d.sharedPostId).pipe(h(u=>(d.sharedPost&&(d.sharedPost.media=u),d))))}),ve(c).pipe(g(()=>y(r)))}),g(t=>(console.error("Error fetching saved posts:",t),C(()=>t))))}sharePost(e,t){let n=this.authService.user?.id;if(!n)return C(()=>new Error("User not authenticated"));let r={user_id:n,content:t||"",privacy_level:"public",shared_post_id:e,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return v(this.supabase.from("posts").insert(r).select("*")).pipe(h(({data:c,error:d})=>{if(d)throw d;if(!c||c.length===0)throw new Error("Failed to share post");return new Pe({id:c[0].id,userId:c[0].user_id,content:c[0].content,privacyLevel:c[0].privacy_level,sharedPostId:c[0].shared_post_id,createdAt:new Date(c[0].created_at),updatedAt:new Date(c[0].updated_at)})}),g(c=>(console.error("Error sharing post:",c),C(()=>c))))}getPostShareCount(e){return v(this.supabase.from("post_share_counts").select("count").eq("post_id",e).single()).pipe(h(({data:t,error:n})=>{if(n){if(n.code==="PGRST116")return 0;throw n}return t?.count||0}),g(t=>(console.error("Error getting post share count:",t),y(0))))}getPostShareCountObservable(e){this.getPostShareCount(e).subscribe();let t=this.supabase.channel(`post-share-count-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"post_share_counts",filter:`post_id=eq.${e}`},n=>{this.getPostShareCount(e).subscribe()}).subscribe();return this.getPostShareCount(e)}getShareableLink(e){let t=`${window.location.origin}/post/${e}`;return new Ke(n=>{n.next(t),n.complete()})}getHomeFeed(){let e=this.authService.user?.id,t=this.supabase.from("posts").select(`
      *, 
      users:user_id(*),
      shared_post:shared_post_id(*, users:user_id(*))
    `).order("created_at",{ascending:!1}).limit(20);return e?t=t.or(`privacy_level.eq.public,user_id.eq.${e}`):t=t.eq("privacy_level","public"),v(t).pipe(I(({data:n,error:r})=>{if(r)throw r;if(!n||n.length===0)return y([]);let c=n.map(f=>this.mapPostFromSupabase(f)),d=c.map(f=>this.mediaService.getPostMedia(f.id).pipe(h(S=>(f.media=S,f.sharedPostId&&f.sharedPost,f)))),u=c.filter(f=>f.sharedPostId&&f.sharedPost).map(f=>this.mediaService.getPostMedia(f.sharedPostId).pipe(h(S=>(f.sharedPost&&(f.sharedPost.media=S),f))));return ve([...d,...u]).pipe(h(()=>c))}),g(n=>(console.error("Error fetching home feed:",n),C(()=>n))))}mapPostFromSupabase(e){let t;e.users&&(t={id:e.users.id,username:e.users.username,email:e.users.email,fullName:e.users.full_name,avatarUrl:e.users.avatar_url,bio:e.users.bio,theme:e.users.theme||"light",privacySettings:e.users.privacy_settings||{postsVisibility:"public",profileVisibility:"public"},createdAt:new Date(e.users.created_at),updatedAt:new Date(e.users.updated_at)});let n=new Pe({id:e.id,userId:e.user_id,content:e.content,privacyLevel:e.privacy_level,groupId:e.group_id,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),user:t,sharedPostId:e.shared_post_id});if(e.shared_post){let r;e.shared_post.users&&(r={id:e.shared_post.users.id,username:e.shared_post.users.username,email:e.shared_post.users.email,fullName:e.shared_post.users.full_name,avatarUrl:e.shared_post.users.avatar_url,bio:e.shared_post.users.bio,theme:e.shared_post.users.theme||"light",privacySettings:e.shared_post.users.privacy_settings||{postsVisibility:"public",profileVisibility:"public"},createdAt:new Date(e.shared_post.users.created_at),updatedAt:new Date(e.shared_post.users.updated_at)}),n.sharedPost=new Pe({id:e.shared_post.id,userId:e.shared_post.user_id,content:e.shared_post.content,privacyLevel:e.shared_post.privacy_level,groupId:e.shared_post.group_id,createdAt:new Date(e.shared_post.created_at),updatedAt:new Date(e.shared_post.updated_at),user:r})}return n}createPost(e){return v(this.supabase.from("posts").insert({user_id:e.userId,content:e.content,privacy_level:e.privacyLevel,created_at:e.createdAt,updated_at:e.updatedAt}).select("*")).pipe(h(({data:t,error:n})=>{if(n)throw console.error("Supabase error creating post:",n),n;if(!t||t.length===0)throw new Error("No data returned from post creation");return new Pe({id:t[0].id,userId:t[0].user_id,content:t[0].content,privacyLevel:t[0].privacy_level,createdAt:new Date(t[0].created_at),updatedAt:new Date(t[0].updated_at)})}),g(t=>(console.error("Error in createPost:",t),t.code==="42501"&&(t.isRlsError=!0),C(()=>t))))}addMediaToPost(e,t){if(!t||t.length===0)return y(void 0);let n=t.map(r=>({post_id:e,url:r.url,media_type:r.mediaType,order_index:r.orderIndex}));return v(this.supabase.from("media").insert(n)).pipe(h(({error:r})=>{if(r)throw console.error("Supabase error adding media:",r),r}),g(r=>(console.error("Error in addMediaToPost:",r),C(()=>r))))}uploadMedia(e,t){let n=t;return new Promise((r,c)=>{this.supabase.storage.from("post-media").upload(n,e).then(d=>{if(d.error){console.error("Supabase storage upload error:",d.error),c(d.error);return}let{data:u}=this.supabase.storage.from("post-media").getPublicUrl(n);r(u.publicUrl)}).catch(d=>{console.error("Upload error:",d),c(d)})})}getPostsByUsername(e){return v(this.supabase.from("users").select("id").eq("username",e).single()).pipe(I(({data:t,error:n})=>{if(n)throw n;if(!t)return y([]);let r=t.id;return v(this.supabase.from("posts").select(`
              *, 
              users:user_id(*),
              shared_post:shared_post_id(*, users:user_id(*))
            `).eq("user_id",r).order("created_at",{ascending:!1}))}),I(t=>{let{data:n,error:r}=t;if(r)throw r;if(!n||n.length===0)return y([]);let c=n.map(u=>this.mapPostFromSupabase(u)),d=[];return c.forEach(u=>{d.push(this.getPostMedia(u.id).pipe(h(f=>(u.media=f,u)))),u.sharedPostId&&u.sharedPost&&d.push(this.getPostMedia(u.sharedPostId).pipe(h(f=>(u.sharedPost&&(u.sharedPost.media=f),u))))}),ve(d).pipe(g(()=>y(c)))}),g(t=>(console.error("Error fetching posts by username:",t),y([]))))}createPostWithMedia(e,t){return this.createPost(e).pipe(I(n=>!t||t.length===0?y(n):this.mediaService.uploadMultiplePostMedia(t,n.id).pipe(h(r=>(n.media=r,n)))),g(n=>(console.error("Error creating post with media:",n),C(()=>n))))}getPostMedia(e){return this.mediaService.getPostMedia(e)}deletePost(e){return this.mediaService.getPostMedia(e).pipe(I(t=>v(this.supabase.from("posts").delete().eq("id",e)).pipe(h(({error:n})=>{if(n)throw n;return t}))),I(t=>{if(!t||t.length===0)return y(void 0);let n=t.map(r=>this.mediaService.deleteMedia(r.id));return ve(n).pipe(h(()=>{}))}),g(t=>C(()=>t)))}getMediaForMultiplePosts(e){if(!e||e.length===0)return y({});let t=[...new Set(e)];return v(this.supabase.from("media").select("*").in("post_id",t).order("order_index",{ascending:!0})).pipe(h(({data:n,error:r})=>{if(r)throw r;let c={};return t.forEach(d=>{c[d]=[]}),n&&n.length>0&&n.forEach(d=>{d.post_id&&(c[d.post_id]||(c[d.post_id]=[]),c[d.post_id].push(new ke({id:d.id,postId:d.post_id,messageId:d.message_id,url:d.url,mediaType:d.media_type,orderIndex:d.order_index,createdAt:new Date(d.created_at)})))}),c}),g(n=>(console.error("Error fetching media for multiple posts:",n),y({}))))}static \u0275fac=function(t){return new(t||i)(G(j),G(lt))};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};function fn(i,e){if(i&1){let t=O();o(0,"button",7),b("click",function(){x(t);let r=p(2);return P(r.prevMedia())}),o(1,"span",8),m(2,"chevron_left"),a()()}if(i&2){let t=p(2);l("disabled",t.currentIndex===0)}}function vn(i,e){if(i&1&&D(0,"img",11),i&2){let t=p(3);l("src",t.currentMedia.url,V)}}function Cn(i,e){if(i&1&&(o(0,"video",12),D(1,"source",13)(2,"source",14)(3,"source",15)(4,"source",16),o(5,"p"),m(6,"Your browser does not support video playback."),a()()),i&2){let t=p(3);s(),l("src",t.currentMedia.url,V),s(),l("src",t.currentMedia.url,V),s(),l("src",t.currentMedia.url,V),s(),l("src",t.currentMedia.url,V)}}function bn(i,e){if(i&1&&(et(0),_(1,vn,1,1,"img",9)(2,Cn,7,4,"video",10),tt()),i&2){let t=p(2);s(),l("ngIf",t.currentMedia.isImage),s(),l("ngIf",t.currentMedia.isVideo)}}function _n(i,e){if(i&1){let t=O();o(0,"button",17),b("click",function(){x(t);let r=p(2);return P(r.nextMedia())}),o(1,"span",8),m(2,"chevron_right"),a()()}if(i&2){let t=p(2);l("disabled",t.currentIndex===t.media.length-1)}}function xn(i,e){if(i&1){let t=O();o(0,"button",20),b("click",function(){let r=x(t).index,c=p(3);return P(c.goToMedia(r))}),a()}if(i&2){let t=e.index,n=p(3);X("active",t===n.currentIndex)}}function Pn(i,e){if(i&1&&(o(0,"div",18),_(1,xn,1,2,"button",19),a()),i&2){let t=p(2);s(),l("ngForOf",t.media)}}function kn(i,e){if(i&1&&(o(0,"div",1)(1,"div",2),_(2,fn,3,1,"button",3)(3,bn,3,2,"ng-container",4)(4,_n,3,1,"button",5),a(),_(5,Pn,2,1,"div",6),a()),i&2){let t=p();s(2),l("ngIf",t.hasMultipleMedia),s(),l("ngIf",t.currentMedia),s(),l("ngIf",t.hasMultipleMedia),s(),l("ngIf",t.hasMultipleMedia)}}var De=class i{_media=[];set media(e){console.log("Media-display received media:",e),e&&e.length>0?this._media=e.map(t=>t instanceof ke?t:new ke(t)):this._media=[]}get media(){return this._media}currentIndex=0;get hasMedia(){return this._media&&this._media.length>0}get hasMultipleMedia(){return this.media.length>1}get currentMedia(){return this.media[this.currentIndex]||null}ngOnChanges(e){e.media&&(console.log("Media-display media changed:",this._media),this.currentIndex=0)}nextMedia(){this.currentIndex<this.media.length-1&&this.currentIndex++}prevMedia(){this.currentIndex>0&&this.currentIndex--}goToMedia(e){e>=0&&e<this.media.length&&(this.currentIndex=e)}ngAfterViewInit(){this.hasMedia&&this.currentMedia&&(console.log("Media type:",this.currentMedia.mediaType),console.log("Is video:",this.currentMedia.isVideo),console.log("Media URL:",this.currentMedia.url))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=J({type:i,selectors:[["app-media-display"]],inputs:{media:"media"},standalone:!0,features:[Je,Q],decls:1,vars:1,consts:[["class","media-container",4,"ngIf"],[1,"media-container"],[1,"media-display"],["class","nav-btn prev",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["class","nav-btn next",3,"disabled","click",4,"ngIf"],["class","media-pagination",4,"ngIf"],[1,"nav-btn","prev",3,"click","disabled"],[1,"material-icons"],["alt","Post image","class","media-image",3,"src",4,"ngIf"],["controls","","preload","metadata","class","media-video",4,"ngIf"],["alt","Post image",1,"media-image",3,"src"],["controls","","preload","metadata",1,"media-video"],["type","video/mp4",3,"src"],["type","video/webm",3,"src"],["type","video/ogg",3,"src"],["type","video/mp3",3,"src"],[1,"nav-btn","next",3,"click","disabled"],[1,"media-pagination"],["class","pagination-dot",3,"active","click",4,"ngFor","ngForOf"],[1,"pagination-dot",3,"click"]],template:function(t,n){t&1&&_(0,kn,6,4,"div",0),t&2&&l("ngIf",n.hasMedia)},dependencies:[ee,le,Z],styles:[".media-container[_ngcontent-%COMP%]{position:relative;border-radius:var(--radius-md);overflow:hidden;background-color:var(--hover-color);width:100%;box-shadow:inset 0 0 10px #0000000d}.media-display[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;overflow:hidden;max-height:550px;min-height:200px;width:100%}.media-image[_ngcontent-%COMP%]{width:100%;max-height:550px;object-fit:contain;display:block;transition:transform .35s cubic-bezier(.25,1,.5,1)}.media-image[_ngcontent-%COMP%]:hover{transform:scale(1.03)}.media-video[_ngcontent-%COMP%]{width:100%;max-height:550px;background-color:#000;display:block}.media-video[_ngcontent-%COMP%]::-webkit-media-controls{background-color:transparent}.media-video[_ngcontent-%COMP%]::-webkit-media-controls-panel{background-color:#00000080}.nav-btn[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);background-color:#ffffffd9;border:none;border-radius:var(--radius-full);width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:2;transition:all .25s cubic-bezier(.25,1,.5,1);box-shadow:0 3px 10px #00000026;opacity:.5}.nav-btn[_ngcontent-%COMP%]:hover{background-color:#fffffff2;transform:translateY(-50%) scale(1.1);opacity:1;box-shadow:0 5px 15px #0003}.nav-btn[_ngcontent-%COMP%]:active{transform:translateY(-50%) scale(.95)}.nav-btn[_ngcontent-%COMP%]:disabled{opacity:.3;cursor:not-allowed;transform:translateY(-50%);box-shadow:none}.nav-btn[_ngcontent-%COMP%]:disabled:hover{background-color:#ffffffd9;transform:translateY(-50%)}.nav-btn.prev[_ngcontent-%COMP%]{left:16px}.nav-btn.next[_ngcontent-%COMP%]{right:16px}.nav-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:24px;color:var(--text-color);transition:transform .2s ease}.nav-btn[_ngcontent-%COMP%]:hover   .material-icons[_ngcontent-%COMP%]{transform:scale(1.2)}.nav-btn[_ngcontent-%COMP%]   .fallback-icon[_ngcontent-%COMP%]{fill:var(--text-color);width:24px;height:24px}.media-container[_ngcontent-%COMP%]:hover   .nav-btn[_ngcontent-%COMP%]{opacity:.9}.media-container[_ngcontent-%COMP%]:hover   .media-image[_ngcontent-%COMP%]{transform:scale(1.03)}.media-pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;position:absolute;bottom:16px;width:100%;z-index:2;gap:6px}.pagination-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:var(--radius-full);background-color:#ffffff80;padding:0;border:none;cursor:pointer;transition:all .25s cubic-bezier(.25,1,.5,1);box-shadow:0 1px 3px #0003}.pagination-dot[_ngcontent-%COMP%]:hover{background-color:#ffffffe6;transform:scale(1.3);box-shadow:0 2px 5px #0000004d}.pagination-dot.active[_ngcontent-%COMP%]{width:10px;height:10px;background-color:#fff;transform:scale(1.3);box-shadow:0 0 0 2px #ffffff4d,0 2px 5px #0000004d}@media (max-width: 768px){.media-display[_ngcontent-%COMP%]{max-height:450px;min-height:180px}.nav-btn[_ngcontent-%COMP%]{width:40px;height:40px}.nav-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:22px}.pagination-dot[_ngcontent-%COMP%]{width:7px;height:7px}}@media (max-width: 480px){.media-display[_ngcontent-%COMP%]{max-height:320px;min-height:150px}.nav-btn[_ngcontent-%COMP%]{width:36px;height:36px}.nav-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:20px}}"]})};var Ut=i=>["/profile",i];function Mn(i,e){if(i&1){let t=O();o(0,"li")(1,"button",25),b("click",function(){x(t);let r=p(2);return P(r.deletePost())}),o(2,"span",9),m(3,"delete"),a(),m(4," Delete post "),a()()}}function yn(i,e){if(i&1){let t=O();o(0,"div",23)(1,"ul"),_(2,Mn,5,0,"li",24),o(3,"li")(4,"button",25),b("click",function(){x(t);let r=p();return P(r.hidePost())}),o(5,"span",9),m(6,"visibility_off"),a(),m(7," Hide post "),a()(),o(8,"li")(9,"button",25),b("click",function(){x(t);let r=p();return P(r.toggleSavePost())}),o(10,"span",9),m(11),a(),m(12),a()(),o(13,"li")(14,"button",25),b("click",function(){x(t);let r=p();return P(r.copyLinkToClipboard())}),o(15,"span",9),m(16,"link"),a(),m(17," Copy link "),a()()()()}if(i&2){let t=p();s(2),l("ngIf",t.isPostOwner),s(9),z(t.isSaved?"bookmark":"bookmark_border"),s(),T(" ",t.isSaved?"Unsave post":"Save post"," ")}}function Sn(i,e){if(i&1&&(o(0,"div",26)(1,"span",9),m(2,"repeat"),a(),o(3,"span"),m(4),a()()),i&2){let t=p();s(4),T("",(t.post.user==null?null:t.post.user.username)||"User"," shared a post")}}function On(i,e){if(i&1&&(o(0,"div",27),m(1),a()),i&2){let t=p();s(),T(" ",t.post.content," ")}}function wn(i,e){if(i&1&&(o(0,"div",28),D(1,"app-media-display",29),a()),i&2){let t=p();s(),l("media",t.post.media)}}function En(i,e){if(i&1&&(o(0,"div",38),D(1,"app-media-display",29),a()),i&2){let t=p(2);s(),l("media",t.post.sharedPost.media)}}function Ln(i,e){if(i&1&&(o(0,"div",30)(1,"div",31),D(2,"img",32),o(3,"div",33)(4,"a",34),m(5),a(),o(6,"span",35),m(7),a()()(),o(8,"div",36),m(9),a(),_(10,En,2,1,"div",37),a()),i&2){let t=p();s(2),l("src",(t.post.sharedPost.user==null?null:t.post.sharedPost.user.avatarUrl)||"/assets/default-avatar.png",V),s(2),l("routerLink",ae(6,Ut,t.post.sharedPost.user==null?null:t.post.sharedPost.user.username)),s(),T(" ",t.post.sharedPost.user==null?null:t.post.sharedPost.user.username," "),s(2),z(t.post.sharedPost.timeSince),s(2),T(" ",t.post.sharedPost.content," "),s(),l("ngIf",t.post.sharedPost.media&&t.post.sharedPost.media.length>0||t.hasSharedPostMedia)}}function In(i,e){if(i&1&&(o(0,"div",43)(1,"span",44),m(2,"favorite"),a(),o(3,"span"),m(4),a()()),i&2){let t=p(2);s(4),z(t.likeCount)}}function Tn(i,e){if(i&1){let t=O();o(0,"div",45),b("click",function(){x(t);let r=p(2);return P(r.toggleComments())}),o(1,"span"),m(2),a()()}if(i&2){let t=p(2);s(2),it("",t.commentCount," ",t.commentCount===1?"comment":"comments","")}}function Fn(i,e){if(i&1&&(o(0,"div",46)(1,"span",47),m(2,"repeat"),a(),o(3,"span"),m(4),a()()),i&2){let t=p(2);s(4),z(t.sharesCount)}}function Rn(i,e){if(i&1&&(o(0,"div",39),_(1,In,5,1,"div",40)(2,Tn,3,2,"div",41)(3,Fn,5,1,"div",42),a()),i&2){let t=p();s(),l("ngIf",t.likeCount>0),s(),l("ngIf",t.commentCount>0),s(),l("ngIf",t.sharesCount>0)}}function Dn(i,e){if(i&1&&(o(0,"div",48),D(1,"app-comments-section",49),a()),i&2){let t=p();s(),l("postId",t.post.id)}}var Dt=class i{constructor(e,t,n,r,c,d,u){this.postService=e;this.likeService=t;this.commentService=n;this.store=r;this.cdr=c;this.el=d;this.renderer=u}post;deleted=new Ce;unsaved=new Ce;isSaved=!1;isHidden=!1;currentUserId=null;showActions=!1;showComments=!1;isLiked=!1;likeCount=0;commentCount=0;isLikeInProgress=!1;hasSharedPostMedia=!1;sharesCount=0;isShareModalOpen=!1;shareComment="";isSharing=!1;shareTab="repost";userSubscription;isAuthenticatedSubscription;likeCountSubscription;likeStatusSubscription;commentCountSubscription;shareCountSubscription;subscriptions=[];modalElement=null;ngOnInit(){this.userSubscription=this.store.select(ct).subscribe(e=>{this.currentUserId=e?.id||null,this.currentUserId&&this.post&&this.checkSavedStatus()}),this.likeCountSubscription=this.likeService.getPostLikesObservable(this.post.id).subscribe(e=>{this.likeCount=e,this.cdr.markForCheck()}),this.likeStatusSubscription=this.likeService.getUserPostLikeObservable(this.post.id).subscribe(e=>{this.isLiked!==e&&(this.isLiked=e,this.cdr.markForCheck())}),this.commentCountSubscription=this.commentService.getCommentCountObservable(this.post.id).subscribe(e=>{this.commentCount=e,this.cdr.markForCheck()}),this.shareCountSubscription=this.postService.getPostShareCount(this.post.id).subscribe(e=>{this.sharesCount=e,this.cdr.markForCheck()}),this.renderer.listen("document","click",e=>{this.isShareModalOpen&&this.modalElement&&this.modalElement===e.target&&(this.closeShareModal(),e.preventDefault(),e.stopPropagation())}),this.loadMediaForPost()}loadMediaForPost(){this.postService.getPostMedia(this.post.id).pipe(A(1)).subscribe({next:e=>{e&&e.length>0&&(this.post.media=e,this.cdr.markForCheck())},error:e=>{console.error(`Error loading media for post ${this.post.id}:`,e)}}),this.post.sharedPost&&this.post.sharedPostId&&this.postService.getPostMedia(this.post.sharedPostId).pipe(A(1)).subscribe({next:e=>{this.post.sharedPost&&(this.post.sharedPost.media=e,e&&e.length>0&&(this.hasSharedPostMedia=!0),this.cdr.markForCheck())},error:e=>{console.error("Error loading media for shared post:",e)}})}ngOnDestroy(){this.userSubscription&&this.userSubscription.unsubscribe(),this.isAuthenticatedSubscription&&this.isAuthenticatedSubscription.unsubscribe(),this.likeCountSubscription&&this.likeCountSubscription.unsubscribe(),this.likeStatusSubscription&&this.likeStatusSubscription.unsubscribe(),this.commentCountSubscription&&this.commentCountSubscription.unsubscribe(),this.shareCountSubscription&&this.shareCountSubscription.unsubscribe(),this.subscriptions.forEach(e=>e.unsubscribe()),this.closeShareModal()}checkSavedStatus(){this.currentUserId&&this.postService.isPostSaved(this.post.id,this.currentUserId).subscribe(e=>{this.isSaved=e,this.cdr.markForCheck()})}checkLikeStatus(){this.currentUserId&&this.likeService.hasUserLikedPost(this.post.id).subscribe(e=>{this.isLiked!==e&&(console.log(`Setting initial like status for post ${this.post.id}: ${e}`),this.isLiked=e,this.cdr.markForCheck())})}toggleLike(){if(this.isLikeInProgress){console.log("Like operation already in progress, ignoring click");return}this.store.select(ye).pipe(A(1)).subscribe(e=>{if(!e){console.log("User not authenticated");return}this.isLikeInProgress=!0,setTimeout(()=>{this.isLikeInProgress=!1},1500),this.likeService.togglePostLike(this.post.id).subscribe({next:()=>{console.log("Toggle like successful"),this.isLikeInProgress=!1,this.cdr.markForCheck()},error:t=>{console.error("Error toggling post like:",t),this.isLikeInProgress=!1,this.cdr.markForCheck()}})})}toggleComments(){console.log("Toggle comments clicked, current state:",this.showComments),this.showComments=!this.showComments,this.cdr.markForCheck()}toggleSavePost(){this.store.select(ye).pipe(A(1)).subscribe(e=>{!e||!this.currentUserId||(this.isSaved?this.postService.unsavePost(this.post.id,this.currentUserId).subscribe(()=>{this.isSaved=!1,this.unsaved.emit(this.post.id),this.cdr.markForCheck()}):this.postService.savePost(this.post.id,this.currentUserId).subscribe(()=>{this.isSaved=!0,this.cdr.markForCheck()}))})}hidePost(){this.store.select(ye).pipe(A(1)).subscribe(e=>{!e||!this.currentUserId||this.postService.hidePost(this.post.id,this.currentUserId).subscribe(()=>{this.isHidden=!0,this.cdr.markForCheck()})})}deletePost(){this.postService.deletePost(this.post.id).subscribe({next:()=>{this.deleted.emit(this.post.id)},error:e=>{console.error("Error deleting post:",e)}})}sharePost(){this.store.select(ye).pipe(A(1)).subscribe(e=>{if(!e){console.log("User not authenticated");return}this.isShareModalOpen=!0,this.shareComment="",this.shareTab="repost",this.createShareModal(),this.cdr.markForCheck()})}createShareModal(){this.modalElement||(this.modalElement=this.renderer.createElement("div"),this.renderer.addClass(this.modalElement,"share-modal-overlay"),this.renderer.appendChild(document.body,this.modalElement)),this.renderShareModalContent()}renderShareModalContent(){if(!this.modalElement)return;this.modalElement.innerHTML="";let e=this.renderer.createElement("div");this.renderer.addClass(e,"share-modal");let t=this.renderer.createElement("div");this.renderer.addClass(t,"modal-header");let n=this.renderer.createElement("h3");this.renderer.appendChild(n,this.renderer.createText("Share Post"));let r=this.renderer.createElement("button");this.renderer.addClass(r,"close-btn"),this.renderer.listen(r,"click",()=>this.closeShareModal());let c=this.renderer.createElement("span");this.renderer.addClass(c,"material-icons"),this.renderer.appendChild(c,this.renderer.createText("close")),this.renderer.appendChild(r,c),this.renderer.appendChild(t,n),this.renderer.appendChild(t,r),this.renderer.appendChild(e,t);let d=this.renderer.createElement("div");this.renderer.addClass(d,"share-tabs");let u=this.renderer.createElement("button");this.renderer.addClass(u,"share-tab"),this.shareTab==="repost"&&this.renderer.addClass(u,"active"),this.renderer.appendChild(u,this.renderer.createText("Repost")),this.renderer.listen(u,"click",()=>{this.shareTab="repost",this.renderShareModalContent()});let f=this.renderer.createElement("button");this.renderer.addClass(f,"share-tab"),this.shareTab==="external"&&this.renderer.addClass(f,"active"),this.renderer.appendChild(f,this.renderer.createText("Share Externally")),this.renderer.listen(f,"click",()=>{this.shareTab="external",this.renderShareModalContent()}),this.renderer.appendChild(d,u),this.renderer.appendChild(d,f),this.renderer.appendChild(e,d);let S=this.renderer.createElement("div");this.renderer.addClass(S,"modal-body");let F=this.renderer.createElement("div");this.renderer.addClass(F,"original-post-preview");let se=this.renderer.createElement("div");this.renderer.addClass(se,"preview-header");let ie=this.renderer.createElement("img");this.renderer.setAttribute(ie,"src",this.post.user?.avatarUrl||"/assets/default-avatar.png"),this.renderer.setAttribute(ie,"alt","User avatar"),this.renderer.addClass(ie,"small-avatar");let re=this.renderer.createElement("div");this.renderer.addClass(re,"preview-user");let Ue=this.renderer.createElement("div");this.renderer.addClass(Ue,"preview-username"),this.renderer.appendChild(Ue,this.renderer.createText(this.post.user?.username||"User"));let Ae=this.renderer.createElement("div");this.renderer.addClass(Ae,"preview-time"),this.renderer.appendChild(Ae,this.renderer.createText(this.post.timeSince)),this.renderer.appendChild(re,Ue),this.renderer.appendChild(re,Ae),this.renderer.appendChild(se,ie),this.renderer.appendChild(se,re),this.renderer.appendChild(F,se);let ze=this.renderer.createElement("div");if(this.renderer.addClass(ze,"preview-content"),this.renderer.appendChild(ze,this.renderer.createText(this.post.content)),this.renderer.appendChild(F,ze),this.post.hasMedia){let R=this.renderer.createElement("div");this.renderer.addClass(R,"preview-media-indicator"),this.renderer.appendChild(R,this.renderer.createText("Media content")),this.renderer.appendChild(F,R)}if(this.renderer.appendChild(S,F),this.shareTab==="repost"){let R=this.renderer.createElement("div");this.renderer.addClass(R,"tab-pane"),this.renderer.addClass(R,"active");let $=this.renderer.createElement("div");this.renderer.addClass($,"share-comment-container");let q=this.renderer.createElement("textarea");this.renderer.addClass(q,"share-comment"),this.renderer.setAttribute(q,"placeholder","Add a comment to your repost..."),this.isSharing&&this.renderer.setAttribute(q,"disabled","true"),this.renderer.appendChild(q,this.renderer.createText(this.shareComment)),this.renderer.listen(q,"input",N=>{this.shareComment=N.target.value}),this.renderer.appendChild($,q),this.renderer.appendChild(R,$);let W=this.renderer.createElement("div");this.renderer.addClass(W,"share-options");let U=this.renderer.createElement("button");if(this.renderer.addClass(U,"share-btn"),this.isSharing&&this.renderer.setAttribute(U,"disabled","true"),this.isSharing){let N=this.renderer.createElement("span");this.renderer.addClass(N,"spinner"),this.renderer.appendChild(U,N),this.renderer.appendChild(U,this.renderer.createText(" Sharing..."))}else this.renderer.appendChild(U,this.renderer.createText("Repost"));this.renderer.listen(U,"click",()=>this.submitShare()),this.renderer.appendChild(W,U),this.renderer.appendChild(R,W),this.renderer.appendChild(S,R)}else{let R=this.renderer.createElement("div");this.renderer.addClass(R,"tab-pane"),this.renderer.addClass(R,"active");let $=this.renderer.createElement("div");this.renderer.addClass($,"external-share-options");let q=this.renderer.createElement("p");this.renderer.appendChild(q,this.renderer.createText("Share this post with others:"));let W=this.renderer.createElement("div");this.renderer.addClass(W,"share-link-container");let U=this.renderer.createElement("input");this.renderer.addClass(U,"share-link"),this.renderer.setAttribute(U,"type","text"),this.renderer.setAttribute(U,"readonly","true"),this.renderer.setAttribute(U,"value",`${window.location.origin}/post/${this.post.id}`);let N=this.renderer.createElement("button");this.renderer.addClass(N,"copy-link-btn"),this.renderer.appendChild(N,this.renderer.createText("Copy")),this.renderer.listen(N,"click",()=>this.copyLinkToClipboard()),this.renderer.appendChild(W,U),this.renderer.appendChild(W,N);let je=this.renderer.createElement("div");this.renderer.addClass(je,"share-buttons");let fe=this.renderer.createElement("button");this.renderer.addClass(fe,"share-external-btn");let $e=this.renderer.createElement("span");this.renderer.addClass($e,"material-icons"),this.renderer.appendChild($e,this.renderer.createText("share")),this.renderer.appendChild(fe,$e),this.renderer.appendChild(fe,this.renderer.createText(" Share")),this.renderer.listen(fe,"click",()=>this.shareExternally()),this.renderer.appendChild(je,fe),this.renderer.appendChild($,q),this.renderer.appendChild($,W),this.renderer.appendChild($,je),this.renderer.appendChild(R,$),this.renderer.appendChild(S,R)}this.renderer.appendChild(e,S);let Ve=this.renderer.createElement("div");this.renderer.addClass(Ve,"modal-footer");let ge=this.renderer.createElement("button");this.renderer.addClass(ge,"cancel-share-btn"),this.isSharing&&this.renderer.setAttribute(ge,"disabled","true"),this.renderer.appendChild(ge,this.renderer.createText("Cancel")),this.renderer.listen(ge,"click",()=>this.closeShareModal()),this.renderer.appendChild(Ve,ge),this.renderer.appendChild(e,Ve),this.renderer.appendChild(this.modalElement,e)}closeShareModal(){this.modalElement&&(this.renderer.removeChild(document.body,this.modalElement),this.modalElement=null),this.isShareModalOpen=!1,this.cdr.markForCheck()}submitShare(){this.isSharing||(this.isSharing=!0,this.renderShareModalContent(),this.cdr.markForCheck(),this.postService.sharePost(this.post.id,this.shareComment).pipe(I(()=>this.postService.getPostShareCount(this.post.id)),g(e=>(console.error("Error sharing post:",e),C(()=>e))),H(()=>{this.isSharing=!1,this.closeShareModal(),this.cdr.markForCheck(),this.refreshFeed()})).subscribe({next:e=>{this.sharesCount=e,this.cdr.markForCheck()},error:e=>{console.error("Share error:",e)}}))}shareExternally(){navigator.share?navigator.share({title:"Check out this post",text:this.post.content.substring(0,100)+(this.post.content.length>100?"...":""),url:`${window.location.origin}/post/${this.post.id}`}).then(()=>console.log("Successful share")).catch(e=>console.log("Error sharing:",e)):this.copyLinkToClipboard()}copyLinkToClipboard(){let e=`${window.location.origin}/post/${this.post.id}`;navigator.clipboard.writeText(e).then(()=>{alert("Link copied to clipboard!"),this.closeShareModal()})}refreshFeed(){let e=document.querySelector("app-feed");if(e)try{e.loadPosts()}catch(t){console.error("Error refreshing feed:",t)}}toggleActions(){this.showActions=!this.showActions,this.cdr.markForCheck()}get isPostOwner(){return this.currentUserId===this.post.userId}static \u0275fac=function(t){return new(t||i)(w(Re),w(he),w(ne),w(te),w(ce),w(Xe),w(Qe))};static \u0275cmp=J({type:i,selectors:[["app-post-card"]],inputs:{post:"post"},outputs:{deleted:"deleted",unsaved:"unsaved"},standalone:!0,features:[Q],decls:41,vars:22,consts:[[1,"post-card"],[1,"post-header"],[1,"user-info"],["alt","User avatar",1,"avatar",3,"src"],[1,"user-details"],[1,"username",3,"routerLink","title"],[1,"metadata"],[1,"timestamp"],["aria-label","Post options",1,"options-btn",3,"click"],[1,"material-icons"],["class","action-menu",4,"ngIf"],["class","shared-indicator",4,"ngIf"],["class","post-content",4,"ngIf"],["class","post-media-container",4,"ngIf"],["class","shared-post-container",4,"ngIf"],["class","post-stats",4,"ngIf"],[1,"post-actions"],["aria-label","Like post",1,"action-btn",3,"click","disabled","title"],[1,"action-text"],["aria-label","Comment on post",1,"action-btn",3,"click"],["aria-label","Share post",1,"action-btn",3,"click"],["aria-label","Save post",1,"action-btn",3,"click"],["class","post-comments",4,"ngIf"],[1,"action-menu"],[4,"ngIf"],[3,"click"],[1,"shared-indicator"],[1,"post-content"],[1,"post-media-container"],[3,"media"],[1,"shared-post-container"],[1,"shared-post-header"],["alt","Original poster",1,"shared-avatar",3,"src"],[1,"shared-user-details"],[1,"shared-username",3,"routerLink"],[1,"shared-timestamp"],[1,"shared-post-content"],["class","shared-post-media-container",4,"ngIf"],[1,"shared-post-media-container"],[1,"post-stats"],["class","like-stats",4,"ngIf"],["class","comment-stats",3,"click",4,"ngIf"],["class","share-stats",4,"ngIf"],[1,"like-stats"],[1,"material-icons","like-icon"],[1,"comment-stats",3,"click"],[1,"share-stats"],[1,"material-icons","share-icon"],[1,"post-comments"],[3,"postId"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),D(3,"img",3),o(4,"div",4)(5,"a",5),m(6),a(),o(7,"div",6)(8,"span",7),m(9),a()()()(),o(10,"button",8),b("click",function(){return n.toggleActions()}),o(11,"span",9),m(12,"more_horiz"),a()(),_(13,yn,18,3,"div",10),a(),_(14,Sn,5,1,"div",11)(15,On,2,1,"div",12)(16,wn,2,1,"div",13)(17,Ln,11,8,"div",14)(18,Rn,4,3,"div",15),o(19,"div",16)(20,"button",17),b("click",function(){return n.toggleLike()}),o(21,"span",9),m(22),a(),o(23,"span",18),m(24,"Like"),a()(),o(25,"button",19),b("click",function(){return n.toggleComments()}),o(26,"span",9),m(27,"chat_bubble_outline"),a(),o(28,"span",18),m(29,"Comment"),a()(),o(30,"button",20),b("click",function(){return n.sharePost()}),o(31,"span",9),m(32,"repeat"),a(),o(33,"span",18),m(34,"Share"),a()(),o(35,"button",21),b("click",function(){return n.toggleSavePost()}),o(36,"span",9),m(37),a(),o(38,"span",18),m(39,"Save"),a()()(),_(40,Dn,2,1,"div",22),a()),t&2&&(s(3),l("src",(n.post.user==null?null:n.post.user.avatarUrl)||"/assets/default-avatar.png",V),s(2),l("routerLink",ae(20,Ut,n.post.user==null?null:n.post.user.username))("title",n.post.user==null?null:n.post.user.email),s(),T(" ",n.post.user==null?null:n.post.user.username," "),s(3),z(n.post.timeSince),s(4),l("ngIf",n.showActions),s(),l("ngIf",n.post.isSharedPost),s(),l("ngIf",n.post.content),s(),l("ngIf",n.post.media&&n.post.media.length>0&&!n.post.isSharedPost),s(),l("ngIf",n.post.sharedPost),s(),l("ngIf",n.likeCount>0||n.commentCount>0||n.sharesCount>0),s(2),X("active",n.isLiked),l("disabled",n.isLikeInProgress)("title",n.isLikeInProgress?"Processing...":n.isLiked?"Unlike":"Like"),s(2),T(" ",n.isLiked?"favorite":"favorite_border"," "),s(13),X("active",n.isSaved),s(2),T(" ",n.isSaved?"bookmark":"bookmark_border"," "),s(3),l("ngIf",n.showComments))},dependencies:[ee,Z,De,me,de,Fe,pe],styles:['.post-card[_ngcontent-%COMP%]{background-color:var(--card-background);border-radius:var(--radius-lg);margin-bottom:20px;overflow:hidden;transition:box-shadow var(--transition-normal),transform var(--transition-fast);border:1px solid var(--border-color);box-shadow:0 4px 12px #0000000f}.post-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 25px #00000014;transform:translateY(-3px)}.post-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;position:relative}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center}.avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:var(--radius-full);margin-right:14px;object-fit:cover;border:var(--avatar-border);transition:transform var(--transition-fast);box-shadow:0 2px 8px #00000014}.avatar[_ngcontent-%COMP%]:hover{transform:scale(1.08);box-shadow:0 4px 12px #00000026}.user-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.username[_ngcontent-%COMP%]{font-weight:600;font-size:16px;color:var(--text-color);text-decoration:none;margin-bottom:2px;transition:color .2s ease}.username[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.metadata[_ngcontent-%COMP%]{display:flex;align-items:center}.timestamp[_ngcontent-%COMP%]{font-size:13px;color:var(--text-color);opacity:.7}.options-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;border-radius:var(--radius-full);height:38px;width:38px;display:flex;align-items:center;justify-content:center;transition:all var(--transition-fast);color:var(--text-color);opacity:.7}.options-btn[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);color:var(--primary-color);opacity:1;transform:scale(1.1)}.options-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:20px}.action-menu[_ngcontent-%COMP%]{position:absolute;top:52px;right:12px;background-color:var(--card-background);border-radius:var(--radius-md);box-shadow:0 6px 18px #0000001f;z-index:10;width:220px;overflow:hidden;border:1px solid var(--border-color);animation:_ngcontent-%COMP%_slideDown .25s cubic-bezier(.25,1,.5,1)}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.action-menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:8px 0;margin:0}.action-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;padding:12px 18px;background:none;border:none;text-align:left;cursor:pointer;font-size:14px;color:var(--text-color);transition:all var(--transition-fast)}.action-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);transform:translate(4px)}.action-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{margin-right:12px;font-size:18px;color:var(--text-color);opacity:.8}.shared-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 20px 0;color:var(--text-color);opacity:.8;font-size:14px;font-style:italic}.shared-indicator[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:16px;margin-right:8px;color:var(--primary-color)}.post-content[_ngcontent-%COMP%]{padding:8px 20px 20px;font-size:16px;line-height:1.6;color:var(--text-color);white-space:pre-wrap;word-break:break-word}.post-media-container[_ngcontent-%COMP%], .shared-post-media-container[_ngcontent-%COMP%]{margin:0 0 12px;border-radius:0;overflow:hidden;max-height:600px;position:relative}.post-media-container[_ngcontent-%COMP%]:after, .shared-post-media-container[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:0;right:0;height:1px;background:linear-gradient(to right,rgba(var(--border-color-rgb, 200, 200, 200),0),rgba(var(--border-color-rgb, 200, 200, 200),.5),rgba(var(--border-color-rgb, 200, 200, 200),0))}.shared-post-container[_ngcontent-%COMP%]{margin:12px 20px 20px;border:1px solid var(--border-color);border-radius:var(--radius-lg);overflow:hidden;background-color:var(--hover-color);box-shadow:0 2px 10px #0000000a;transition:transform var(--transition-fast),box-shadow var(--transition-fast)}.shared-post-container[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 8px 16px #00000014}.shared-post-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border-color);background-color:#ffffff0a}.shared-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:var(--radius-full);margin-right:12px;object-fit:cover;border:var(--avatar-border);transition:transform var(--transition-fast)}.shared-avatar[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.shared-user-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.shared-username[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:var(--text-color);text-decoration:none}.shared-username[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.shared-timestamp[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color);opacity:.7}.shared-post-content[_ngcontent-%COMP%]{padding:16px 16px 12px;font-size:15px;line-height:1.5;word-break:break-word;color:var(--text-color)}.post-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:14px 20px 10px;border-top:1px solid var(--border-color);font-size:14px;color:var(--text-color)}.post-stats[_ngcontent-%COMP%]   .like-stats[_ngcontent-%COMP%]{display:flex;align-items:center}.post-stats[_ngcontent-%COMP%]   .like-stats[_ngcontent-%COMP%]   .like-icon[_ngcontent-%COMP%]{font-size:16px;color:var(--error-color)!important;margin-right:6px}.post-stats[_ngcontent-%COMP%]   .comment-stats[_ngcontent-%COMP%]{cursor:pointer;transition:color var(--transition-fast)}.post-stats[_ngcontent-%COMP%]   .comment-stats[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.post-stats[_ngcontent-%COMP%]   .share-stats[_ngcontent-%COMP%]{display:flex;align-items:center}.post-stats[_ngcontent-%COMP%]   .share-stats[_ngcontent-%COMP%]   .share-icon[_ngcontent-%COMP%]{font-size:16px;color:var(--primary-color);margin-right:6px}.post-actions[_ngcontent-%COMP%]{display:flex;border-top:1px solid var(--border-color);padding:6px}.action-btn[_ngcontent-%COMP%]{flex:1;background:none;border:none;padding:10px 0;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text-color);font-size:14px;font-weight:500;transition:all var(--transition-fast);border-radius:var(--radius-md);margin:0 4px;position:relative}.action-btn[_ngcontent-%COMP%]:hover{background-color:var(--hover-color);transform:translateY(-2px)}.action-btn.active[_ngcontent-%COMP%], .action-btn.active[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--primary-color)}.action-btn[_ngcontent-%COMP%]:first-child.active, .action-btn[_ngcontent-%COMP%]:first-child.active   .material-icons[_ngcontent-%COMP%]{color:var(--error-color)}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:wait}.action-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:20px;margin-right:6px;transition:transform var(--transition-fast)}.action-btn[_ngcontent-%COMP%]:active   .material-icons[_ngcontent-%COMP%]{transform:scale(1.4)}.action-btn[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none;background-image:radial-gradient(circle,var(--primary-light) 10%,transparent 10.01%);background-repeat:no-repeat;background-position:50%;transform:scale(10);opacity:0;transition:transform .5s,opacity .8s}.action-btn[_ngcontent-%COMP%]:active:after{transform:scale(0);opacity:.3;transition:0s}.action-btn[_ngcontent-%COMP%]:first-child{position:relative;overflow:hidden}.action-btn[_ngcontent-%COMP%]:first-child.active   .material-icons[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_heart-pulse .6s cubic-bezier(.25,.1,.25,1.5)}.action-btn[_ngcontent-%COMP%]:first-child:disabled:after{content:"";position:absolute;inset:0;background-color:#ffffff4d;border-radius:var(--radius-md)}@keyframes _ngcontent-%COMP%_heart-pulse{0%{transform:scale(1)}50%{transform:scale(1.6)}to{transform:scale(1)}}.post-comments[_ngcontent-%COMP%]{border-top:1px solid var(--border-color);padding-top:12px;animation:_ngcontent-%COMP%_fadeSlideDown .3s ease}@keyframes _ngcontent-%COMP%_fadeSlideDown{0%{opacity:0;transform:translateY(-15px)}to{opacity:1;transform:translateY(0)}}'],changeDetection:0})};var At=class i{_sidebarCollapsed=new Y(!0);get sidebarState(){return this._sidebarCollapsed.asObservable()}toggleSidebar(){this._sidebarCollapsed.next(!this._sidebarCollapsed.value)}setSidebarState(e){this._sidebarCollapsed.next(e)}constructor(){}static \u0275fac=function(t){return new(t||i)};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};export{ht as a,gt as b,ft as c,vt as d,Ct as e,bt as f,_t as g,xt as h,Pt as i,kt as j,Mt as k,yt as l,St as m,Ot as n,wt as o,Et as p,Lt as q,It as r,Fe as s,Re as t,Dt as u,At as v};
