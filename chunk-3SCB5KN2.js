import{a as f}from"./chunk-5FDPCJE3.js";import{Bb as o,C as D,Cb as b,Db as N,E as C,Eb as g,F as x,Fb as A,Gb as S,Hb as _,Ib as y,Lb as O,h as c,i as U,j as d,l as p,nb as v,ob as I,q as m,xb as E,yb as R,zb as P}from"./chunk-UPP2GHVQ.js";import{a,b as l}from"./chunk-HMJPAHNJ.js";var h=v("[User Data] Set Current User",I()),w=v("[User Data] Clear Current User");var L={currentUser:null},j=b(L,o(h,(s,{user:r})=>l(a({},s),{currentUser:r})),o(w,s=>l(a({},s),{currentUser:null})));var B=P("userData"),F=R(B,s=>s.currentUser);var G={user:null,isAuthenticated:!1,isLoading:!1,error:null},T=b(G,o(A,(s,{user:r})=>l(a({},s),{user:r,isAuthenticated:!0,error:null})),o(S,s=>l(a({},s),{user:null,isAuthenticated:!1,error:null})),o(_,(s,{isLoading:r})=>l(a({},s),{isLoading:r})),o(y,(s,{error:r})=>l(a({},s),{error:r})));var V=class s{constructor(r){this.authService=r;this.supabase=N(g.supabaseUrl,g.supabaseKey)}supabase;store=x(E);getUserByUsername(r){return c(this.supabase.from("users").select("*").eq("username",r).single()).pipe(p(({data:e,error:t})=>{if(t){if(t.code==="PGRST116")return null;throw t}if(!e)return null;let n=new f({id:e.id,username:e.username,email:e.email,fullName:e.full_name,avatarUrl:e.avatar_url,bio:e.bio,theme:e.theme||"light",privacySettings:e.privacy_settings||{postsVisibility:"public",profileVisibility:"public"},createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)});return this.store.dispatch(h({user:n})),n}),m(e=>(console.error("Error fetching user by username:",e),U(null))))}updateUserProfile(r,e){let t={username:e.username,full_name:e.fullName,avatar_url:e.avatarUrl,bio:e.bio,theme:e.theme,privacy_settings:e.privacySettings,updated_at:new Date};return c(this.supabase.from("users").update(t).eq("id",r).select()).pipe(p(({data:n,error:i})=>{if(i)throw i;if(!n||!n[0])return null;let u=n[0];return new f({id:u.id,username:u.username,email:u.email,fullName:u.full_name,avatarUrl:u.avatar_url,bio:u.bio,theme:u.theme,privacySettings:u.privacy_settings,createdAt:new Date(u.created_at),updatedAt:new Date(u.updated_at)})}),m(n=>(console.error("Error updating user profile:",n),d(()=>n))))}getCurrentUserProfile(){let r=this.authService.user;return r?c(this.supabase.from("users").select("*").eq("id",r.id).single()).pipe(p(({data:e,error:t})=>{if(t)throw t;return e?new f({id:e.id,username:e.username,email:e.email,fullName:e.full_name,avatarUrl:e.avatar_url,bio:e.bio,theme:e.theme||"light",privacySettings:e.privacy_settings||{postsVisibility:"public",profileVisibility:"public"},createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}):null}),m(e=>(console.error("Error fetching current user profile:",e),U(null)))):U(null)}updateUserProfilePicture(r,e){return c(this.supabase.from("users").update({avatar_url:e,updated_at:new Date}).eq("id",r).select()).pipe(p(({data:t,error:n})=>{if(n)throw n;if(!t||!t[0])return null;let i=t[0];return new f({id:i.id,username:i.username,email:i.email,fullName:i.full_name,avatarUrl:i.avatar_url,bio:i.bio,theme:i.theme,privacySettings:i.privacy_settings,createdAt:new Date(i.created_at),updatedAt:new Date(i.updated_at)})}),m(t=>(console.error("Error updating user profile picture:",t),d(()=>t))))}getUserById(r){return c(this.supabase.from("users").select("*").eq("id",r).single()).pipe(p(({data:e,error:t})=>{if(t){if(t.code==="PGRST116")return null;throw t}return e?new f({id:e.id,username:e.username,email:e.email,fullName:e.full_name,avatarUrl:e.avatar_url,bio:e.bio,theme:e.theme||"light",privacySettings:e.privacy_settings||{postsVisibility:"public",profileVisibility:"public"},createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}):null}),m(e=>(console.error("Error fetching user by ID:",e),U(null))))}static \u0275fac=function(e){return new(e||s)(C(O))};static \u0275prov=D({token:s,factory:s.\u0275fac,providedIn:"root"})};export{j as a,T as b,V as c};
